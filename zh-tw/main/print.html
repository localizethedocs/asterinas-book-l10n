<!DOCTYPE HTML>
<html lang="zh_TW" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Asterinas Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-12372c1e.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-95a29c70.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Asterinas Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="asterinas-æ‰‹å†Š"><a class="header" href="#asterinas-æ‰‹å†Š">Asterinas æ‰‹å†Š</a></h1>
<p align="center">
    <img src="images/logo_en.svg" alt="asterinas-logo" width="620"><br>
</p>

<p>æ­¡è¿é–±è®€ Asterinas çš„æ–‡ä»¶ã€‚Asterinas æ˜¯ä¸€å€‹é–‹æºå°ˆæ¡ˆèˆ‡ç¤¾ç¾¤ï¼Œè‡´åŠ›æ–¼é–‹ç™¼é ‚å°–çš„ Rust ä½œæ¥­ç³»çµ±å…§æ ¸ã€‚</p>
<h2 id="æ‰‹å†Šçµæ§‹"><a class="header" href="#æ‰‹å†Šçµæ§‹">æ‰‹å†Šçµæ§‹</a></h2>
<p>é€™æœ¬æ‰‹å†Šåˆ†ç‚ºå…­å€‹ä¸åŒéƒ¨ä»½ï¼š</p>
<h4 id="ç¬¬-1-éƒ¨ä»½asterinas-nixos"><a class="header" href="#ç¬¬-1-éƒ¨ä»½asterinas-nixos"><a href="distro">ç¬¬ 1 éƒ¨ä»½ï¼šAsterinas NixOS</a></a></h4>
<p>Asterinas NixOS æ˜¯ç¬¬ä¸€å€‹åŸºæ–¼ Asterinas å…§æ ¸å»ºç½®çš„æ•£å¸ƒç‰ˆã€‚å®ƒä»¥ NixOS ç‚ºåŸºç¤ï¼Œåˆ©ç”¨å…¶å¼·å¤§çš„çµ„æ…‹æ¨¡å‹å’Œè±å¯Œçš„è»Ÿé«”åŒ…ç”Ÿæ…‹ç³»çµ±ï¼ŒåŒæ™‚å°‡ Linux å…§æ ¸æ›¿æ›ç‚º Asterinasã€‚</p>
<h4 id="ç¬¬-2-éƒ¨ä»½asterinas-å…§æ ¸"><a class="header" href="#ç¬¬-2-éƒ¨ä»½asterinas-å…§æ ¸"><a href="kernel">ç¬¬ 2 éƒ¨ä»½ï¼šAsterinas å…§æ ¸</a></a></h4>
<p>æ¢ç´¢ Asterinas æ ¸å¿ƒçš„ç¾ä»£ä½œæ¥­ç³»çµ±å…§æ ¸ã€‚Asterinas å…§æ ¸æ˜¯ç‚ºäº†ç™¼æ® Rust çš„å…¨éƒ¨æ½›åŠ›è€Œè¨­è¨ˆçš„ï¼Œä»¥å®‰å…¨ä¸”é«˜æ•ˆçš„æ–¹å¼å¯¦ç¾ Linux ABIã€‚é€™æ„å‘³è‘—å®ƒå¯ä»¥ç„¡ç¸«æ›¿æ› Linuxï¼Œä¸¦æä¾›æ›´å¼·çš„å®‰å…¨æ€§èˆ‡ä¿éšœã€‚</p>
<h4 id="ç¬¬-3-éƒ¨ä»½asterinas-ostd"><a class="header" href="#ç¬¬-3-éƒ¨ä»½asterinas-ostd"><a href="ostd">ç¬¬ 3 éƒ¨ä»½ï¼šAsterinas OSTD</a></a></h4>
<p>Asterinas OSTD ç‚ºä½œæ¥­ç³»çµ±é–‹ç™¼å¥ å®šäº†æ¥µç°¡ã€å¼·å¤§ä¸”ç©©å›ºçš„åŸºç¤ã€‚å®ƒé¡ä¼¼æ–¼ Rust çš„ <code>std</code> è»Ÿé«”ç®±ï¼Œä½†æ˜¯å°ˆç‚º <em>å®‰å…¨çš„</em> Rust ä½œæ¥­ç³»çµ±é–‹ç™¼çš„éœ€æ±‚è€Œæ‰“é€ ã€‚Asterinas å…§æ ¸æ­£æ˜¯å»ºç½®æ–¼æ­¤ OSTD ä¹‹ä¸Šã€‚</p>
<h4 id="ç¬¬-4-éƒ¨ä»½asterinas-osdk"><a class="header" href="#ç¬¬-4-éƒ¨ä»½asterinas-osdk"><a href="osdk/guide">ç¬¬ 4 éƒ¨ä»½ï¼šAsterinas OSDK</a></a></h4>
<p>OSDK æ˜¯ä¸€æ¬¾å‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨ç°¡åŒ–åŸºæ–¼ Asterinas OSTD å»ºç½®çš„ Rust ä½œæ¥­ç³»çµ±å°ˆæ¡ˆçš„å»ºç«‹ã€ç·¨è­¯ã€æ¸¬è©¦èˆ‡åŸ·è¡Œçš„å·¥ä½œæµç¨‹ã€‚å®ƒæ˜¯å°ˆç‚ºä½œæ¥­ç³»çµ±é–‹ç™¼è€…é–‹ç™¼çš„ï¼Œæ“´å……äº† Rust çš„ Cargo å·¥å…·ï¼Œä»¥æ›´è²¼åˆå…¶ç‰¹å®šéœ€æ±‚ã€‚OSDK åœ¨ Asterinas å…§æ ¸çš„é–‹ç™¼éç¨‹ä¸­ç™¼æ®äº†é—œéµä½œç”¨ã€‚</p>
<h4 id="ç¬¬-5-éƒ¨ä»½è²¢ç»-asterinas"><a class="header" href="#ç¬¬-5-éƒ¨ä»½è²¢ç»-asterinas"><a href="to-contribute">ç¬¬ 5 éƒ¨ä»½ï¼šè²¢ç» Asterinas</a></a></h4>
<p>Asterinas æ­£è™•æ–¼æ—©æœŸéšæ®µï¼Œæ­¡è¿æ‚¨çš„è²¢ç»ï¼æœ¬ç« ç¯€å°‡å¼•å°æ‚¨å¦‚ä½•æˆç‚º Asterinas å°ˆæ¡ˆä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€å“¡ã€‚</p>
<h4 id="ç¬¬-6-éƒ¨ä»½æ„è¦‹å¾µæ±‚ç¨¿rfcs"><a class="header" href="#ç¬¬-6-éƒ¨ä»½æ„è¦‹å¾µæ±‚ç¨¿rfcs"><a href="rfcs">ç¬¬ 6 éƒ¨ä»½ï¼šæ„è¦‹å¾µæ±‚ç¨¿ï¼ˆRFCsï¼‰</a></a></h4>
<p>Asterinas çš„é‡å¤§æ±ºç­–çš†é€éé€æ˜çš„ RFC éç¨‹åˆ¶å®šã€‚æœ¬éƒ¨åˆ†æè¿°äº† RFC éç¨‹ï¼Œä¸¦å°å­˜æ‰€æœ‰å·²é€šéçš„ RFCã€‚</p>
<h2 id="æˆæ¬Šæ¢æ¬¾"><a class="header" href="#æˆæ¬Šæ¢æ¬¾">æˆæ¬Šæ¢æ¬¾</a></h2>
<p>Asterinas çš„ä¾†æºç¢¼èˆ‡æ–‡ä»¶ä¸»è¦ä½¿ç”¨ <a href="https://github.com/asterinas/asterinas/blob/main/LICENSE-MPL">Mozilla Public License (MPL), Version 2.0</a>ã€‚éƒ¨åˆ†ç‰¹å®šçµ„ä»¶å‰‡ä½¿ç”¨æ›´å¯¬é¬†çš„æˆæ¬Šæ¢æ¬¾ï¼Œè©³æƒ…è«‹åƒè¦‹<a href="https://github.com/asterinas/asterinas/blob/main/.licenserc.yaml">æ­¤è™•</a>ã€‚</p>
<p>æˆ‘å€‘é¸æ“‡<a href="https://www.tldrlegal.com/license/mozilla-public-license-2-0-mpl-2">å¼±è‘—ä½œå‚³</a>çš„ MPL æˆæ¬Šæ¢æ¬¾ï¼Œåæ˜ äº†ä¸€ç¨®ç­–ç•¥æ€§çš„å¹³è¡¡ï¼š</p>
<ol>
<li>
<p><strong>å°é–‹æºè‡ªç”±çš„æ‰¿è«¾ï¼š</strong> æˆ‘å€‘ç›¸ä¿¡ä½œæ¥­ç³»çµ±å…§æ ¸æ˜¯å…¨äººé¡æ‡‰å…±åŒå—ç›Šçš„å…¬å…±è³‡ç”¢ã€‚MPL ç¢ºä¿å°å— MPL ä¿è­·çš„æª”æ¡ˆçš„ä»»ä½•ä¿®æ”¹éƒ½ä¿æŒé–‹æºï¼Œé€™èˆ‡æˆ‘å€‘çš„é¡˜æ™¯ä¸€è‡´ã€‚æ­¤å¤–ï¼Œæˆ‘å€‘ä¸è¦æ±‚è²¢ç»è€…ç°½ç½²è²¢ç»è€…æˆæ¬Šå”è­°ï¼ˆCLAï¼‰ä»¥ä¿ç•™å…¶æ¬Šåˆ©ï¼Œ<a href="https://drewdevault.com/2018/10/05/Dont-sign-a-CLA.html">ä¸¦é˜²æ­¢å…¶è²¢ç»è¢«è½‰ç‚ºé–‰æºçš„å¯èƒ½æ€§</a>ã€‚</p>
</li>
<li>
<p>**å®¹ç´å°ˆæœ‰æ¨¡çµ„ï¼š**æˆ‘å€‘èªçŸ¥åˆ°å¤§å‹ä¼æ¥­ä¹Ÿå°é–‹æºåšå‡ºé‡å¤§è²¢ç»çš„æ¼”é€²è¶¨å‹¢ï¼Œå› æ­¤æˆ‘å€‘å®¹ç´äº†å°å°ˆæœ‰æ ¸å¿ƒæ¨¡çµ„çš„å•†æ¥­éœ€æ±‚ã€‚èˆ‡ GPL ä¸åŒï¼ŒMPL å…è¨±å°‡å— MPL ä¿è­·çš„æª”æ¡ˆèˆ‡å°ˆæœ‰ç¨‹å¼ç¢¼é€²è¡Œé€£çµã€‚</p>
</li>
</ol>
<p>ç¸½çµä¾†èªªï¼Œæˆ‘å€‘ç›¸ä¿¡ MPL æ˜¯åœç¹ Asterinas åŸ¹è‚²ä¸€å€‹å……æ»¿æ´»åŠ›ã€å¼·å¥ä¸”å…·åŒ…å®¹æ€§çš„é–‹æºç¤¾ç¾¤ä¹‹æœ€ä½³é¸æ“‡ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-nixos"><a class="header" href="#asterinas-nixos">Asterinas NixOS</a></h1>
<p>Asterinas NixOS æ˜¯ Asterinas çš„ç¬¬ä¸€å€‹æ•£å¸ƒç‰ˆã€‚æˆ‘å€‘é¸æ“‡ <a href="https://nixos.org/">NixOS</a> ä½œç‚ºåŸºç¤ä½œæ¥­ç³»çµ±ï¼Œæ˜¯å› ç‚ºå…¶ç„¡èˆ‡å€«æ¯”çš„å¯è¨‚è£½æ€§èˆ‡è±å¯Œçš„è»Ÿé«”åŒ…ç”Ÿæ…‹ç³»çµ±ã€‚Asterinas NixOS çš„ç›®çš„åœ¨æ–¼æä¾›èˆ‡åŸç”Ÿ NixOS ç›¸ä¼¼çš„å¤–è§€èˆ‡ä½¿ç”¨é«”é©—ï¼Œå”¯ä¸€çš„å€åˆ¥åœ¨æ–¼å®ƒå°‡å…§æ ¸å¾ Linux æ›¿æ›ç‚º Asterinasã€‚é—œæ–¼é¸æ“‡ NixOS çš„æ›´å¤šç†ç”±ï¼Œè«‹åƒè¦‹ <a href="https://asterinas.github.io/book/rfcs/0002-asterinas-nixos.html">RFC</a>ã€‚</p>
<p><strong>å…è²¬è²æ˜ï¼šAsterinas æ˜¯ä¸€å€‹ç¨ç«‹ä¸”ç”±ç¤¾ç¾¤ä¸»å°çš„å°ˆæ¡ˆã€‚Asterinas NixOS <em>ä¸¦é</em> NixOS çš„å®˜æ–¹å°ˆæ¡ˆï¼Œä¸”èˆ‡ NixOS åŸºé‡‘æœƒ <em>ç„¡</em> ä»»ä½•éš¸å±¬é—œä¿‚ã€‚æ­¤è™• <em>ä¸</em> åŒ…å«ä»»ä½•è´ŠåŠ©æˆ–èƒŒæ›¸ä¹‹æ„ã€‚</strong></p>
<p>Asterinas NixOS å°šæœªæº–å‚™å¥½ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒã€‚æˆ‘å€‘æä¾› Asterinas NixOS æ˜¯ç‚ºäº†é™ä½ Asterinas å…§æ ¸çš„ä½¿ç”¨é–€æª»ï¼Œè®“æ—©æœŸæ¡ç”¨è€…èˆ‡æ„›å¥½è€…èƒ½å¤ å˜—è©¦ä¸¦æä¾›åé¥‹ã€‚æ­¤å¤–ï¼ŒAsterinas é–‹ç™¼è€…å°‡æ­¤æ•£å¸ƒç‰ˆä½œç‚ºä¸»è¦çš„é–‹ç™¼å·¥å…·ï¼Œæœ‰åŠ©æ–¼åœ¨ Asterinas å…§æ ¸ä¸Šå•Ÿç”¨ä¸¦æ¸¬è©¦æ›´å¤šç¾å¯¦ä¸–ç•Œçš„æ‡‰ç”¨ç¨‹å¼ã€‚</p>
<h2 id="é–‹å§‹ä½¿ç”¨"><a class="header" href="#é–‹å§‹ä½¿ç”¨">é–‹å§‹ä½¿ç”¨</a></h2>
<h3 id="çµ‚ç«¯ä½¿ç”¨è€…"><a class="header" href="#çµ‚ç«¯ä½¿ç”¨è€…">çµ‚ç«¯ä½¿ç”¨è€…</a></h3>
<p>The following instructions describe how to install Asterinas NixOS in a VM using the Asterinas NixOS installer ISO.</p>
<ol>
<li>
<p>å•Ÿå‹• x86-64 çš„ Ubuntu å®¹å™¨ï¼š</p>
<pre><code class="language-bash">docker run -it --privileged --network=host ubuntu:latest bash
</code></pre>
</li>
<li>
<p>åœ¨å®¹å™¨å…§å®‰è£ QEMUï¼š</p>
<pre><code class="language-bash">apt update
apt install -y qemu-system-x86 qemu-utils
</code></pre>
</li>
<li>
<p>å¾ <a href="https://github.com/asterinas/asterinas/releases">GitHub Releases</a> ä¸‹è¼‰æœ€æ–°çš„ Asterinas NixOS å®‰è£ç¨‹å¼ ISOã€‚</p>
</li>
<li>
<p>Create a file that will be used as the target disk to install Asterinas NixOS:</p>
<pre><code class="language-bash"># The capacity of the disk is 10GB; adjust it as you see fit
dd if=/dev/zero of=aster_nixos_disk.img bs=1G count=10
</code></pre>
</li>
<li>
<p>Start an x86-64 VM with two drives: one is the installer CD-ROM and the other is the target disk:</p>
<pre><code class="language-bash">export INSTALLER_ISO=/path/to/your/downloaded/installer.iso
qemu-system-x86_64 \
-cpu host -m 8G -enable-kvm \
-drive file="$INSTALLER_ISO",media=cdrom -boot d \
-drive if=virtio,format=raw,file=aster_nixos_disk.img \
-chardev stdio,id=mux,mux=on,logfile=qemu.log \
-device virtio-serial-pci -device virtconsole,chardev=mux \
-serial chardev:mux -monitor chardev:mux \
-nographic
</code></pre>
<p>After the VM boots, you now have access to the installation environment.</p>
</li>
<li>
<p>Edit the <code>configuration.nix</code> file in the home directory to customize the NixOS system to be installed:</p>
<pre><code class="language-bash">vim configuration.nix
</code></pre>
<p>The complete syntax and guidance for the <code>configuration.nix</code> file can be found in <a href="https://nixos.org/manual/nixos/stable/#ch-configuration">the NixOS manual</a>. If you are not familiar with NixOS, you can simply skip this step.</p>
<p>Not all combinations of settings in <code>configuration.nix</code> are supported by Asterinas NixOS yet. The ones that have been tested are documented in the subsequent chapters.</p>
</li>
<li>
<p>é–‹å§‹å®‰è£ï¼š</p>
<pre><code class="language-bash">install_aster_nixos.sh --config configuration.nix --disk /dev/vda --force-format-disk
</code></pre>
<p>The installation process involves downloading packages and may take around 30 minutes to complete, depending on your network speed.</p>
</li>
<li>
<p>After the installation is complete, you can shut down the VM:</p>
<pre><code class="language-bash">poweroff
</code></pre>
<p>Now Asterinas NixOS is installed in <code>aster_nixos_disk.img</code>.</p>
</li>
<li>
<p>Start a VM to boot the newly installed Asterinas NixOS:</p>
<pre><code class="language-bash">qemu-system-x86_64 \
-cpu host -m 8G -enable-kvm \
-bios /usr/share/qemu/OVMF.fd \
-drive if=none,format=raw,id=x0,file=aster_nixos_disk.img \
-device virtio-blk-pci,drive=x0,disable-legacy=on,disable-modern=off \
-chardev stdio,id=mux,mux=on,logfile=qemu.log \
-device virtio-serial-pci -device virtconsole,chardev=mux \
-serial chardev:mux -monitor chardev:mux \
-device virtio-net-pci,netdev=net0,disable-legacy=on,disable-modern=off \
-netdev user,id=net0 \
-device isa-debug-exit,iobase=0xf4,iosize=0x04 \
-nographic -display vnc=127.0.0.1:21
</code></pre>
<p>If a desktop environment is enabled in the <code>configuration.nix</code> file, you can view the graphical interface using a VNC client.</p>
</li>
</ol>
<h3 id="å…§æ ¸é–‹ç™¼è€…"><a class="header" href="#å…§æ ¸é–‹ç™¼è€…">å…§æ ¸é–‹ç™¼è€…</a></h3>
<ol>
<li>
<p>åœ¨ x86-64 çš„ Linux æ©Ÿå™¨ä¸Šä¸‹è¼‰æœ€æ–°çš„ä¾†æºç¢¼ï¼š</p>
<pre><code class="language-bash">git clone https://github.com/asterinas/asterinas
</code></pre>
</li>
<li>
<p>åŸ·è¡Œ Docker å®¹å™¨ä½œç‚ºé–‹ç™¼ç’°å¢ƒï¼š</p>
<pre><code class="language-bash">docker run -it --privileged --network=host -v /dev:/dev -v $(pwd)/asterinas:/root/asterinas asterinas/asterinas:0.16.2-20251211
</code></pre>
</li>
<li>
<p>Inside the Docker container, generate a disk image with Asterinas NixOS installed using this command:</p>
<pre><code class="language-bash">make nixos
</code></pre>
<p>or this command:</p>
<pre><code class="language-bash">make iso &amp;&amp; make run_iso
</code></pre>
<p>The difference between the two methods is that the first installs NixOS to a disk image entirely inside the container, whereas the second emulates the manual ISO installation steps (see the <a href="#end-users">previous section</a>) by running a VM. Using either method results in a disk image with an Asterinas NixOS installation.</p>
</li>
<li>
<p>Start a VM to run the installed Asterinas NixOS:</p>
<pre><code class="language-bash">make run_nixos
</code></pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ç†±é–€æ‡‰ç”¨ç¨‹å¼"><a class="header" href="#ç†±é–€æ‡‰ç”¨ç¨‹å¼">ç†±é–€æ‡‰ç”¨ç¨‹å¼</a></h1>
<p>The <a href="https://search.nixos.org/packages">Nix package collection</a> contains over 120,000 packages. Many of them may already work out of the box on Asterinas NixOS, but it is impractical to test every package and document its support status. Instead, we group popular applications into categories and document the ones we have verified to work.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="è»Ÿé«”åŒ…ç®¡ç†"><a class="header" href="#è»Ÿé«”åŒ…ç®¡ç†">è»Ÿé«”åŒ…ç®¡ç†</a></h1>
<p>NixOS æä¾›äº†ä¸€å¥—ç”¨æ–¼å»ºç½®ã€å®‰è£èˆ‡ç®¡ç†è»Ÿé«”åŒ…çš„<a href="https://nix.dev/manual/nix/2.28/command-ref/main-commands">å·¥å…·</a>ã€‚</p>
<h2 id="verified-usage"><a class="header" href="#verified-usage">Verified Usage</a></h2>
<h3 id="nix-build"><a class="header" href="#nix-build"><code>nix-build</code></a></h3>
<p><code>nix-build</code> builds Nix derivations and produces outputs in the Nix store. It is the preferred way to build software reproducibly.</p>
<pre><code class="language-bash"># Step 1: Create a clean workspace
rm -rf /tmp/nix-hello-c &amp;&amp; mkdir -p /tmp/nix-hello-c &amp;&amp; cd /tmp/nix-hello-c

# Step 2: Write a C program
cat &gt; hello.c &lt;&lt;'EOF'
#include &lt;stdio.h&gt;

int main(void) {
    puts("Hello, World!");
    return 0;
}
EOF

# Step 3: Write a default.nix
cat &gt; default.nix &lt;&lt;'EOF'
{ pkgs ? import &lt;nixpkgs&gt; {} }:

pkgs.stdenv.mkDerivation {
  pname = "hello-c";
  version = "0.1.0";
  src = ./.;

  dontConfigure = true;

  buildPhase = ''
    cc hello.c -o hello
  '';

  installPhase = ''
    mkdir -p $out/bin
    install -m755 hello $out/bin/hello
  '';
}
EOF

# Step 4: Build and run
nix-build
./result/bin/hello
</code></pre>
<h3 id="nix-env"><a class="header" href="#nix-env"><code>nix-env</code></a></h3>
<p><code>nix-env</code> installs or removes individual packages in your user profile.</p>
<pre><code class="language-bash"># Install the `hello` package
nix-env -iA nixos.hello

# Remove the `hello` package
nix-env -e hello
</code></pre>
<h3 id="nix-shell"><a class="header" href="#nix-shell"><code>nix-shell</code></a></h3>
<p><code>nix-shell</code> creates a temporary development environment with the specified dependencies. This is useful for testing software without modifying your system environment.</p>
<pre><code class="language-bash"># Enter a shell with the `hello` package available
nix-shell -p hello
</code></pre>
<h3 id="nixos-rebuild"><a class="header" href="#nixos-rebuild"><code>nixos-rebuild</code></a></h3>
<p><code>nixos-rebuild</code> manages the entire system configuration declaratively. It applies changes defined in <code>configuration.nix</code>, and is the recommended approach for installing packages system-wide.</p>
<pre><code class="language-bash"># ç·¨è¼¯ç³»çµ±çµ„æ…‹æª”
vim /etc/nixos/configuration.nix

# Apply configuration changes and rebuild the system without rebooting
nixos-rebuild test
</code></pre>
<!--
TODO: upgrade mdbook to enable admonition blocks like the one below:

> [!WARNING]
> `nixos-rebuild switch` is not yet supported
-->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="æ¡Œé¢ç’°å¢ƒ"><a class="header" href="#æ¡Œé¢ç’°å¢ƒ">æ¡Œé¢ç’°å¢ƒ</a></h1>
<h2 id="xfce"><a class="header" href="#xfce">Xfce</a></h2>
<p><a href="https://www.xfce.org/">Xfce</a> is a lightweight desktop environment for UNIX-like operating systems.</p>
<h3 id="å®‰è£"><a class="header" href="#å®‰è£">å®‰è£</a></h3>
<p>Add the following lines to the <code>configuration.nix</code> file:</p>
<pre><code class="language-nix">services.xserver.enable = true;
services.xserver.desktopManager.xfce.enable = true;
</code></pre>
<!--
TODO: upgrade mdbook to enable admonition blocks like the one below:

> [!WARNING]
> Xfce must be enabled during the initial installation of Asterinas NixOS. Applying configuration changes via `nixos-rebuild` is not working yet.
-->
<h3 id="verified-backends"><a class="header" href="#verified-backends">Verified Backends</a></h3>
<ul>
<li>Display server:
<ul>
<li>Xorg display server</li>
</ul>
</li>
<li>Graphics drivers:
<ul>
<li>Standard UEFI VGA framebuffer</li>
</ul>
</li>
</ul>
<h3 id="verified-functionality"><a class="header" href="#verified-functionality">Verified Functionality</a></h3>
<ul>
<li>Changing desktop wallpapers and background settings</li>
<li>Adjusting font size, style, and system theme</li>
<li>Creating application shortcuts and desktop launchers</li>
<li>Managing panels and window behavior</li>
<li>Using the settings manager and file browser</li>
</ul>
<h3 id="verified-gui-applications"><a class="header" href="#verified-gui-applications">Verified GUI Applications</a></h3>
<p>Utilities:</p>
<ul>
<li><code>galculator</code>: Calculator</li>
<li><code>mousepad</code>ï¼šé è¨­çš„ Xfce æ–‡å­—ç·¨è¼¯å™¨</li>
<li><code>mupdf</code>: A lightweight PDF and XPS viewer</li>
</ul>
<p>Games:</p>
<ul>
<li><code>fairymax</code>: Chess</li>
<li><code>five-or-more</code>: GNOME alignment game</li>
<li><code>lbreakout2</code>: Breakout/Arkanoid clone</li>
<li><code>gnome-chess</code>: GNOME chess</li>
<li><code>gnome-mines</code>: Minesweeper</li>
<li><code>gnome-sudoku</code>: GNOME sudoku</li>
<li><code>tali</code>: GNOME dice game</li>
<li><code>xboard</code>: Chess</li>
<li><code>xgalaga</code>: Galaga-style arcade game</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="å®¹å™¨åŒ–"><a class="header" href="#å®¹å™¨åŒ–">å®¹å™¨åŒ–</a></h1>
<h2 id="podman"><a class="header" href="#podman">Podman</a></h2>
<p><a href="https://docs.podman.io/en/stable/Introduction.html">Podman</a> æ˜¯ä¸€æ¬¾ç¾ä»£åŒ–çš„ç„¡å®ˆè­·é€²ç¨‹å®¹å™¨å¼•æ“ï¼Œæä¾›èˆ‡ Docker ç›¸å®¹çš„å‘½ä»¤è¡Œä»‹é¢ï¼Œè®“ç†Ÿæ‚‰ Docker çš„ä½¿ç”¨è€…èƒ½è¼•é¬†éæ¸¡ã€‚</p>
<h3 id="å®‰è£-1"><a class="header" href="#å®‰è£-1">å®‰è£</a></h3>
<p>è‹¥è¦å®‰è£ Podmanï¼Œè«‹å°‡ä»¥ä¸‹å…§å®¹å¢æ·»åˆ° <code>configuration.nix</code>ï¼š</p>
<pre><code class="language-nix">virtualization.podman.enable = true;
</code></pre>
<h3 id="verified-usage-1"><a class="header" href="#verified-usage-1">Verified Usage</a></h3>
<h4 id="podman-run"><a class="header" href="#podman-run"><code>podman run</code></a></h4>
<p><code>podman run</code> åœ¨æ–°çš„å®¹å™¨ä¸­åŸ·è¡Œå‘½ä»¤ã€‚</p>
<pre><code class="language-bash"># å•Ÿå‹•å®¹å™¨ï¼ŒåŸ·è¡Œå‘½ä»¤ï¼Œç„¶å¾Œé€€å‡º
podman run --name=c1 docker.io/library/alpine ls /etc

# å•Ÿå‹•å®¹å™¨ä¸¦é™„åŠ åˆ°äº’å‹•å¼å¤–æ®¼
podman run -it docker.io/library/alpine
</code></pre>
<h4 id="podman-image"><a class="header" href="#podman-image"><code>podman image</code></a></h4>
<p><code>podman image</code> æœƒç®¡ç†æœ¬æ©Ÿæ˜ åƒã€‚</p>
<pre><code class="language-bash"># åˆ—å‡ºå·²ä¸‹è¼‰çš„æ˜ åƒæª”
podman image ls
</code></pre>
<h4 id="podman-ps"><a class="header" href="#podman-ps"><code>podman ps</code></a></h4>
<p><code>podman ps</code> åˆ—å‡ºå®¹å™¨ã€‚</p>
<pre><code class="language-bash"># Show the status of all containers (including exited ones)
podman ps -a
</code></pre>
<h4 id="podman-rm"><a class="header" href="#podman-rm"><code>podman rm</code></a></h4>
<p><code>podman rm</code> ç§»é™¤ä¸€å€‹æˆ–å¤šå€‹å®¹å™¨ã€‚</p>
<pre><code class="language-bash"># ç§»é™¤åç‚º foo çš„å®¹å™¨
podman rm foo
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-å…§æ ¸"><a class="header" href="#asterinas-å…§æ ¸">Asterinas å…§æ ¸</a></h1>
<h2 id="æ¦‚è¦½"><a class="header" href="#æ¦‚è¦½">æ¦‚è¦½</a></h2>
<p>Asterinas æ˜¯ä¸€æ¬¾ <em>å®‰å…¨</em> ã€ <em>å¿«é€Ÿ</em> ä¸” <em>é€šç”¨</em> çš„ä½œæ¥­ç³»çµ±å…§æ ¸ï¼Œæä¾› <em>ç›¸å®¹æ–¼ Linux</em> çš„ ABIã€‚å®ƒèƒ½ä½œç‚º Linux çš„ç„¡ç¸«æ›¿ä»£æ–¹æ¡ˆï¼ŒåŒæ™‚æå‡ <em>è¨˜æ†¶é«”å®‰å…¨æ€§</em> èˆ‡ <em>é–‹ç™¼è€…å‹å–„æ€§</em> ã€‚</p>
<ul>
<li>
<p>Asterinas prioritizes memory safety by employing Rust as its sole programming language and limiting the use of <em>unsafe Rust</em> to a clearly defined and minimal Trusted Computing Base (TCB). This innovative approach, known as <a href="#æ¡†å…§æ ¸æ¶æ§‹">the framekernel architecture</a>, establishes Asterinas as a more secure and dependable kernel option.</p>
</li>
<li>
<p>Asterinas åœ¨é–‹ç™¼è€…å‹å–„æ€§æ–¹é¢è¶…è¶Šäº† Linuxã€‚å®ƒè³¦äºˆå…§æ ¸é–‹ç™¼è€…ä»¥ä¸‹èƒ½åŠ›ï¼š(1) ä½¿ç”¨æ›´å…·ç”Ÿç”¢åŠ›çš„ Rust ç¨‹å¼èªè¨€ï¼›(2) åˆ©ç”¨åç‚º <a href="#asterinas-å…§æ ¸">OSDK</a> çš„å°ˆç”¨å·¥å…·çµ„ä¾†ç°¡åŒ–å·¥ä½œæµç¨‹ï¼›(3) ç”±æ–¼ <a href="">MPL</a> æä¾›çš„éˆæ´»æ€§ï¼Œé–‹ç™¼è€…å¯ä»¥è‡ªç”±é¸æ“‡å°‡å…¶å…§æ ¸æ¨¡çµ„é–‹æºæˆ–ä¿æŒç§æœ‰ã€‚</p>
</li>
</ul>
<p>While the journey towards a production-grade OS kernel can be challenging, we are steadfastly progressing towards our goal. Currently, Asterinas only supports x86-64 VMs. However, <a href="#è·¯ç·šåœ–">our aim for 2024</a> is to make Asterinas production-ready on x86-64 for both bare-metal and VM environments.</p>
<h2 id="é–‹å§‹ä½¿ç”¨-1"><a class="header" href="#é–‹å§‹ä½¿ç”¨-1">é–‹å§‹ä½¿ç”¨</a></h2>
<p>æº–å‚™ä¸€å°å·²å®‰è£ Docker çš„ x86-64 Linux æ©Ÿå™¨ã€‚æŒ‰ç…§ä»¥ä¸‹ä¸‰å€‹ç°¡å–®æ­¥é©Ÿå³å¯å•Ÿå‹•ä¸¦åŸ·è¡Œ Asterinasã€‚</p>
<ol>
<li>
<p>ä¸‹è¼‰æœ€æ–°çš„ä¾†æºç¢¼ã€‚</p>
<pre><code class="language-bash">git clone https://github.com/asterinas/asterinas
</code></pre>
</li>
<li>
<p>åŸ·è¡Œ Docker å®¹å™¨ä½œç‚ºé–‹ç™¼ç’°å¢ƒã€‚</p>
<pre><code class="language-bash">docker run -it --privileged \
            --network=host \
            --device=/dev/kvm \
            -v $(pwd)/asterinas:/root/asterinas \
            asterinas/asterinas:0.17.0-20260114
</code></pre>
</li>
<li>
<p>åœ¨å®¹å™¨å…§ï¼Œå‰å¾€å°ˆæ¡ˆè³‡æ–™å¤¾å»ºç½®ä¸¦åŸ·è¡Œ Asterinasã€‚</p>
<pre><code class="language-bash">make kernel
make run_kernel
</code></pre>
</li>
</ol>
<p>å¦‚æœä¸€åˆ‡é †åˆ©ï¼ŒAsterinas ç¾åœ¨å·²åœ¨è™›æ“¬æ©Ÿä¸­å•Ÿå‹•ä¸¦åŸ·è¡Œã€‚</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="é€²éšå»ºç½®èˆ‡æ¸¬è©¦èªªæ˜"><a class="header" href="#é€²éšå»ºç½®èˆ‡æ¸¬è©¦èªªæ˜">é€²éšå»ºç½®èˆ‡æ¸¬è©¦èªªæ˜</a></h1>
<h2 id="ä½¿ç”¨è€…æ¨¡å¼å–®å…ƒæ¸¬è©¦"><a class="header" href="#ä½¿ç”¨è€…æ¨¡å¼å–®å…ƒæ¸¬è©¦">ä½¿ç”¨è€…æ¨¡å¼å–®å…ƒæ¸¬è©¦</a></h2>
<p>Asterinas ç”±è¨±å¤šè»Ÿé«”ç®±çµ„æˆï¼Œå…¶ä¸­éƒ¨åˆ†ä¸éœ€è¦ VM ç’°å¢ƒï¼Œå³å¯ä½¿ç”¨æ¨™æº–çš„ <code>cargo test</code> é€²è¡Œæ¸¬è©¦ã€‚é€™äº›è»Ÿé«”ç®±å·²åˆ—åœ¨æ ¹ç›®éŒ„çš„ <code>Makefile</code> ä¸­ï¼Œä¸¦å¯é€éä»¥ä¸‹ Make å‘½ä»¤é€²è¡Œçµ±ä¸€æ¸¬è©¦ã€‚</p>
<pre><code class="language-bash">make test
</code></pre>
<p>è‹¥è¦æ¸¬è©¦å–®å€‹è»Ÿé«”ç®±ï¼Œè«‹é€²å…¥è©²è»Ÿé«”ç®±çš„ç›®éŒ„ä¸¦åŸ·è¡Œ <code>cargo test</code>ã€‚</p>
<h3 id="å…§æ ¸æ¨¡å¼å–®å…ƒæ¸¬è©¦"><a class="header" href="#å…§æ ¸æ¨¡å¼å–®å…ƒæ¸¬è©¦">å…§æ ¸æ¨¡å¼å–®å…ƒæ¸¬è©¦</a></h3>
<p>Asterinas ä¸­çš„è¨±å¤šè»Ÿé«”ç®±éƒ½éœ€è¦è™›æ“¬æ©Ÿç’°å¢ƒæ‰èƒ½é€²è¡Œæ¸¬è©¦ã€‚é€™äº›è»Ÿé«”ç®±çš„å–®å…ƒæ¸¬è©¦æ˜¯ç”± OSDK æä¾›æ”¯æ´çš„ã€‚</p>
<pre><code class="language-bash">make ktest
</code></pre>
<p>To test an individual crate in kernel mode, enter the directory of the crate and invoke <code>cargo osdk test</code>.</p>
<pre><code class="language-bash">cd asterinas/ostd
cargo osdk test
</code></pre>
<h2 id="æ•´åˆæ¸¬è©¦"><a class="header" href="#æ•´åˆæ¸¬è©¦">æ•´åˆæ¸¬è©¦</a></h2>
<h3 id="ä¸€èˆ¬æ¸¬è©¦"><a class="header" href="#ä¸€èˆ¬æ¸¬è©¦">ä¸€èˆ¬æ¸¬è©¦</a></h3>
<p>ä»¥ä¸‹å‘½ä»¤æœƒåœ¨ Asterinas ä¸Šå»ºç½®ä¸¦åŸ·è¡Œä½æ–¼ <code>test/initramfs/src/apps</code> ç›®éŒ„ä¸­çš„æ¸¬è©¦äºŒé€²ä½æª”ã€‚</p>
<pre><code class="language-bash">make run_kernel AUTO_TEST=test
</code></pre>
<h3 id="ç³»çµ±å‘¼å«æ¸¬è©¦"><a class="header" href="#ç³»çµ±å‘¼å«æ¸¬è©¦">ç³»çµ±å‘¼å«æ¸¬è©¦</a></h3>
<p>The following command builds and runs the syscall test binaries on Asterinas.</p>
<pre><code class="language-bash">make run_kernel AUTO_TEST=syscall
</code></pre>
<p>To run system call tests interactively, start an instance of Asterinas with the system call tests built and installed.</p>
<pre><code class="language-bash">make run_kernel BUILD_SYSCALL_TEST=1
</code></pre>
<p>Then, in the interactive shell, run the following script to start the syscall tests.</p>
<pre><code class="language-bash">/opt/syscall_test/run_syscall_test.sh
</code></pre>
<h2 id="é™¤éŒ¯"><a class="header" href="#é™¤éŒ¯">é™¤éŒ¯</a></h2>
<h3 id="ä½¿ç”¨-gdb-é€²è¡Œé™¤éŒ¯"><a class="header" href="#ä½¿ç”¨-gdb-é€²è¡Œé™¤éŒ¯">ä½¿ç”¨ GDB é€²è¡Œé™¤éŒ¯</a></h3>
<p>To debug Asterinas via <a href="https://qemu-project.gitlab.io/qemu/system/gdb.html">QEMU GDB support</a>, you can compile Asterinas in the debug profile, start an Asterinas instance and run the GDB interactive shell in another terminal.</p>
<p>Start a GDB-enabled VM of Asterinas with OSDK and wait for debugging connection:</p>
<pre><code class="language-bash">make gdb_server
</code></pre>
<p>The server will listen at the default address specified in <code>Makefile</code>, i.e., a local TCP port <code>:1234</code>. Change the address in <code>Makefile</code> for your convenience, and check <code>cargo osdk run -h</code> for more details about the address.</p>
<p>Two options are provided to interact with the debug server.</p>
<ul>
<li>
<p>GDB å®¢æˆ¶ç«¯ï¼šåœ¨å¦ä¸€å€‹çµ‚ç«¯æ©Ÿå•Ÿå‹• GDB å®¢æˆ¶ç«¯ã€‚</p>
<pre><code class="language-bash">make gdb_client
</code></pre>
</li>
<li>
<p>VS Code: <a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a> extension is required. After starting a debug server with OSDK from the shell with <code>make gdb_server</code>, a temporary <code>launch.json</code> is generated under <code>.vscode</code>. Your previous launch configs will be restored after the server is down. Press <code>F5</code>(Run and Debug) to start a debug session via VS Code. Click <code>Continue</code>(or, press <code>F5</code>) at the first break to resume the paused server instance, then it will continue until reaching your first breakpoint.</p>
</li>
</ul>
<p>Note that if debugging with KVM enabled, you must use hardware assisted breakpoints. See â€œhbreakâ€ in <a href="https://ftp.gnu.org/old-gnu/Manuals/gdb/html_node/gdb_28.html">the GDB manual</a> for details.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="intel-tdx"><a class="header" href="#intel-tdx">Intel TDX</a></h1>
<p>Asterinas can serve as a secure guest OS for Intel TDX-protected virtual machines (VMs). This documentation describes how Asterinas can be run and tested easily on a TDX-enabled Intel server.</p>
<p>Intel TDX (Trust Domain Extensions) is a Trusted Execution Environment (TEE) technology that enhances VM security by creating isolated, hardware-enforced trust domains with encrypted memory, secure initialization, and attestation mechanisms. For more information about Intel TDX, jump to the last section.</p>
<h2 id="why-choose-asterinas-for-intel-tdx"><a class="header" href="#why-choose-asterinas-for-intel-tdx">Why choose Asterinas for Intel TDX</a></h2>
<p>VM TEEs such as Intel TDX deserve a more secure option for its guest OS than Linux. Linux, with its inherent memory safety issues and large Trusted Computing Base (TCB), has long suffered from security vulnerabilities due to memory safety bugs. Additionally, when Linux is used as the guest kernel inside a VM TEE, it must process untrusted inputs (over 1500 instances in Linux, per Intelâ€™s estimation) from the host (via hypercalls, MMIO, and etc.). These untrusted inputs create new attack surfaces that can be exploited through memory safety vulnerabilities, known as Iago attacks.</p>
<p>Asterinas offers greater memory safety than Linux, particularly against Iago attacks. Thanks to its framekernel architecture, the memory safety of Asterinas relies solely on the Asterinas Framework, excluding the safe device drivers built on top of the Asterinas Framework that may handle untrusted inputs from the host. For more information, see <a href="https://www.youtube.com/watch?v=3AQ5lpXujGo">our talk on OC3â€™24</a>.</p>
<h2 id="æº–å‚™-intel-tdx-ç’°å¢ƒ"><a class="header" href="#æº–å‚™-intel-tdx-ç’°å¢ƒ">æº–å‚™ Intel TDX ç’°å¢ƒ</a></h2>
<p>è«‹ç¢ºä¿æ‚¨çš„ä¼ºæœå™¨æ”¯æ´ Intel TDXã€‚</p>
<p>See <a href="https://github.com/canonical/tdx/tree/noble-24.04?tab=readme-ov-file#4-setup-host-os">this guide</a> or other materials to enable Intel TDX in host OS.</p>
<p>è‹¥è¦é©—è­‰ TDX ä¸»æ©Ÿç‹€æ…‹ï¼Œæ‚¨å¯ä»¥è¼¸å…¥ï¼š</p>
<pre><code class="language-bash">dmesg | grep "TDX module initialized"
</code></pre>
<p>The following result is an example:</p>
<pre><code class="language-bash">[   20.507296] tdx: TDX module initialized.
</code></pre>
<p><code>TDX module initialized</code> means TDX module is loaded successfully.</p>
<h2 id="å»ºç½®ä¸¦åŸ·è¡Œ-asterinas"><a class="header" href="#å»ºç½®ä¸¦åŸ·è¡Œ-asterinas">å»ºç½®ä¸¦åŸ·è¡Œ Asterinas</a></h2>
<ol>
<li>
<p>ä¸‹è¼‰æœ€æ–°çš„ä¾†æºç¢¼ã€‚</p>
<pre><code class="language-bash">git clone https://github.com/asterinas/asterinas
</code></pre>
</li>
<li>
<p>åŸ·è¡Œ Docker å®¹å™¨ä½œç‚ºé–‹ç™¼ç’°å¢ƒã€‚</p>
<pre><code class="language-bash">docker run -it --privileged --network=host --device=/dev/kvm -v $(pwd)/asterinas:/root/asterinas asterinas/asterinas:0.17.0-20260114
</code></pre>
</li>
<li>
<p>åœ¨å®¹å™¨å…§ï¼Œå‰å¾€å°ˆæ¡ˆè³‡æ–™å¤¾å»ºç½®ä¸¦åŸ·è¡Œ Asterinasã€‚</p>
<pre><code class="language-bash">make run_kernel INTEL_TDX=1
</code></pre>
</li>
</ol>
<p>If everything goes well, Asterinas is now up and running inside a TD.</p>
<h2 id="ä½¿ç”¨-gdb-é€²è¡Œé™¤éŒ¯-1"><a class="header" href="#ä½¿ç”¨-gdb-é€²è¡Œé™¤éŒ¯-1">ä½¿ç”¨ GDB é€²è¡Œé™¤éŒ¯</a></h2>
<p>A Trust Domain (TD) is debuggable if its <code>ATTRIBUTES.DEBUG</code> bit is 1. In this mode, the host VMM can use Intel TDX module functions to read and modify TD VCPU state and TD private memory, which are not accessible when the TD is non-debuggable.</p>
<p>Start Asterinas in a GDB-enabled TD and wait for debugging connection:</p>
<pre><code class="language-bash">make gdb_server INTEL_TDX=1
</code></pre>
<p>Behind the scene, this command adds <code>debug=on</code> configuration to the QEMU parameters to enable TD debuggable mode.</p>
<p>The server will listen at the default address specified in <code>Makefile</code>, i.e., a local TCP port <code>:1234</code>.</p>
<p>Start a GDB client in another terminal:</p>
<pre><code class="language-bash">make gdb_client INTEL_TDX=1
</code></pre>
<p>Note that you must use hardware assisted breakpoints because KVM is enabled when debugging a TD.</p>
<h2 id="é—œæ–¼-intel-tdx"><a class="header" href="#é—œæ–¼-intel-tdx">é—œæ–¼ Intel TDX</a></h2>
<p>IntelÂ® Trust Domain Extensions (IntelÂ® TDX) is Intelâ€™s newest confidential computing technology. This hardware-based trusted execution environment (TEE) facilitates the deployment of trust domains (TD), which are hardware-isolated virtual machines (VM) designed to protect sensitive data and applications from unauthorized access.</p>
<p>A CPU-measured Intel TDX module enables Intel TDX. This software module runs in a new CPU Secure Arbitration Mode (SEAM) as a peer virtual machine manager (VMM), and supports TD entry and exit using the existing virtualization infrastructure. The module is hosted in a reserved memory space identified by the SEAM Range Register (SEAMRR).</p>
<p>Intel TDX uses hardware extensions for managing and encrypting memory and protects both the confidentiality and integrity of the TD CPU state from non-SEAM mode.</p>
<p>Intel TDX uses architectural elements such as SEAM, a shared bit in Guest Physical Address (GPA), secure Extended Page Table (EPT), physical-address-metadata table, IntelÂ® Total Memory Encryption â€“ Multi-Key (IntelÂ® TME-MK), and remote attestation.</p>
<p>Intel TDX ensures data integrity, confidentiality, and authenticity, which empowers engineers and tech professionals to create and maintain secure systems, enhancing trust in virtualized environments.</p>
<p>For more information, please refer to <a href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html">Intel TDX website</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="æ¡†å…§æ ¸æ¶æ§‹"><a class="header" href="#æ¡†å…§æ ¸æ¶æ§‹">æ¡†å…§æ ¸æ¶æ§‹</a></h1>
<h2 id="æ¡†å…§æ ¸æ˜¯ä»€éº¼èˆ‡ç‚ºä»€éº¼"><a class="header" href="#æ¡†å…§æ ¸æ˜¯ä»€éº¼èˆ‡ç‚ºä»€éº¼">æ¡†å…§æ ¸ï¼šæ˜¯ä»€éº¼èˆ‡ç‚ºä»€éº¼</a></h2>
<blockquote>
<p>å¾®å…§æ ¸çš„å®‰å…¨æ€§ï¼Œå–®å…§æ ¸çš„é€Ÿåº¦ã€‚</p>
</blockquote>
<p>Asterinas introduces a novel OS architecture called <em>framekernel</em>, which unleashes the full power of Rust to bring the best of both monolithic kernels and microkernels.</p>
<p>Within the framekernel architecture, the entire OS resides in the same address space (like a monolithic kernel) and is required to be written in Rust. However, thereâ€™s a twistâ€”the kernel is partitioned in two halves: the OS Framework (akin to a microkernel) and the OS Services. Only the OS Framework is allowed to use <em>unsafe Rust</em>, while the OS Services must be written exclusively in <em>safe Rust</em>.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Unsafe Rust</th><th>Responsibilities</th><th>Code Sizes</th></tr>
</thead>
<tbody>
<tr><td>ä½œæ¥­ç³»çµ±æ¡†æ¶</td><td>å…è¨±</td><td>Encapsulate low-level unsafe code within high-level safe APIs</td><td>Small</td></tr>
<tr><td>ä½œæ¥­ç³»çµ±æœå‹™</td><td>ä¸å…è¨±</td><td>Implement OS functionalities, e.g., system calls, file systems, device drivers</td><td>Large</td></tr>
</tbody>
</table>
</div>
<p>As a result, the memory safety of the kernel can be reduced to that of the OS Framework, thus minimizing the Trusted Computing Base (TCB) associated with the kernelâ€™s memory safety. On the other hand, the single address space allows different parts of the kernel to communicate in the most efficient means, e.g., function calls and shared memory. Thanks to the framekernel architecture, Asterinas can offer both exceptional performance and enhanced safety.</p>
<p><img src="images/a_comparison_between_os_archs.svg" alt="A comparison between different OS architectures"></p>
<h2 id="requirements-for-the-os-framework"><a class="header" href="#requirements-for-the-os-framework">Requirements for the OS Framework</a></h2>
<p>While the concept of framekernel is straightforward, the design and implementation of the required OS framework present challenges. It must concurrently fulfill four criteria.</p>
<p><img src="images/four_requirements_for_os_framework.svg" alt="The four requirements for the OS framework"></p>
<ul>
<li>
<p><strong>Soundness.</strong> The safe APIs of the framework are considered sound if no <a href="https://doc.rust-lang.org/reference/behavior-considered-undefined.html#behavior-considered-undefined">undefined behaviors</a> shall be triggered by whatever safe Rust code that a programmer may write using the APIs</p>
</li>
<li>
<p>as long as the code is verified by the Rust toolchain. Soundness ensures that the OS framework, in conjunction with the Rust toolchain, bears the full responsibility for the kernelâ€™s memory safety.</p>
</li>
<li>
<p><strong>Expressiveness.</strong> The framework should empower developers to implement a substantial range of OS functionalities in safe Rust using the APIs. It is especially important that the framework enables writing device drivers in safe Rust, considering that device drivers comprise the bulk of the code in a fully-fleged OS kernel (like Linux).</p>
</li>
<li>
<p><strong>Minimalism.</strong> As the TCB for memory safety, the framework should be kept as small as possible. No functionality should be implemented inside the framework if doing it outside is possible.</p>
</li>
<li>
<p><strong>Efficiency.</strong> The safe API provided by the framework is only allowed to introduce minimal overheads. Ideally, these APIs should be realized as <a href="https://monomorph.is/posts/zero-cost-abstractions/">zero-cost abstractions</a>.</p>
</li>
</ul>
<p>Fortunately, our efforts to design and implement an OS framework meeting these standards have borne fruit in the form of the <a href="ostd">Asterinas OSTD</a>. Using this framework as a foundation, we have developed the Asterinas Kernel; this framework also enables others to create their own framekernels, with different goals and tradeoffs.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="linux-ç›¸å®¹æ€§"><a class="header" href="#linux-ç›¸å®¹æ€§">Linux ç›¸å®¹æ€§</a></h1>
<blockquote>
<p>â€œWe donâ€™t break user space.â€</p>
<p>-â€“ Linus Torvalds</p>
</blockquote>
<p>Asterinas è‡´åŠ›æ–¼ä¿æŒèˆ‡ Linux ABI çš„ç›¸å®¹æ€§ï¼Œç¢ºä¿å°ˆç‚º Linux è¨­è¨ˆçš„æ‡‰ç”¨ç¨‹å¼å’Œç®¡ç†å·¥å…·èƒ½åœ¨ Asterinas ä¸­ç„¡ç¸«é‹è¡Œã€‚é›–ç„¶æˆ‘å€‘å„ªå…ˆè€ƒæ…®ç›¸å®¹æ€§ï¼Œä½†å¿…é ˆæ³¨æ„çš„æ˜¯ï¼ŒAsterinas ç›®å‰ä¸æ”¯æ´ã€æœªä¾†ä¹Ÿä¸æœƒæ”¯æ´è¼‰å…¥ Linux å…§æ ¸æ¨¡çµ„ã€‚</p>
<h2 id="system-calls"><a class="header" href="#system-calls">System Calls</a></h2>
<p>At the time of writing, Asterinas supports over 230 Linux system calls for the x86-64 architecture, which are summarized in the table below.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Numbers</th><th>Names</th><th>Supported</th><th>Flag Coverage</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>read</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>1</td><td>write</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>2</td><td>open</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#open-and-openat">âš ï¸</a></td></tr>
<tr><td>3</td><td>close</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>4</td><td>stat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>5</td><td>fstat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>6</td><td>lstat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>7</td><td>poll</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#poll-and-ppoll">âš ï¸</a></td></tr>
<tr><td>8</td><td>lseek</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#lseek">âš ï¸</a></td></tr>
<tr><td>9</td><td>mmap</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mmap-and-munmap">âš ï¸</a></td></tr>
<tr><td>10</td><td>mprotect</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mprotect">âš ï¸</a></td></tr>
<tr><td>11</td><td>munmap</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>12</td><td>brk</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>13</td><td>rt_sigaction</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#rt_sigaction">âš ï¸</a></td></tr>
<tr><td>14</td><td>rt_sigprocmask</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#rt_sigprocmask">âš ï¸</a></td></tr>
<tr><td>15</td><td>rt_sigreturn</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>16</td><td>ioctl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioctl">âš ï¸</a></td></tr>
<tr><td>17</td><td>pread64</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>18</td><td>pwrite64</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>19</td><td>readv</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>20</td><td>writev</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>21</td><td>access</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>22</td><td>pipe</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>23</td><td>select</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>24</td><td>sched_yield</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>25</td><td>mremap</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#mremap">âš ï¸</a></td></tr>
<tr><td>26</td><td>msync</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#msync">âš ï¸</a></td></tr>
<tr><td>27</td><td>mincore</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>28</td><td>madvise</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management#madvise">âš ï¸</a></td></tr>
<tr><td>29</td><td>shmget</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>30</td><td>shmat</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>31</td><td>shmctl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>32</td><td>dup</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>33</td><td>dup2</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>34</td><td>pause</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>35</td><td>nanosleep</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>36</td><td>getitimer</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>37</td><td>alarm</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>38</td><td>setitimer</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>39</td><td>getpid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>40</td><td>sendfile</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>41</td><td>socket</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#socket">âš ï¸</a></td></tr>
<tr><td>42</td><td>connect</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#connect">âš ï¸</a></td></tr>
<tr><td>43</td><td>accept</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#accept-and-accept4">âš ï¸</a></td></tr>
<tr><td>44</td><td>sendto</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">âš ï¸</a></td></tr>
<tr><td>45</td><td>recvfrom</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#recvfrom-and-recvmsg">âš ï¸</a></td></tr>
<tr><td>46</td><td>sendmsg</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">âš ï¸</a></td></tr>
<tr><td>47</td><td>recvmsg</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#recvfrom-and-recvmsg">âš ï¸</a></td></tr>
<tr><td>48</td><td>shutdown</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>49</td><td>bind</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#bind">âš ï¸</a></td></tr>
<tr><td>50</td><td>listen</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>51</td><td>getsockname</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>52</td><td>getpeername</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>53</td><td>socketpair</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#socketpair">âš ï¸</a></td></tr>
<tr><td>54</td><td>setsockopt</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#getsockopt-and-setsockopt">âš ï¸</a></td></tr>
<tr><td>55</td><td>getsockopt</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#getsockopt-and-setsockopt">âš ï¸</a></td></tr>
<tr><td>56</td><td>clone</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#clone-and-clone3">âš ï¸</a></td></tr>
<tr><td>57</td><td>fork</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>58</td><td>vfork</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>59</td><td>execve</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>60</td><td>exit</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>61</td><td>wait4</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#wait4">âš ï¸</a></td></tr>
<tr><td>62</td><td>kill</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>63</td><td>uname</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>64</td><td>semget</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semget">âš ï¸</a></td></tr>
<tr><td>65</td><td>semop</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semop-and-semtimedop">âš ï¸</a></td></tr>
<tr><td>66</td><td>semctl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semctl">âš ï¸</a></td></tr>
<tr><td>67</td><td>shmdt</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>68</td><td>msgget</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>69</td><td>msgsnd</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>70</td><td>msgrcv</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>71</td><td>msgctl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>72</td><td>fcntl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#fcntl">âš ï¸</a></td></tr>
<tr><td>73</td><td>flock</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>74</td><td>fsync</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>75</td><td>fdatasync</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>76</td><td>truncate</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>77</td><td>ftruncate</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>78</td><td>getdents</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>79</td><td>getcwd</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>80</td><td>chdir</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>81</td><td>fchdir</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>82</td><td>rename</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>83</td><td>mkdir</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>84</td><td>rmdir</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>85</td><td>creat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>86</td><td>link</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>87</td><td>unlink</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>88</td><td>symlink</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>89</td><td>readlink</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>90</td><td>chmod</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>91</td><td>fchmod</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>92</td><td>chown</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>93</td><td>fchown</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>94</td><td>lchown</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>95</td><td>umask</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>96</td><td>gettimeofday</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>97</td><td>getrlimit</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>98</td><td>getrusage</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#getrusage">âš ï¸</a></td></tr>
<tr><td>99</td><td>sysinfo</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>100</td><td>times</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>101</td><td>ptrace</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>102</td><td>getuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>103</td><td>syslog</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>104</td><td>getgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>105</td><td>setuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>106</td><td>setgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>107</td><td>geteuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>108</td><td>getegid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>109</td><td>setpgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>110</td><td>getppid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>111</td><td>getpgrp</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>112</td><td>setsid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>113</td><td>setreuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>114</td><td>setregid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>115</td><td>getgroups</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>116</td><td>setgroups</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>117</td><td>setresuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>118</td><td>getresuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>119</td><td>setresgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>120</td><td>getresgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>121</td><td>getpgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>122</td><td>setfsuid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>123</td><td>setfsgid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>124</td><td>getsid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>125</td><td>capget</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#capget-and-capset">âš ï¸</a></td></tr>
<tr><td>126</td><td>capset</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#capget-and-capset">âš ï¸</a></td></tr>
<tr><td>127</td><td>rt_sigpending</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>128</td><td>rt_sigtimedwait</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>129</td><td>rt_sigqueueinfo</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>130</td><td>rt_sigsuspend</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>131</td><td>sigaltstack</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>132</td><td>utime</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>133</td><td>mknod</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>134</td><td>uselib</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>135</td><td>personality</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>136</td><td>ustat</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>137</td><td>statfs</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>138</td><td>fstatfs</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>139</td><td>sysfs</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>140</td><td>getpriority</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>141</td><td>setpriority</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>142</td><td>sched_setparam</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>143</td><td>sched_getparam</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>144</td><td>sched_setscheduler</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_setscheduler">âš ï¸</a></td></tr>
<tr><td>145</td><td>sched_getscheduler</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>146</td><td>sched_get_priority_max</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>147</td><td>sched_get_priority_min</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>148</td><td>sched_rr_get_interval</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>149</td><td>mlock</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>150</td><td>munlock</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>151</td><td>mlockall</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>152</td><td>munlockall</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>153</td><td>vhangup</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>154</td><td>modify_ldt</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>155</td><td>pivot_root</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>156</td><td>_sysctl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>157</td><td>prctl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#prctl">âš ï¸</a></td></tr>
<tr><td>158</td><td>arch_prctl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#arch_prctl">âš ï¸</a></td></tr>
<tr><td>159</td><td>adjtimex</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>160</td><td>setrlimit</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>161</td><td>chroot</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>162</td><td>sync</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>163</td><td>acct</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>164</td><td>settimeofday</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>165</td><td>mount</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#mount">âš ï¸</a></td></tr>
<tr><td>166</td><td>umount2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#umount-and-umount2">âš ï¸</a></td></tr>
<tr><td>167</td><td>swapon</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>168</td><td>swapoff</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>169</td><td>reboot</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#reboot">âš ï¸</a></td></tr>
<tr><td>170</td><td>sethostname</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>171</td><td>setdomainname</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>172</td><td>iopl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>173</td><td>ioperm</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>174</td><td>create_module</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>175</td><td>init_module</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>176</td><td>delete_module</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>177</td><td>get_kernel_syms</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>178</td><td>query_module</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>179</td><td>quotactl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>180</td><td>nfsservctl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>181</td><td>getpmsg</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>182</td><td>putpmsg</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>183</td><td>afs_syscall</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>184</td><td>tuxcall</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>185</td><td>security</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>186</td><td>gettid</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>187</td><td>readahead</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>188</td><td>setxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>189</td><td>lsetxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>190</td><td>fsetxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>191</td><td>getxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>192</td><td>lgetxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>193</td><td>fgetxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>194</td><td>listxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>195</td><td>llistxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>196</td><td>flistxattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>197</td><td>removexattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>198</td><td>lremovexattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>199</td><td>fremovexattr</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>200</td><td>tkill</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>201</td><td>time</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>202</td><td>futex</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#futex">âš ï¸</a></td></tr>
<tr><td>203</td><td>sched_setaffinity</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>204</td><td>sched_getaffinity</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>205</td><td>set_thread_area</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>206</td><td>io_setup</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>207</td><td>io_destroy</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>208</td><td>io_getevents</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>209</td><td>io_submit</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>210</td><td>io_cancel</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>211</td><td>get_thread_area</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>212</td><td>lookup_dcookie</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>213</td><td>epoll_create</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>214</td><td>epoll_ctl_old</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>215</td><td>epoll_wait_old</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>216</td><td>remap_file_pages</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>217</td><td>getdents64</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>218</td><td>set_tid_address</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>219</td><td>restart_syscall</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>220</td><td>semtimedop</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication#semop-and-semtimedop">âš ï¸</a></td></tr>
<tr><td>221</td><td>fadvise64</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#fadvise64">âš ï¸</a></td></tr>
<tr><td>222</td><td>timer_create</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timer_create">âš ï¸</a></td></tr>
<tr><td>223</td><td>timer_settime</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>224</td><td>timer_gettime</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>225</td><td>timer_getoverrun</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>226</td><td>timer_delete</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>227</td><td>clock_settime</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>228</td><td>clock_gettime</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#clock_gettime">âš ï¸</a></td></tr>
<tr><td>229</td><td>clock_getres</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>230</td><td>clock_nanosleep</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#clock_nanosleep">âš ï¸</a></td></tr>
<tr><td>231</td><td>exit_group</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>232</td><td>epoll_wait</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>233</td><td>epoll_ctl</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#epoll_ctl">âš ï¸</a></td></tr>
<tr><td>234</td><td>tgkill</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>235</td><td>utimes</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>236</td><td>vserver</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>237</td><td>mbind</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>238</td><td>set_mempolicy</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>239</td><td>get_mempolicy</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>240</td><td>mq_open</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>241</td><td>mq_unlink</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>242</td><td>mq_timedsend</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>243</td><td>mq_timedreceive</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>244</td><td>mq_notify</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>245</td><td>mq_getsetattr</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>246</td><td>kexec_load</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>247</td><td>waitid</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#waitid">âš ï¸</a></td></tr>
<tr><td>248</td><td>add_key</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>249</td><td>request_key</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>250</td><td>keyctl</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>251</td><td>ioprio_set</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioprio_set-and-ioprio_get">âš ï¸</a></td></tr>
<tr><td>252</td><td>ioprio_get</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#ioprio_set-and-ioprio_get">âš ï¸</a></td></tr>
<tr><td>253</td><td>inotify_init</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>254</td><td>inotify_add_watch</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#inotify_add_watch">âš ï¸</a></td></tr>
<tr><td>255</td><td>inotify_rm_watch</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>256</td><td>migrate_pages</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>257</td><td>openat</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#open-and-openat">âš ï¸</a></td></tr>
<tr><td>258</td><td>mkdirat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>259</td><td>mknodat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>260</td><td>fchownat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>261</td><td>futimesat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>262</td><td>newfstatat</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#newfstatat">âš ï¸</a></td></tr>
<tr><td>263</td><td>unlinkat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>264</td><td>renameat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>265</td><td>linkat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>266</td><td>symlinkat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>267</td><td>readlinkat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>268</td><td>fchmodat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>269</td><td>faccessat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>270</td><td>pselect6</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>271</td><td>ppoll</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#poll-and-ppoll">âš ï¸</a></td></tr>
<tr><td>272</td><td>unshare</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#unshare">âš ï¸</a></td></tr>
<tr><td>273</td><td>set_robust_list</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>274</td><td>get_robust_list</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>275</td><td>splice</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>276</td><td>tee</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>277</td><td>sync_file_range</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>278</td><td>vmsplice</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>279</td><td>move_pages</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>280</td><td>utimensat</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#utimensat">âš ï¸</a></td></tr>
<tr><td>281</td><td>epoll_pwait</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>282</td><td>signalfd</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>283</td><td>timerfd_create</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timerfd_create">âš ï¸</a></td></tr>
<tr><td>284</td><td>eventfd</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>285</td><td>fallocate</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#fallocate">âš ï¸</a></td></tr>
<tr><td>286</td><td>timerfd_settime</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers#timerfd_settime">âš ï¸</a></td></tr>
<tr><td>287</td><td>timerfd_gettime</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>288</td><td>accept4</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#accept-and-accept4">âš ï¸</a></td></tr>
<tr><td>289</td><td>signalfd4</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>290</td><td>eventfd2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#eventfd-and-eventfd2">âš ï¸</a></td></tr>
<tr><td>291</td><td>epoll_create1</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>292</td><td>dup3</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>293</td><td>pipe2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#pipe-and-pipe2">âš ï¸</a></td></tr>
<tr><td>294</td><td>inotify_init1</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control#inotify_init-and-inotify_init1">âš ï¸</a></td></tr>
<tr><td>295</td><td>preadv</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>296</td><td>pwritev</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>297</td><td>rt_tgsigqueueinfo</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>298</td><td>perf_event_open</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>299</td><td>recvmmsg</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>300</td><td>fanotify_init</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>301</td><td>fanotify_mark</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>302</td><td>prlimit64</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>303</td><td>name_to_handle_at</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>304</td><td>open_by_handle_at</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>305</td><td>clock_adjtime</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>306</td><td>syncfs</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>307</td><td>sendmmsg</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets#sendto-sendmsg-and-sendmmsg">âš ï¸</a></td></tr>
<tr><td>308</td><td>setns</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security#setns">âš ï¸</a></td></tr>
<tr><td>309</td><td>getcpu</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>310</td><td>process_vm_readv</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>311</td><td>process_vm_writev</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>312</td><td>kcmp</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>313</td><td>finit_module</td><td>âŒ</td><td>N/A</td></tr>
<tr><td>314</td><td>sched_setattr</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_getattr-and-sched_setattr">âš ï¸</a></td></tr>
<tr><td>315</td><td>sched_getattr</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#sched_getattr-and-sched_setattr">âš ï¸</a></td></tr>
<tr><td>316</td><td>renameat2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#renameat2">âš ï¸</a></td></tr>
<tr><td>318</td><td>getrandom</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc#getrandom">âš ï¸</a></td></tr>
<tr><td>319</td><td>memfd_create</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control#memfd_create">âš ï¸</a></td></tr>
<tr><td>322</td><td>execveat</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>327</td><td>preadv2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#preadv2-and-pwritev2">âš ï¸</a></td></tr>
<tr><td>328</td><td>pwritev2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#preadv2-and-pwritev2">âš ï¸</a></td></tr>
<tr><td>332</td><td>statx</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#statx">âš ï¸</a></td></tr>
<tr><td>424</td><td>pidfd_send_signal</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>434</td><td>pidfd_open</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>435</td><td>clone3</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management#clone-and-clone3">âš ï¸</a></td></tr>
<tr><td>436</td><td>close_range</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>438</td><td>pidfd_getfd</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>439</td><td>faccessat2</td><td>âœ…</td><td><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations#faccessat2">âš ï¸</a></td></tr>
<tr><td>441</td><td>epoll_pwait2</td><td>âœ…</td><td>ğŸ’¯</td></tr>
<tr><td>452</td><td>fchmodat2</td><td>âœ…</td><td>ğŸ’¯</td></tr>
</tbody>
</table>
</div>
<ul>
<li>
<p>Supported:</p>
<ul>
<li>âœ… = syscall supported</li>
<li>âŒ = not supported</li>
</ul>
</li>
<li>
<p>Flag Coverage:</p>
<ul>
<li>ğŸ’¯ = all flags/commands/modes are supported</li>
<li>âš ï¸ = syscall works, but some flags/modes are not implemented</li>
<li>â“ = implementation exists, but we have not audited its coverage yet</li>
<li>N/A = not applicable (e.g., syscall not supported)</li>
</ul>
</li>
</ul>
<p>Most of these system calls (or their variants) are also supported for the RISC-V and LoongArch architectures.</p>
<h2 id="file-systems"><a class="header" href="#file-systems">File Systems</a></h2>
<p>Here is the list of supported file systems:</p>
<ul>
<li>Devfs</li>
<li>Devpts</li>
<li>Ext2</li>
<li>Procfs</li>
<li>Ramfs</li>
</ul>
<h2 id="sockets"><a class="header" href="#sockets">Sockets</a></h2>
<p>Here is the list of supported socket types:</p>
<ul>
<li>TCP sockets over IPv4</li>
<li>UDP sockets over IPv4</li>
<li>Unix sockets</li>
</ul>
<h2 id="vdso"><a class="header" href="#vdso">vDSO</a></h2>
<p>Here is the list of supported symbols in vDSO:</p>
<ul>
<li><code>__vdso_clock_gettime</code></li>
<li><code>__vdso_gettimeofday</code></li>
<li><code>__vdso_time</code></li>
</ul>
<h2 id="boot-protocols"><a class="header" href="#boot-protocols">Boot Protocols</a></h2>
<p>Here is the list of supported boot protocols:</p>
<ul>
<li><a href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html">Multiboot</a></li>
<li><a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">Multiboot2</a></li>
<li><a href="https://www.kernel.org/doc/html/v5.4/x86/boot.html#bit-boot-protocol">Linux 32-bit boot protocol</a></li>
<li><a href="https://www.kernel.org/doc/html/v5.4/x86/boot.html#efi-handover-protocol">Linux EFI handover</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="syscall-flag-coverage"><a class="header" href="#syscall-flag-coverage">Syscall Flag Coverage</a></h1>
<p>This section documents the flag coverage of Asterinasâ€™s implementation of Linux system calls. It introduces <a href="#system-call-matching-language-scml"><strong>System Call Matching Language (SCML)</strong></a>, a lightweight domainâ€‘specific language for specifying allowed and disallowed patterns of systemâ€‘call invocations.</p>
<p>The rest of this section uses SCML to accurately and concisely describe both supported and unsupported functionality of system calls, which are divided into the following categories:</p>
<ul>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/process-and-thread-management">é€²ç¨‹èˆ‡åŸ·è¡Œç·’ç®¡ç†</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/memory-management">è¨˜æ†¶é«”ç®¡ç†</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-and-directory-operations">File &amp; directory operations</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-systems-and-mount-control">æª”æ¡ˆç³»çµ±èˆ‡æ›è¼‰æ§åˆ¶</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/file-descriptor-and-io-control">æª”æ¡ˆæè¿°å­èˆ‡ I/O æ§åˆ¶</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/inter-process-communication">é€²ç¨‹é–“é€šè¨Š</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/networking-and-sockets">Networking &amp; sockets</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/signals-and-timers">è¨Šè™Ÿèˆ‡è¨ˆæ™‚å™¨</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/namespaces-cgroups-and-security">Namespaces, cgroups &amp; security</a></li>
<li><a href="kernel/linux-compatibility/syscall-flag-coverage/system-information-and-misc">System information &amp; misc</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="system-call-matching-language-scml"><a class="header" href="#system-call-matching-language-scml">System Call Matching Language (SCML)</a></h1>
<p>SCML specifies matching patterns for systemâ€‘call invocations. Asterinas developers can easily write SCML rules to describe supported patterns. Likewise, users and developers can intuitively read these rules to understand which system calls and features are available.</p>
<p>SCML is designed to integrate seamlessly with <a href="https://man7.org/linux/man-pages/man1/strace.1.html">strace</a>, the standard Linux systemâ€‘call tracer. Strace emits each invocation in a Câ€‘style syntax; given a set of SCML rules, a tool can automatically determine whether a strace log entry conforms to the supported patterns. This paves the way for an SCMLâ€‘based analyzer that reports unsupported calls in any applicationâ€™s trace.</p>
<h2 id="strace-a-quick-example"><a class="header" href="#strace-a-quick-example">Strace: A Quick Example</a></h2>
<p>To illustrate, run strace on a simple â€œHello, World!â€ program:</p>
<pre><code class="language-bash">$ strace ./hello_world
</code></pre>
<p>A typical trace might look like this:</p>
<pre><code class="language-shell">execve("./hello_world", ["./hello_world"], 0xffffffd3f710 /* 4 vars */) = 0
brk(NULL)                               = 0xaaaabdc1b000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xffff890f4000
openat(AT_FDCWD, "/lib/aarch64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0\360\206\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=1722920, ...}) = 0
â€¦
write(1, "Hello, World!\n", 14)         = 14
exit_group(0)                           = ?
</code></pre>
<p>Key points of this output:</p>
<ul>
<li>System calls are rendered as <code>name(arg1, â€¦, argN)</code>.</li>
<li>Flags appear as <code>FLAG1|FLAG2|â€¦|FLAGN</code>.</li>
<li>Structs use <code>{field1=value1, â€¦}</code>.</li>
<li>Arrays are shown as <code>[value1, â€¦]</code>.</li>
</ul>
<p>SCMLâ€™s syntax draws directly from these conventions.</p>
<h2 id="scml-by-example"><a class="header" href="#scml-by-example">SCML by Example</a></h2>
<p>SCML is intentionally simple: most Linux systemâ€‘call semantics hinge on bitflags. SCML rules act as templates: you define a rule once, and a human or an analyzer uses it to check if a syscall invocation matches it or not.</p>
<p>Imagine youâ€™re developing a Linux-compatible OS (like Asterinas) that supports just a restricted subset of syscalls and their options. We will use SCML to describe the restricted functionality.</p>
<h3 id="matching-rules-for-system-calls"><a class="header" href="#matching-rules-for-system-calls">Matching Rules for System Calls</a></h3>
<p>For example, your OS supports the <a href="https://man7.org/linux/man-pages/man2/openat.2.html"><code>open</code></a> system call with one or more of the four flags: <code>O_RDONLY</code>, <code>O_WRONLY</code>, <code>O_RDWR</code>, and <code>O_CLOEXEC</code>: This constraint can be expressed in the following system call matching rule.</p>
<pre><code class="language-c">open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC);
</code></pre>
<p>To allow file creation, you add another matching rule that includes the <code>O_CREAT</code> flag and requires a <code>mode</code> argument:</p>
<pre><code class="language-c">open(path, flags = O_CREAT | O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, mode);
</code></pre>
<p>To support the <code>O_PATH</code> flag (only valid with <code>O_CLOEXEC</code>, not with  <code>O_RDONLY</code>, <code>O_WRONLY</code>, or <code>O_RDWR</code>), you add a third matching rule:</p>
<pre><code class="language-c">open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<p>SCML rules constrain only the flagged arguments; other parameters (like <code>path</code> and <code>mode</code>) accept any value.</p>
<p>In many system calls, the number of arguments may vary depending on the flags provided. To accommodate this, SCML allows you to use the <code>..</code> wildcard in the parameter list. This indicates that any additional arguments are accepted, regardless of their value or count.</p>
<p>For example:</p>
<pre><code class="language-c">open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, ..);
</code></pre>
<p>Here, the <code>..</code> wildcard makes the rule flexible enough to match invocations of <code>open</code> with extra parameters, such as when the <code>O_CREAT</code> flag is present and a <code>mode</code> argument is required. This approach makes it easy to write concise rules that only constrain the arguments of interest, while allowing other parameters to vary as needed.</p>
<h3 id="c-style-comments"><a class="header" href="#c-style-comments">C-Style Comments</a></h3>
<p>SCML also supports Câ€‘style comments:</p>
<pre><code class="language-c">// All matching rules for the open syscall.
// A supported invocation of the open syscall must match at least one of the rules.
open(path, flags = O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC);
open(path, flags = O_CREAT | O_RDONLY | O_WRONLY | O_RDWR | O_CLOEXEC, mode);
open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<h3 id="matching-rules-for-bitflags"><a class="header" href="#matching-rules-for-bitflags">Matching Rules for Bitflags</a></h3>
<p>Above, we embedded flag combinations directly within individual systemâ€‘call rules, which can lead to duplication and make maintenance harder. SCML allows you to define named bitflag rules that can be reused across multiple rules. This reduces repetition and centralizes your flag definitions. For example:</p>
<pre><code class="language-c">// Define a reusable bitflags rule
access_mode = O_RDONLY | O_WRONLY | O_RDWR;

open(path, flags = &lt;access_mode&gt; | O_CLOEXEC);
open(path, flags = O_CREAT | &lt;access_mode&gt; | O_CLOEXEC, mode);
open(path, flags = O_PATH | O_CLOEXEC);
</code></pre>
<h3 id="matching-rules-for-structs"><a class="header" href="#matching-rules-for-structs">Matching Rules for Structs</a></h3>
<p>SCML can match flags inside struct fields. Consider <a href="https://man7.org/linux/man-pages/man2/sigaction.2.html"><code>sigaction</code></a>:</p>
<pre><code class="language-c">struct sigaction = {
    sa_flags = SA_NOCLDSTOP | SA_NOCLDWAIT,
    ..
};
</code></pre>
<p>Here, <code>..</code> is a wildcard for remaining fields that we do not care.</p>
<p>Then, we can write a system call rule that refers to the struct rule using the <code>&lt;struct_rule&gt;</code> syntax.</p>
<pre><code class="language-c">sigaction(signum, act = &lt;sigaction&gt;, oldact = &lt;sigaction&gt;);
</code></pre>
<p>Instead of defining a separate struct rule, you can also inline the struct pattern directly in the parameter list. This is convenient when the struct pattern is only used once or when you want to express different constraints for the same struct type in different contexts.</p>
<p>For example, the following rule inlines the struct pattern for <code>capget</code>:</p>
<pre><code class="language-c">capget(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);
</code></pre>
<h3 id="matching-rules-for-arrays"><a class="header" href="#matching-rules-for-arrays">Matching Rules for Arrays</a></h3>
<p>SCML can describe how to match flags embedded inside the struct values of an array. This is the case of the <a href="https://man7.org/linux/man-pages/man2/poll.2.html"><code>poll</code></a> system call. It takes an array of values of <code>struct pollfd</code>, whose <code>event</code> and <code>revents</code> fields are bitflags.</p>
<pre><code class="language-c">// Support all but the POLLPRI flags
events = POLLIN | POLLOUT | POLLRDHUP | POLLERR | POLLHUP | POLLNVAL;

struct pollfd = {
    events  = &lt;events&gt;,
    revents = &lt;events&gt;,
    ..
};

poll(fds = [ &lt;pollfd&gt; ], nfds, timeout);
</code></pre>
<p>Notice how SCML denotes an array with the <code>[ &lt;struct_rule&gt; ]</code> syntax.</p>
<h3 id="special-built-in-matching-rules"><a class="header" href="#special-built-in-matching-rules">Special Built-in Matching Rules</a></h3>
<p>Bitflags-based matching rules described above are expressive enough to capture most patterns of interesting system call arguments. But some system call arguments cannot be characterized with bitflags. To address such cases, SCML introduces two special built-in matching rules: <code>&lt;PATH&gt;</code> and <code>&lt;INTEGER&gt;</code></p>
<h4 id="the-file-path-matching-rule"><a class="header" href="#the-file-path-matching-rule">The file path matching rule</a></h4>
<p>The <code>&lt;PATH&gt;</code> matching rule is used to denote a system call argument of a C-string file path. For example, the matching rules for the <code>open</code> system call can be enhanced with <code>&lt;PATH&gt;</code> as follows:</p>
<pre><code class="language-c">access_mode = O_RDONLY | O_WRONLY | O_RDWR;

open(path = &lt;PATH&gt;, flags = &lt;access_mode&gt; | O_CLOEXEC);
open(path = &lt;PATH&gt;, flags = O_CREAT | &lt;access_mode&gt; | O_CLOEXEC, mode);
open(path = &lt;PATH&gt;, flags = O_PATH | O_CLOEXEC);
</code></pre>
<p>File paths provide a new dimension to determine whether a system call is supported or not. Linux has multiple pseudo file systems such as DevTmpFS, ProcFS, SysFS, CgroupFS, and ConfigFS, mounted at well-known locations. A Linux-compatible OS such as Asterinas may only support a sub-tree of an pseudo FS. Knowing which system call arguments refer to file paths, a tool may be built to automatically issue warnings when unsupported file paths are accessed by system calls.</p>
<h4 id="the-integer-matching-rule"><a class="header" href="#the-integer-matching-rule">The integer matching rule</a></h4>
<p>The <code>&lt;INTEGER&gt;</code> matching rule can match any integer system call argument such as <code>1234</code>, <code>-100</code>, <code>0xdeadbeef</code>, and <code>0o666</code>. It can be used as a fallback rule when a system call takes an argument of either bitflags or integer.</p>
<pre><code class="language-c">timer_create(
    clockid =
        // Static clock IDs represented as bitflags
        CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID | CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_BOOTTIME |
        // Dynamic clock IDs (per-process or per-thread clock IDs)
        // represented as an integer value.
        &lt;INTEGER&gt;,
    sevp,
    timerid
);
</code></pre>
<h3 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced Usage</a></h3>
<p>Just like you can write multiple rules of the same system call, you may define multiple rules for the same struct:</p>
<pre><code class="language-c">// Rules for control message header
struct cmsghdr = {
    cmsg_level = SOL_SOCKET,
    cmsg_type  = SO_TIMESTAMP_OLD | SCM_RIGHTS | SCM_CREDENTIALS,
    ..
};
struct cmsghdr = {
    cmsg_level = SOL_IP,
    cmsg_type  = IP_TTL,
    ..
};
</code></pre>
<p>A <code>cmsghdr</code> value matches if it satisfies any one rule.</p>
<p>Struct rules may also be nested:</p>
<pre><code class="language-c">// Rule for message header, which refers to the rules for control message header
struct msghdr = {
    msg_control = [ &lt;cmsghdr&gt; ],
    ..
};

recvmsg(socket, message = &lt;msghdr&gt;, flags);
</code></pre>
<p>SCML supports arrays with nested structures and heterogeneous element types, as encountered in system calls like <code>recvmsg</code> where netlink message payloads follow the TLV (Type-Length-Value) format. Arrays can contain multiple elements of varying types: inline struct patterns (<code>{ ... }</code>), nested arrays (<code>[ ... ]</code>), or references to named rules (<code>&lt;identifier&gt;</code>). This flexibility allows SCML to represent hierarchical data structures as they appear in strace output.</p>
<p>For example, when receiving a netlink message about adding a network address:</p>
<pre><code class="language-c">struct iovec = {
    iov_base = [
        [
            {
                nlmsg_type = RTM_NEWADDR,
                ..
            },
            [
                [ { nla_type = IFA_CACHEINFO, .. } ]
            ]
        ]
    ],
    ..
};

recvmsg(
    sockfd,
    msg = {
        msg_iov = [ &lt;iovec&gt; ],
        ..
    },
    flags
);
</code></pre>
<p>This example demonstrates receiving a netlink message of type <code>RTM_NEWADDR</code> containing nested attributes with cache information (<code>IFA_CACHEINFO</code>). The nested array structure illustrates how SCML handles heterogeneous arrays where elements can be both structs and nested arrays, reflecting the hierarchical TLV encoding typical of netlink.</p>
<h2 id="formal-syntax"><a class="header" href="#formal-syntax">Formal Syntax</a></h2>
<p>Below is the formal syntax of SCML, expressed in Extended Backusâ€“Naur Form (EBNF). Nonâ€‘terminals are in angle brackets, terminals in quotes.</p>
<pre><code>&lt;scml&gt;           ::= { &lt;rule&gt; }
&lt;rule&gt;           ::= &lt;syscall-rule&gt; ';' 
                   | &lt;struct-rule&gt; ';'
                   | &lt;bitflags-rule&gt; ';'

&lt;syscall-rule&gt;   ::= &lt;identifier&gt; '(' [ &lt;param-list&gt; ] ')'
&lt;param-list&gt;     ::= '..'
                   | &lt;param&gt; { ',' &lt;param&gt; } [ ',' '..' ]
&lt;param&gt;          ::= &lt;identifier&gt; '=' &lt;flag-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;struct-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;array-pattern&gt;
                   | &lt;identifier&gt;

&lt;flag-pattern&gt;   ::= &lt;flag-part&gt; { '|' &lt;flag-part&gt; }
&lt;flag-part&gt;      ::= &lt;identifier&gt;
                   | '&lt;' &lt;identifier&gt; '&gt;'

&lt;array-pattern&gt;  ::= '[' &lt;array-element&gt; { ',' &lt;array-element&gt; } ']'
&lt;array-element&gt;  ::= '&lt;' &lt;identifier&gt; '&gt;'
                   | &lt;struct-pattern&gt;
                   | &lt;array-pattern&gt;

&lt;struct-rule&gt;    ::= 'struct' &lt;identifier&gt; '=' &lt;struct-pattern&gt;
&lt;struct-pattern&gt; ::= '{' &lt;field-list&gt; [ ',' '..' ] '}'
&lt;field-list&gt;     ::= &lt;field&gt; { ',' &lt;field&gt; }
&lt;field&gt;          ::= &lt;identifier&gt;
                   | &lt;identifier&gt; '=' &lt;flag-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;struct-pattern&gt;
                   | &lt;identifier&gt; '=' &lt;array-pattern&gt;

&lt;bitflags-rule&gt;  ::= &lt;identifier&gt; '=' &lt;flag-pattern&gt;

&lt;identifier&gt;     ::= letter { letter | digit | '_' }

comment          ::= '//' { any-char }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="process--thread-management"><a class="header" href="#process--thread-management">Process &amp; Thread Management</a></h1>
<!--
Put system calls such as
fork, vfork, clone, execve, exit, exit_group, wait4, waitid,
getpid, getppid, gettid, setuid, setgid, getuid, getgid, and prctl
under this category.
-->
<h3 id="sched_getattr-and-sched_setattr"><a class="header" href="#sched_getattr-and-sched_setattr"><code>sched_getattr</code> and <code>sched_setattr</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Get the scheduling policy of a "normal" thread
sched_getattr(
    pid,
    attr = {
        sched_policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
// Set the scheduling policy of a "normal" thread
sched_setattr(
    pid,
    attr = {
        sched_policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE,
        sched_flags = 0,
        ..
    },
    flags = 0,
);

// Get the scheduling policy of a real-time thread
sched_getattr(
    pid,
    attr = {
        sched_policy = SCHED_FIFO | SCHED_RR,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
// Set the scheduling policy of a real-time thread
sched_setattr(
    pid,
    attr = {
        sched_policy = SCHED_FIFO | SCHED_RR,
        sched_flags = 0,
        ..
    },
    flags = 0,
);
</code></pre>
<p>Unsupported scheduling policies:</p>
<ul>
<li><code>SCHED_DEADLINE</code></li>
</ul>
<p>Unsupported scheduling flags:</p>
<ul>
<li><code>SCHED_FLAG_RESET_ON_FORK</code></li>
<li><code>SCHED_FLAG_RECLAIM</code></li>
<li><code>SCHED_FLAG_DL_OVERRUN</code></li>
<li><code>SCHED_FLAG_UTIL_CLAMP_MIN</code></li>
<li><code>SCHED_FLAG_UTIL_CLAMP_MAX</code></li>
</ul>
<h3 id="wait4"><a class="header" href="#wait4"><code>wait4</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Wait until a specified child process undergoes a state change (termination, stopping and resumption)
wait4(
    pid, wstatus,
    options = WNOHANG | WSTOPPED | WCONTINUED | WNOWAIT,
    rusage
);
</code></pre>
<p>Ignored options:</p>
<ul>
<li><code>WEXITED</code></li>
<li><code>WNOTHREAD</code></li>
<li><code>WALL</code></li>
<li><code>WCLONE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/wait4.2.html">the man page</a>.</p>
<h3 id="clone-and-clone3"><a class="header" href="#clone-and-clone3"><code>clone</code> and <code>clone3</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">signal_flags = SIGHUP | SIGINT | SIGQUIT | SIGILL |
               SIGTRAP | SIGABRT | SIGSTKFLT | SIGFPE |
               SIGKILL | SIGBUS | SIGSEGV | SIGXCPU |
               SIGPIPE | SIGALRM | SIGTERM | SIGUSR1 |
               SIGUSR2 | SIGCHLD | SIGPWR | SIGVTALRM |
               SIGPROF | SIGIO | SIGWINCH | SIGSTOP |
               SIGTSTP | SIGCONT | SIGTTIN | SIGTTOU |
               SIGURG | SIGXFSZ | SIGSYS | SIGRTMIN;

opt_flags =
    // Optional flags
    //
    // Share the parent's virtual memory
    CLONE_VM |
    // Share the parent's filesystem
    CLONE_FS |
    // Share the parent's file descriptor table
    CLONE_FILES |
    // Share the parent's signal handlers
    CLONE_SIGHAND |
    // Place child in the same thread group as parent
    CLONE_THREAD |
    // Share the parent's System V semaphore adjustments
    CLONE_SYSVSEM |
    // Suspend parent until the child exits or calls `execve`
    CLONE_VFORK |
    // Create a new mount namespace for the child
    CLONE_NEWNS |
    // Write child `TID` to parent's memory
    CLONE_PARENT_SETTID |
    // Allocate a `PID` file descriptor for the child
    CLONE_PIDFD |
    // Set thread-local storage for the child
    CLONE_SETTLS |
    // Write child `TID` to child's memory
    CLONE_CHILD_SETTID |
    // Clear child `TID` in child's memory on exit
    CLONE_CHILD_CLEARTID |
    // Make the child's parent the same as the caller's parent
    CLONE_PARENT;

// Create a thread or process
clone(
    fn, stack,
    flags = &lt;opt_flags&gt; | &lt;signal_flags&gt;,
    func_arg, ..
);

// Create a thread or process with enhanced control by providing structured arguments
clone3(
    clone_args = {
        flags = &lt;opt_flags&gt;,
        ..
    },
    size
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/clone.2.html">the man page</a>.</p>
<h3 id="sched_setscheduler"><a class="header" href="#sched_setscheduler"><code>sched_setscheduler</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Set scheduling policy
sched_setscheduler(pid, policy = SCHED_OTHER | SCHED_BATCH | SCHED_IDLE | SCHED_FIFO | SCHED_RR, param);
</code></pre>
<p>Unsupported policies or flags:</p>
<ul>
<li><code>SCHED_RESET_ON_FORK</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/sched_setscheduler.2.html">the man page</a>.</p>
<h3 id="waitid"><a class="header" href="#waitid"><code>waitid</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Wait for a child process to change state
waitid(
    which = P_PID | P_PIDFD | P_PGID | P_ALL,
    pid, infop,
    options = WNOHANG | WSTOPPED | WCONTINUED | WNOWAIT,
    ru
);
</code></pre>
<p>Ignored options:</p>
<ul>
<li><code>WEXITED</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/waitid.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="è¨˜æ†¶é«”ç®¡ç†"><a class="header" href="#è¨˜æ†¶é«”ç®¡ç†">è¨˜æ†¶é«”ç®¡ç†</a></h1>
<!--
Put system calls such as 
brk, mmap, munmap, mprotect, mremap, msync, mincore, madvise, 
shmget, shmat, shmctl, mlock, munlock, mbind, and set_mempolicy
under this part.
-->
<h2 id="è¨˜æ†¶é«”æ˜ å°„"><a class="header" href="#è¨˜æ†¶é«”æ˜ å°„">è¨˜æ†¶é«”æ˜ å°„</a></h2>
<h3 id="mmap-and-munmap"><a class="header" href="#mmap-and-munmap"><code>mmap</code> and <code>munmap</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">prot = PROT_NONE |
    PROT_EXEC |
    PROT_READ |
    PROT_WRITE;
opt_flags =
    MAP_ANONYMOUS |
    MAP_FIXED |
    MAP_FIXED_NOREPLACE |
    MAP_GROWSDOWN |
    MAP_HUGETLB |
    MAP_LOCKED |
    MAP_NONBLOCK |
    MAP_NORESERVE |
    MAP_POPULATE;

// Create a private memory mapping
mmap(
    addr, length,
    prot = &lt;prot&gt;,
    flags = MAP_PRIVATE | &lt;opt_flags&gt;,
    fd, offset
);

// Create a shared memory mapping
mmap(
    addr, length,
    prot = &lt;prot&gt;,
    flags = MAP_SHARED | MAP_SHARED_VALIDATE | &lt;opt_flags&gt;,
    fd, offset
);

// Unmap a memory mapping
munmap(addr, length);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MAP_HUGETLB</code></li>
<li><code>MAP_GROWSDOWN</code></li>
<li><code>MAP_LOCKED</code></li>
<li><code>MAP_NONBLOCK</code></li>
<li><code>MAP_NORESERVE</code></li>
<li><code>MAP_POPULATE</code></li>
</ul>
<p>Partially supported flags:</p>
<ul>
<li><code>MAP_FIXED_NOREPLACE</code> is treated as <code>MAP_FIXED</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>MAP_32BIT</code></li>
<li><code>MAP_HUGE_1GB</code></li>
<li><code>MAP_HUGE_2MB</code></li>
<li><code>MAP_UNINITIALIZED</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">the man page</a>.</p>
<h3 id="msync"><a class="header" href="#msync"><code>msync</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Flush memory region to disk asynchronously
msync(
    addr, length,
    flags = MS_ASYNC | MS_INVALIDATE
);

// Flush memory region to disk synchronously
msync(
    addr, length,
    flags = MS_SYNC | MS_INVALIDATE
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MS_INVALIDATE</code> is ignored because all processes use the same page cache</li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/msync.2.html">the man page</a>.</p>
<h3 id="mremap"><a class="header" href="#mremap"><code>mremap</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Resize an existing memory mapping. Relocation is allowed if given `MREMAP_MAYMOVE`.
mremap(
    old_address,
    old_size,
    new_size,
    flags = MREMAP_MAYMOVE
);

// Resize an existing memory mapping and force relocation to a specified location.
mremap(
    old_address,
    old_size,
    new_size,
    flags = MREMAP_MAYMOVE | MREMAP_FIXED,
    new_address
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/mremap.2.html">the man page</a>.</p>
<h3 id="mprotect"><a class="header" href="#mprotect"><code>mprotect</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">prot = PROT_NONE |
    PROT_EXEC |
    PROT_READ |
    PROT_WRITE;

// Set memory access permissions
mprotect(
    addr,
    len,
    prot = &lt;prot&gt;
);
</code></pre>
<p>Silently-ignored protection flags:</p>
<ul>
<li><code>PROT_SEM</code></li>
<li><code>PROT_SAO</code></li>
<li><code>PROT_GROWSUP</code></li>
<li><code>PROT_GROWSDOWN</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/mprotect.2.html">the man page</a>.</p>
<h3 id="madvise"><a class="header" href="#madvise"><code>madvise</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Do not expect access in the near future and free associated resources
madvise(addr, length, advice = MADV_DONTNEED);
</code></pre>
<p>Silently-ignored advice:</p>
<ul>
<li><code>MADV_NORMAL</code></li>
<li><code>MADV_RANDOM</code></li>
<li><code>MADV_SEQUENTIAL</code></li>
<li><code>MADV_WILLNEED</code></li>
<li><code>MADV_FREE</code></li>
<li><code>MADV_MERGEABLE</code></li>
<li><code>MADV_UNMERGEABLE</code></li>
<li><code>MADV_HUGEPAGE</code></li>
<li><code>MADV_NOHUGEPAGE</code></li>
</ul>
<p>Unsupported advice:</p>
<ul>
<li><code>MADV_RANDOM</code></li>
<li><code>MADV_REMOVE</code></li>
<li><code>MADV_DONTFORK</code></li>
<li><code>MADV_DOFORK</code></li>
<li><code>MADV_HWPOISON</code></li>
<li><code>MADV_UNMERGEABLE</code></li>
<li><code>MADV_SOFT_OFFLINE</code></li>
<li><code>MADV_DONTDUMP</code></li>
<li><code>MADV_DODUMP</code></li>
<li><code>MADV_FREE</code></li>
<li><code>MADV_WIPEONFORK</code></li>
<li><code>MADV_KEEPONFORK</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/madvise.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-and-directory-operations"><a class="header" href="#file-and-directory-operations">File and Directory Operations</a></h1>
<!--
Put system calls such as
open, openat, creat, close, read, write, readv, writev, pread64, 
pwrite64, lseek, stat, fstat, lstat, statx, mkdir, rmdir, link, 
unlink, rename, symlink, readlink, chmod, fchmod, chown, fchown, 
utime, and utimensat
under this category.
-->
<h3 id="open-and-openat"><a class="header" href="#open-and-openat"><code>open</code> and <code>openat</code></a></h3>
<p>Supported functionality of <code>open</code> in SCML:</p>
<pre><code class="language-c">access_mode =
    O_RDONLY |
    O_WRONLY |
    O_RDWR;
creation_flags =
    O_CLOEXEC |
    O_DIRECTORY |
    O_EXCL |
    O_NOCTTY |
    O_NOFOLLOW |
    O_TRUNC;
status_flags =
    O_APPEND |
    O_ASYNC |
    O_DIRECT |
    O_LARGEFILE |
    O_NOATIME |
    O_NONBLOCK |
    O_SYNC;

// Open an existing file
open(
    path,
    flags = &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
);
openat(
    dirfd,
    path,
    flags = &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
);

// Create a new file
open(
    path,
    flags = O_CREAT | &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
    mode
);
openat(
    dirfd,
    path,
    flags = O_CREAT | &lt;access_mode&gt; | &lt;creation_flags&gt; | &lt;status_flags&gt;,
    mode
);

// Status flags that are meaningful with O_PATH
opath_valid_flags = O_CLOEXEC | O_DIRECTORY | O_NOFOLLOW;
// All other flags are ignored with O_PATH
opath_ignored_flags = O_CREAT | &lt;creation_flags&gt; | &lt;status_flags&gt;;
// Obtain a file descriptor to indicate a location in FS
open(
    path,
    flags = O_PATH | &lt;opath_valid_flags&gt; | &lt;opath_ignored_flags&gt;
);
openat(
    dirfd,
    path,
    flags = O_PATH | &lt;opath_valid_flags&gt; | &lt;opath_ignored_flags&gt;
);

// Create an unnamed file
// open(path, flags = O_TMPFILE | &lt;creation_flags&gt; | &lt;status_flags&gt;)
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>O_NOCTTY</code></li>
<li><code>O_DSYNC</code></li>
<li><code>O_SYNC</code></li>
<li><code>O_LARGEFILE</code></li>
<li><code>O_NOATIME</code></li>
<li><code>O_NOCTTY</code></li>
</ul>
<p>Partially-supported flags:</p>
<ul>
<li><code>O_PATH</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>O_TMPFILE</code></li>
</ul>
<p>Supported and unsupported functionality of <code>openat</code> are the same as <code>open</code>. The SCML rules are omitted for brevity.</p>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/openat.2.html">the man page</a>.</p>
<h3 id="renameat2"><a class="header" href="#renameat2"><code>renameat2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Rename a file, moving it between directories if required.
renameat2(olddirfd, oldpath, newdirfd, newpath, 0);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>RENAME_EXCHANGE</code></li>
<li><code>RENAME_NOREPLACE</code></li>
<li><code>RENAME_WHITEOUT</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/rename.2.html">the man page</a>.</p>
<h3 id="lseek"><a class="header" href="#lseek"><code>lseek</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Set file offset
lseek(
    fd, offset,
    whence = SEEK_SET | SEEK_CUR | SEEK_END
);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>SEEK_DATA</code></li>
<li><code>SEEK_HOLE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/lseek.2.html">the man page</a>.</p>
<h3 id="newfstatat"><a class="header" href="#newfstatat"><code>newfstatat</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Retrieve file status by file descriptor
newfstatat(
    dirfd, path, statbuf,
    flags = AT_EMPTY_PATH | AT_SYMLINK_NOFOLLOW
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_NO_AUTOMOUNT</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/newfstatat.2.html">the man page</a>.</p>
<h3 id="preadv2-and-pwritev2"><a class="header" href="#preadv2-and-pwritev2"><code>preadv2</code> and <code>pwritev2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Read data from multiple buffers
preadv2(fd, iov, iovcnt, offset, flags = 0);

// Write data to multiple buffers
pwritev2(fd, iov, iovcnt, offset, flags = 0);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>RWF_DSYNC</code></li>
<li><code>RWF_HIPRI</code></li>
<li><code>RWF_SYNC</code></li>
<li><code>RWF_NOWAIT</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>RWF_APPEND</code></li>
<li><code>RWF_NOAPPEND</code></li>
<li><code>RWF_ATOMIC</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/preadv2.2.html">the man page</a>.</p>
<h3 id="faccessat2"><a class="header" href="#faccessat2"><code>faccessat2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Check user's permissions for a file
faccessat2(
    dirfd, path, mode,
    flags = AT_EMPTY_PATH | AT_SYMLINK_NOFOLLOW
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_EACCESS</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/faccessat2.2.html">the man page</a>.</p>
<h3 id="statx"><a class="header" href="#statx"><code>statx</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">statx_flags = AT_EMPTY_PATH | AT_NO_AUTOMOUNT | AT_STATX_FORCE_SYNC |
              AT_STATX_DONT_SYNC | AT_STATX_SYNC_AS_STAT | AT_SYMLINK_NOFOLLOW;
statx_mask = STATX_TYPE | STATX_MODE | STATX_NLINK | STATX_UID | STATX_GID |
             STATX_ATIME | STATX_MTIME | STATX_CTIME | STATX_INO | STATX_SIZE |
             STATX_BLOCKS | STATX_BASIC_STATS | STATX_BTIME | STATX_ALL |
             STATX_MNT_ID | STATX_DIOALIGN | STATX_MNT_ID_UNIQUE | STATX_SUBVOL |
             STATX_WRITE_ATOMIC | STATX_DIO_READ_ALIGN;

// Get file status (extended)
statx(
    dirfd, pathname,
    flags = &lt;statx_flags&gt;,
    mask = &lt;statx_mask&gt;,
    statxbuf
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>AT_NO_AUTOMOUNT</code></li>
<li><code>AT_STATX_FORCE_SYNC</code></li>
<li><code>AT_STATX_DONT_SYNC</code></li>
</ul>
<p>Silently-ignored masks:</p>
<ul>
<li><code>STATX_DIOALIGN</code></li>
<li><code>STATX_MNT_ID_UNIQUE</code></li>
<li><code>STATX_SUBVOL</code></li>
<li><code>STATX_WRITE_ATOMIC</code></li>
<li><code>STATX_DIO_READ_ALIGN</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/statx.2.html">the man page</a>.</p>
<h3 id="fallocate"><a class="header" href="#fallocate"><code>fallocate</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Allocate disk space within the range specified
fallocate(fd, mode = FALLOC_FL_KEEP_SIZE, offset, size);

// Deallocate space (create a hole) while keeping the file size unchanged
fallocate(fd, mode = FALLOC_FL_PUNCH_HOLE | FALLOC_FL_KEEP_SIZE, offset, size);
</code></pre>
<p>Unsupported modes:</p>
<ul>
<li><code>FALLOC_FL_UNSHARE_RANGE</code></li>
<li><code>FALLOC_FL_COLLAPSE_RANGE</code></li>
<li><code>FALLOC_FL_ZERO_RANGE</code></li>
<li><code>FALLOC_FL_INSERT_RANGE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/fallocate.2.html">the man page</a>.</p>
<h3 id="utimensat"><a class="header" href="#utimensat"><code>utimensat</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Change file timestamps with nanosecond precision
utimensat(dirfd, path, times, flags = AT_SYMLINK_NOFOLLOW);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>AT_EMPTY_PATH</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/utimensat.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="æª”æ¡ˆç³»çµ±èˆ‡æ›è¼‰æ§åˆ¶"><a class="header" href="#æª”æ¡ˆç³»çµ±èˆ‡æ›è¼‰æ§åˆ¶">æª”æ¡ˆç³»çµ±èˆ‡æ›è¼‰æ§åˆ¶</a></h1>
<!--
Put system calls such as
mount, umount2, pivot_root, statfs, fstatfs, truncate, ftruncate, fsync, 
fdatasync, sync, syncfs, sync_file_range, open_tree, move_mount, fsopen,
fsconfig, fsmount, fspick, inotify_init, inotify_init1, inotify_add_watch,
inotify_rm_watch
under this category.
-->
<h2 id="æ›è¼‰èˆ‡å¸è¼‰æª”æ¡ˆç³»ç»Ÿ"><a class="header" href="#æ›è¼‰èˆ‡å¸è¼‰æª”æ¡ˆç³»ç»Ÿ">æ›è¼‰èˆ‡å¸è¼‰æª”æ¡ˆç³»ç»Ÿ</a></h2>
<h3 id="mount"><a class="header" href="#mount"><code>mount</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create a new mount
mount(
    source, target, filesystemtype,
    mountflags = 0,
    data
);

// Move the existing mount point
mount(
    source, target, filesystemtype,
    mountflags = MS_MOVE,
    data
);

// Create a bind mount
mount(
    source, target, filesystemtype,
    mountflags = MS_BIND | MS_REC,
    data
);
</code></pre>
<p>Partially supported mount flags:</p>
<ul>
<li><code>MS_REC</code> is only effective when used in conjunction with <code>MS_BIND</code></li>
<li><code>MS_REMOUNT</code> can be used, but the set options have no actual effect.</li>
<li><code>MS_DIRSYNC</code> can be set but have no actual effect.</li>
<li><code>MS_LAZYTIME</code> can be set but have no actual effect.</li>
<li><code>MS_MANDLOCK</code> can be set but have no actual effect.</li>
<li><code>MS_NOATIME</code> can be set but have no actual effect.</li>
<li><code>MS_NODEV</code> can be set but have no actual effect.</li>
<li><code>MS_NODIRATIME</code> can be set but have no actual effect.</li>
<li><code>MS_NOEXEC</code> can be set but have no actual effect.</li>
<li><code>MS_NOSUID</code> can be set but have no actual effect.</li>
<li><code>MS_RDONLY</code> can be set but have no actual effect.</li>
<li><code>MS_RELATIME</code> can be set but have no actual effect.</li>
<li><code>MS_SILENT</code> can be set but have no actual effect.</li>
<li><code>MS_STRICTATIME</code> can be set but have no actual effect.</li>
<li><code>MS_SYNCHRONOUS</code> can be set but have no actual effect.</li>
</ul>
<p>Unsupported mount flags:</p>
<ul>
<li><code>MS_SHARED</code></li>
<li><code>MS_SLAVE</code></li>
<li><code>MS_UNBINDABLE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/mount.2.html">the man page</a>.</p>
<h3 id="umount-and-umount2"><a class="header" href="#umount-and-umount2"><code>umount</code> and <code>umount2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Unmount a mounted file system
umount(target);

// Unmount a mounted file system with enhanced behavior control
umount2(target, flags = UMOUNT_NOFOLLOW);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MNT_FORCE</code></li>
<li><code>MNT_DETACH</code></li>
<li><code>MNT_EXPIRE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/umount.2.html">the man page</a>.</p>
<h2 id="event-notifications"><a class="header" href="#event-notifications">Event Notifications</a></h2>
<h3 id="inotify_init-and-inotify_init1"><a class="header" href="#inotify_init-and-inotify_init1"><code>inotify_init</code> and <code>inotify_init1</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create an inotify instance
inotify_init();

// Create an inotify instance with enhanced behavior control
inotify_init1(flags = IN_CLOEXEC | IN_NONBLOCK);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/inotify_init.2.html">the man page</a>.</p>
<h3 id="inotify_add_watch"><a class="header" href="#inotify_add_watch"><code>inotify_add_watch</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">inotify_events = IN_ACCESS | IN_MODIFY | IN_ATTRIB | IN_CLOSE_WRITE |
                 IN_CLOSE_NOWRITE | IN_OPEN | IN_CREATE | IN_DELETE |
                 IN_DELETE_SELF | IN_CLOSE;

inotify_controls = IN_ONLYDIR | IN_DONT_FOLLOW | IN_MASK_CREATE |
                   IN_MASK_ADD | IN_ONESHOT;

// Add a watch to an initialized inotify instance
inotify_add_watch(fd, pathname, mask = &lt;inotify_events&gt; | &lt;inotify_controls&gt;);
</code></pre>
<p>Unsupported event flags:</p>
<ul>
<li><code>IN_MOVED_FROM</code> and <code>IN_MOVED_TO</code> - Move events are not generated</li>
<li><code>IN_MOVE_SELF</code> - Self move events are not generated</li>
<li><code>IN_UNMOUNT</code> - Unmount events are not generated</li>
<li><code>IN_Q_OVERFLOW</code> - Queue overflow events are not generated (events are silently dropped when queue is full)</li>
<li><code>IN_ALL_EVENTS</code> - Only includes actually supported events</li>
</ul>
<p>Unsupported control flags:</p>
<ul>
<li><code>IN_EXCL_UNLINK</code> - Events on unlinked files are not excluded</li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man7/inotify.7.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-descriptor-and-io-control"><a class="header" href="#file-descriptor-and-io-control">File Descriptor and I/O Control</a></h1>
<!--
Put system calls such as
dup, dup2, dup3, fcntl, ioctl, pipe, pipe2, splice, tee, vmsplice, sendfile,
eventfd, eventfd2, memfd_create and fadvise64
under this category.
-->
<h3 id="fcntl"><a class="header" href="#fcntl"><code>fcntl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">ignore_flags = O_RDONLY | O_WRONLY | O_RDWR | O_CREAT | O_EXCL | O_NOCTTY | O_TRUNC;
can_change_flags = O_APPEND | O_ASYNC | O_DIRECT | O_NOATIME | O_NONBLOCK;

// Duplicate a file descriptor
fcntl(fd, cmd = F_DUPFD | F_DUPFD_CLOEXEC, arg);

// Retrieve file descriptor flags (F_GETFD), file status flags (F_GETFL)
// or SIGIO/SIGURG owner process (F_GETOWN)
fcntl(fd, cmd = F_GETFD | F_GETFL | F_GETOWN);

// Set file descriptor flags
fcntl(fd, cmd = F_SETFD, arg = FD_CLOEXEC);

// Set file status flags
fcntl(fd, cmd = F_SETFL, arg = &lt;ignore_flags&gt; | &lt;can_change_flags&gt;);

// Manage record locks: test (F_GETLK), non-blocking set (F_SETLK), blocking set (F_SETLKW)
fcntl(fd, cmd = F_GETLK | F_SETLK | F_SETLKW, arg);

// Assign SIGIO/SIGURG owner process
fcntl(fd, cmd = F_SETOWN, arg);

// Add seals to the inode referred to
fcntl(fd, cmd = F_ADD_SEALS, arg = F_SEAL_SEAL | F_SEAL_SHRINK | F_SEAL_GROW | F_SEAL_WRITE | F_SEAL_FUTURE_WRITE);

// Get seals from the inode referred to
fcntl(fd, cmd = F_GET_SEALS);
</code></pre>
<p>æœªæ”¯æ´çš„å‘½ä»¤ï¼š</p>
<ul>
<li><code>F_NOTIFY</code></li>
<li><code>F_OFD_SETLK</code>, <code>F_OFD_SETLKW</code> and <code>F_OFD_GETLK</code></li>
<li><code>F_GETOWN_EX</code> and <code>F_SETOWN_EX</code></li>
<li><code>F_GETSIG</code> and <code>F_SETSIG</code></li>
<li><code>F_SETLEASE</code> and <code>F_GETLEASE</code></li>
<li><code>F_SETPIPE_SZ</code> and <code>F_GETPIPE_SZ</code></li>
<li><code>F_GET_RW_HINT</code> and <code>F_SET_RW_HINT</code></li>
<li><code>F_GET_FILE_RW_HINT</code> and <code>F_SET_FILE_RW_HINT</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/fcntl.2.html">the man page</a>.</p>
<h3 id="pipe-and-pipe2"><a class="header" href="#pipe-and-pipe2"><code>pipe</code> and <code>pipe2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create pipe
pipe(pipefd);

// Create pipe with enhanced behavior control
pipe2(pipefd, flags = O_CLOEXEC);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>O_DIRECT</code></li>
<li><code>O_NONBLOCK</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/pipe.2.html">the man page</a>.</p>
<h3 id="eventfd-and-eventfd2"><a class="header" href="#eventfd-and-eventfd2"><code>eventfd</code> and <code>eventfd2</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create event notification descriptor
eventfd(initval);

// Create event notification descriptor with enhanced behavior control
eventfd2(initval, flags = EFD_CLOEXEC);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>EFD_NONBLOCK</code></li>
<li><code>EFD_SEMAPHORE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/eventfd.2.html">the man page</a>.</p>
<h3 id="memfd_create"><a class="header" href="#memfd_create"><code>memfd_create</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create an anonymous file and return a file descriptor that refers to it
memfd_create(name, flags = MFD_CLOEXEC | MFD_ALLOW_SEALING);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>MFD_HUGETLB</code></li>
</ul>
<p>Unsupported flags:</p>
<ul>
<li><code>MFD_HUGE_64KB</code></li>
<li><code>MFD_HUGE_512KB</code></li>
<li><code>MFD_HUGE_1MB</code></li>
<li><code>MFD_HUGE_2MB</code></li>
<li><code>MFD_HUGE_8MB</code></li>
<li><code>MFD_HUGE_16MB</code></li>
<li><code>MFD_HUGE_32MB</code></li>
<li><code>MFD_HUGE_256MB</code></li>
<li><code>MFD_HUGE_512MB</code></li>
<li><code>MFD_HUGE_1GB</code></li>
<li><code>MFD_HUGE_2GB</code></li>
<li><code>MFD_HUGE_16GB</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/memfd_create.2.html">the man page</a>.</p>
<h3 id="fadvise64"><a class="header" href="#fadvise64"><code>fadvise64</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Announce an intention to access file data in a specific pattern in the future
fadvise64(fd, offset, len, advice = 0);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>POSIX_FADV_NORMAL</code></li>
<li><code>POSIX_FADV_RANDOM</code></li>
<li><code>POSIX_FADV_SEQUENTIAL</code></li>
<li><code>POSIX_FADV_WILLNEED</code></li>
<li><code>POSIX_FADV_DONTNEED</code></li>
<li><code>POSIX_FADV_NOREUSE</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/posix_fadvise.2.html">the man page</a>.</p>
<h3 id="epoll_ctl"><a class="header" href="#epoll_ctl"><code>epoll_ctl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct epoll_event = {
    events = EPOLLIN | EPOLLOUT | EPOLLRDHUP | EPOLLPRI | EPOLLERR | EPOLLHUP |
             EPOLLET | EPOLLONESHOT,
    ..
};

// Add, modify, or delete entries in the interest list of an epoll file descriptor
epoll_ctl(
    epfd,
    op = EPOLL_CTL_ADD | EPOLL_CTL_MOD | EPOLL_CTL_DEL,
    fd, event = &lt;epoll_event&gt;
);
</code></pre>
<p>Unsupported flags in events:</p>
<ul>
<li><code>EPOLLEXCLUSIVE</code></li>
<li><code>EPOLLWAKEUP</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/epoll_ctl.2.html">the man page</a>.</p>
<h3 id="poll-and-ppoll"><a class="header" href="#poll-and-ppoll"><code>poll</code> and <code>ppoll</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct pollfd = {
    events = POLLIN | POLLPRI | POLLOUT | POLLRDHUP | POLLERR |
             POLLHUP | POLLNVAL | POLLRDNORM,
    ..
};

// Wait for I/O event on a set of file descriptors
poll(fds = [ &lt;pollfd&gt; ], nfds, timeout);

// Wait for I/O event on a set of file descriptors with specified signals temporarily blocked
ppoll(fds = [ &lt;pollfd&gt; ], nfds, timeout, sigset, sigset_size);
</code></pre>
<p>Unsupported events:</p>
<ul>
<li><code>POLLRDBAND</code></li>
<li><code>POLLWRNORM</code></li>
<li><code>POLLWRBAND</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/poll.2.html">the man page</a>.</p>
<h3 id="ioctl"><a class="header" href="#ioctl"><code>ioctl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">tty_ops = TCGETS | TCSETS | TCSETSW | TCSETSF | TIOCGWINSZ | TIOCSWINSZ |
          TIOCGPTN | FIONREAD | KDFONTOP | KDSETMODE | KDGETMODE |
          KDSKBMODE | KDGKBMODE;
term_ops = TIOCGPGRP | TIOCSPGRP | TIOCSCTTY | TIOCNOTTY | TIOCGSID;
pty_master_ops = TIOCSPTLCK | TIOCGPTLCK | TIOCGPTPEER | TIOCPKT | TIOCGPKT;

// Control file descriptor flags and I/O modes
ioctl(fd, op = FIONCLEX | FIOCLEX | FIONBIO | FIOASYNC, ..);

// Control terminal devices
ioctl(fd, op = &lt;pty_master_ops&gt; | &lt;tty_ops&gt; | &lt;term_ops&gt;, ..);

// Control framebuffer display
ioctl(
    fd,
    op = FBIOGET_VSCREENINFO | FBIOPUT_VSCREENINFO | FBIOGET_FSCREENINFO |
         FBIOGETCMAP | FBIOPUTCMAP | FBIOPAN_DISPLAY | FBIOBLANK,
    ..
);

// Control Event devices (evdev)
ioctl(
    fd,
    op = EVIOCGVERSION | EVIOCGID | EVIOCGNAME | EVIOCGPHYS | EVIOCGUNIQ |
         EVIOCGKEY | EVIOCGLED | EVIOCGSW | EVIOCSCLOCKID | EVIOCGBIT,
    ..
);

// Control block devices
ioctl(fd, op = BLKGETSIZE64, ..);

// Control Trust Domain Extensions (TDX) guest devices
ioctl(fd, op = TDX_CMD_GET_REPORT0, ..);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/ioctl.2.html">the man page</a>.</p>
<h3 id="ioprio_set-and-ioprio_get"><a class="header" href="#ioprio_set-and-ioprio_get"><code>ioprio_set</code> and <code>ioprio_get</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Set the I/O priority for a single thread
ioprio_set(which = IOPRIO_WHO_PROCESS, who, ioprio);

// Get the I/O priority for a single thread
ioprio_get(which = IOPRIO_WHO_PROCESS, who);
</code></pre>
<p>Unsupported selectors:</p>
<ul>
<li><code>IOPRIO_WHO_PGRP</code></li>
<li><code>IOPRIO_WHO_USER</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/ioprio_set.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="inter-process-communication"><a class="header" href="#inter-process-communication">Inter-Process Communication</a></h1>
<!--
Put system calls such as
msgget, msgsnd, msgrcv, msgctl, semget, semop, semctl, shmget, shmat, shmctl
futex, set_robust_list, and get_robust_list
under this category.
-->
<h3 id="futex"><a class="header" href="#futex"><code>futex</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">opt_flags = FUTEX_PRIVATE_FLAG | FUTEX_CLOCK_REALTIME;

// Block current thread if target value at `uaddr` matches `val`, and wait up to `timeout`.
futex(
    uaddr,
    futex_op = FUTEX_WAIT | &lt;opt_flags&gt;,
    val, timeout
);

// Block current thread with bitmask condition if target value at `uaddr` matches `val`,
// and wait up to `timeout`.
futex(
    uaddr,
    futex_op = FUTEX_WAIT_BITSET | &lt;opt_flags&gt;,
    val, timeout, unused = NULL, bitmask
);

// Unblock up to `max_waiters` threads waiting on `uaddr`
futex(
    uaddr,
    futex_op = FUTEX_WAKE | &lt;opt_flags&gt;,
    max_waiters
);

// Unblock up to `max_waiters` threads on `uaddr`, if the value on `uaddr` matches `bitmask`
futex(
    uaddr,
    futex_op = FUTEX_WAKE_BITSET | &lt;opt_flags&gt;,
    max_waiters, unused0 = NULL, unused1 = NULL, bitmask
);

// Unblock up to `max_waiters` threads waiting on `uaddr`, and requeue up to
// `max_requeue_waiters` of the remaining waiters to the target futex at `uaddr2`.
futex(
    uaddr,
    futex_op = FUTEX_REQUEUE | &lt;opt_flags&gt;,
    max_waiters, max_requeue_waiters, uaddr2
);

// Perform atomic operation encoded in `operation` on `uaddr2`. Unblock up to `max_waiters`
// threads waiting on `uaddr`, and conditionally unblock up to `max_waiters2` threads
// waiting on `uaddr2` based on the result of the atomic operation.
futex(
    uaddr,
    futex_op = FUTEX_WAKE_OP | &lt;opt_flags&gt;,
    max_waiters, max_waiters2, uaddr2, operation
);
</code></pre>
<p>Unsupported operations:</p>
<ul>
<li><code>FUTEX_FD</code></li>
<li><code>FUTEX_CMP_REQUEUE</code></li>
<li><code>FUTEX_LOCK_PI</code></li>
<li><code>FUTEX_UNLOCK_PI</code></li>
<li><code>FUTEX_TRYLOCK_PI</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/futex.2.html">the man page</a>.</p>
<h2 id="system-v-semaphore"><a class="header" href="#system-v-semaphore">System V semaphore</a></h2>
<h3 id="semget"><a class="header" href="#semget"><code>semget</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Creat or open a semaphore set
semget(
    key,
    nsems,
    semflg = IPC_CREAT | IPC_EXCL
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/semget.2.html">the man page</a>.</p>
<h3 id="semop-and-semtimedop"><a class="header" href="#semop-and-semtimedop"><code>semop</code> and <code>semtimedop</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct sembuf = {
    sem_flg = IPC_NOWAIT,
    ..
};

// Semaphore operations without blocking
semop(
    semid,
    sops = [ &lt;sembuf&gt; ],
    nsops
);
</code></pre>
<p>Unsupported semaphore flags:</p>
<ul>
<li><code>SEM_UNDO</code></li>
</ul>
<p>Supported and unsupported functionality of <code>semtimedop</code> are the same as <code>semop</code>. The SCML rules are omitted for brevity.</p>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/semop.2.html">the man page</a>.</p>
<h3 id="semctl"><a class="header" href="#semctl"><code>semctl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Remove the semaphore set
semctl(
    semid,
    semnum,
    cmd = IPC_RMID
);

// Initialize the value of the semnum-th semaphore
semctl(
    semid,
    semnum,
    cmd = SETVAL,
    arg
);

// Return the current value (GETVAL), last operating process's PID (GETPID),
// count of processes awaiting increment (GETNCNT) or count of processes awaiting
// zero (GETZCNT) of the semnum-th semaphore
semctl(
    semid,
    semnum,
    cmd = GETVAL | GETPID | GETNCNT | GETZCNT
);

// Retrieve a copy of the `semid_ds` kernel structure for the specified semaphore set
semctl(
    semid,
    semnum,
    cmd = IPC_STAT,
    arg
);
</code></pre>
<p>æœªæ”¯æ´çš„å‘½ä»¤ï¼š</p>
<ul>
<li><code>IPC_INFO</code></li>
<li><code>SEM_INFO</code></li>
<li><code>SEM_STAT</code></li>
<li><code>SEM_STAT_ANY</code></li>
<li><code>GETALL</code></li>
<li><code>SETALL</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/semctl.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="networking--sockets"><a class="header" href="#networking--sockets">Networking &amp; Sockets</a></h1>
<!--
Put system calls such as

socket, socketpair, bind, listen, accept, connect, getsockname, getpeername, 
sendto, recvfrom, sendmsg, recvmsg, shutdown, setsockopt, getsockopt, 
sendmmsg, recvmmsg, accept4, recvmsg, and socketcall
under this category.
-->
<h2 id="socket-creation"><a class="header" href="#socket-creation">Socket Creation</a></h2>
<h3 id="socket"><a class="header" href="#socket"><code>socket</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Optional flags for socket type
opt_type_flags = SOCK_NONBLOCK | SOCK_CLOEXEC;

// Create a UNIX socket
socket(
    family = AF_UNIX,
    type = SOCK_STREAM | SOCK_SEQPACKET | &lt;opt_type_flags&gt;,
    protocol = 0
);

// Create an IPv4 socket (TCP or UDP)
socket(
    family = AF_INET,
    type = SOCK_STREAM | SOCK_DGRAM | &lt;opt_type_flags&gt;,
    protocol = IPPROTO_IP | IPPROTO_TCP | IPPROTO_UDP
);

// Create a netlink socket
socket(
    family = AF_NETLINK,
    type = SOCK_RAW | SOCK_DGRAM | &lt;opt_type_flags&gt;,
    protocol = NETLINK_ROUTE | NETLINK_KOBJECT_UEVENT
);

// Create a VSOCK socket
socket(
    family = AF_VSOCK,
    type = SOCK_STREAM | &lt;opt_type_flags&gt;,
    protocol = 0
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/socket.2.html">the man page</a>.</p>
<h3 id="socketpair"><a class="header" href="#socketpair"><code>socketpair</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Optional flags for socket type
opt_type_flags = SOCK_NONBLOCK | SOCK_CLOEXEC;

// Create a pair of connected UNIX sockets
socketpair(
    family = AF_UNIX,
    type = SOCK_STREAM | SOCK_SEQPACKET | &lt;opt_type_flags&gt;,
    protocol = 0,
    sv
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/socketpair.2.html">the man page</a>.</p>
<h2 id="socket-setup"><a class="header" href="#socket-setup">Socket Setup</a></h2>
<h3 id="bind"><a class="header" href="#bind"><code>bind</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

// Bind a socket to an address
bind(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/bind.2.html">the man page</a>.</p>
<h3 id="connect"><a class="header" href="#connect"><code>connect</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

// Connect to a peer socket
connect(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/connect.2.html">the man page</a>.</p>
<h3 id="accept-and-accept4"><a class="header" href="#accept-and-accept4"><code>accept</code> and <code>accept4</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_VSOCK,
    ..
};

// Accept an incoming connection
accept(
    sockfd, addr = &lt;sockaddr&gt;, addrlen
);

// Accept an incoming connection and set flags for the new socket
accept4(
    sockfd, addr = &lt;sockaddr&gt;, addrlen,
    flags = SOCK_NONBLOCK | SOCK_CLOEXEC
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/accept.2.html">the man page</a>.</p>
<h2 id="socket-communication"><a class="header" href="#socket-communication">Socket Communication</a></h2>
<h3 id="sendto-sendmsg-and-sendmmsg"><a class="header" href="#sendto-sendmsg-and-sendmmsg"><code>sendto</code>, <code>sendmsg</code> and <code>sendmmsg</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">struct sockaddr = {
    sa_family = AF_INET | AF_UNIX | AF_NETLINK | AF_VSOCK,
    ..
};

struct msg_hdr = {
    msg_name = &lt;sockaddr&gt;,
    msg_control = NULL,
    ..
};

struct mmsg_hdr = {
    hdr = &lt;msg_hdr&gt;,
    msg_len
};

// Send message on a socket
sendto(
    sockfd, buf, len,
    flags = 0,
    dest_addr = &lt;sockaddr&gt;,
    addrlen
);

// Send message using scatter-gather buffers and ancillary data
sendmsg(
    sockfd,
    msg = &lt;msg_hdr&gt;,
    flags = 0
);


// Send multiple messages on a socket
sendmmsg(
    sockfd,
    mmsgs = [ &lt;mmsg_hdr&gt; ],
    mmsg_count,
    flags = 0
);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>MSG_CONFIRM</code></li>
<li><code>MSG_DONTROUTE</code></li>
<li><code>MSG_DONTWAIT</code></li>
<li><code>MSG_EOR</code></li>
<li><code>MSG_MORE</code></li>
<li><code>MSG_CONFIRM</code></li>
<li><code>MSG_NOSIGNAL</code></li>
<li><code>MSG_OOB</code></li>
<li><code>MSG_FASTOPEN</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/sendto.2.html">the man page</a>.</p>
<h3 id="recvfrom-and-recvmsg"><a class="header" href="#recvfrom-and-recvmsg"><code>recvfrom</code> and <code>recvmsg</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Receive message from a socket
recvfrom(
    sockfd, buf, size,
    flags = 0,
    src_addr, addrlen
);

// Receive message using scatter-gather buffers and ancillary data
recvmsg(
    sockfd,
    msg,
    flags = 0
);
</code></pre>
<p>Partially-supported flags:</p>
<ul>
<li><code>MSG_PEEK</code> because it is only supported in netlink socket</li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/recvfrom.2.html">the man page</a>.</p>
<h2 id="socket-options"><a class="header" href="#socket-options">Socket Options</a></h2>
<h3 id="getsockopt-and-setsockopt"><a class="header" href="#getsockopt-and-setsockopt"><code>getsockopt</code> and <code>setsockopt</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">socket_options = SO_SNDBUF | SO_RCVBUF | SO_REUSEADDR | SO_REUSEPORT |
                 SO_PRIORITY | SO_LINGER | SO_PASSCRED | SO_KEEPALIVE |
                 SO_SNDBUFFORCE | SO_RCVBUFFORCE | SO_ERROR |
                 SO_PEERCRED | SO_ACCEPTCONN | SO_PEERGROUPS;

ip_options = IP_TOS | IP_TTL | IP_HDRINCL;

tcp_options = TCP_NODELAY | TCP_MAXSEG | TCP_KEEPIDLE | TCP_SYNCNT |
              TCP_DEFER_ACCEPT | TCP_WINDOW_CLAMP | TCP_CONGESTION |
              TCP_USER_TIMEOUT | TCP_INQ;

// Get options at socket level
getsockopt(
    sockfd, level = SOL_SOCKET,
    optname = &lt;socket_options&gt;,
    optval, optlen
);

// Get options at IP level
getsockopt(
    sockfd, level = SOL_IP,
    optname = &lt;ip_options&gt;,
    optval, optlen
);

// Get options at TCP level
getsockopt(
    sockfd, level = SOL_TCP,
    optname = &lt;tcp_options&gt;,
    optval, optlen
);

// Set options at socket level
setsockopt(
    sockfd, level = SOL_SOCKET,
    optname = &lt;socket_options&gt;,
    optval, optlen
);

// Set options at IP level
setsockopt(
    sockfd, level = SOL_IP,
    optname = &lt;ip_options&gt;,
    optval, optlen
);

// Set options at TCP level
setsockopt(
    sockfd, level = SOL_TCP,
    optname = &lt;tcp_options&gt;,
    optval, optlen
);

// Set options at netlink level
setsockopt(
    sockfd, level = SOL_NETLINK,
    optname = NETLINK_ADD_MEMBERSHIP | NETLINK_DROP_MEMBERSHIP,
    optval, optlen
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/getsockopt.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="è¨Šè™Ÿèˆ‡è¨ˆæ™‚å™¨"><a class="header" href="#è¨Šè™Ÿèˆ‡è¨ˆæ™‚å™¨">è¨Šè™Ÿèˆ‡è¨ˆæ™‚å™¨</a></h1>
<!--
Put system calls such as

rt_sigaction, rt_sigprocmask, rt_sigpending, rt_sigqueueinfo, rt_tgsigqueueinfo,
rt_sigreturn, kill, tkill, tgkill, alarm, setitimer, getitimer, nanosleep,
timer_create, timer_settime, timer_gettime, and timer_delete
under this category.
-->
<h2 id="è¨Šè™Ÿ"><a class="header" href="#è¨Šè™Ÿ">è¨Šè™Ÿ</a></h2>
<h3 id="rt_sigaction"><a class="header" href="#rt_sigaction"><code>rt_sigaction</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Change and/or retrieve a signal action
rt_sigaction(
    signum,
    act = {
        sa_flags = SA_ONSTACK | SA_RESTART | SA_NODEFER | SA_RESTORER | SA_SIGINFO | SA_RESETHAND,
        ..
    },
    oldact, sigsetsize
);
</code></pre>
<p>Unsupported <code>sigaction</code> flags:</p>
<ul>
<li><code>SA_NOCLDSTOP</code></li>
<li><code>SA_NOCLDWAIT</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/sigaction.2.html">the man page</a>.</p>
<h3 id="rt_sigprocmask"><a class="header" href="#rt_sigprocmask"><code>rt_sigprocmask</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Change and/or retrieve blocked signals
rt_sigprocmask(
    how = SIG_BLOCK | SIG_UNBLOCK | SIG_SETMASK, set, oldset, sigsetsize
);
</code></pre>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/sigprocmask.2.html">the man page</a>.</p>
<h2 id="posix-interval-timers"><a class="header" href="#posix-interval-timers">POSIX Interval Timers</a></h2>
<h3 id="timer_create"><a class="header" href="#timer_create"><code>timer_create</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">opt_notify_methods = SIGEV_NONE | SIGEV_SIGNAL | SIGEV_THREAD_ID;

// Create a timer with predefined clock source
timer_create(
    clockid = CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID | CLOCK_REALTIME | CLOCK_MONOTONIC,
    sevp = {
        sigev_notify = &lt;opt_notify_methods&gt;,
        ..
    },
    timerid
);

// Create a timer based on a per-process or per-thread clock
timer_create(
    clockid = &lt;INTEGER&gt;,
    sevp = {
        sigev_notify = &lt;opt_notify_methods&gt;,
        ..
    },
    timerid
);
</code></pre>
<p>Partially-supported clock IDs:</p>
<ul>
<li><code>CLOCK_BOOTTIME</code> is treated as <code>CLOCK_MONOTONIC</code></li>
</ul>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>Unsupported notification methods:</p>
<ul>
<li><code>SIGEV_THREAD</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/timer_create.2.html">the man page</a>.</p>
<h3 id="timerfd_create"><a class="header" href="#timerfd_create"><code>timerfd_create</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Create a timer file descriptor with a predefined clock source
timerfd_create(
    clockid = CLOCK_REALTIME | CLOCK_MONOTONIC,
    flags = TFD_CLOEXEC | TFD_NONBLOCK
);
</code></pre>
<p>Partially-supported clock IDs:</p>
<ul>
<li><code>CLOCK_BOOTTIME</code> is treated as <code>CLOCK_MONOTONIC</code></li>
</ul>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/timerfd_create.2.html">the man page</a>.</p>
<h3 id="timerfd_settime"><a class="header" href="#timerfd_settime"><code>timerfd_settime</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Arm or disarm a timer file descriptor
timerfd_settime(
    ufd,
    flags = TFD_TIMER_ABSTIME,
    utmr,
    otmr
);
</code></pre>
<p>Ignored flags:</p>
<ul>
<li><code>TFD_TIMER_CANCEL_ON_SET</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/timerfd_create.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="namespaces-cgroups--security"><a class="header" href="#namespaces-cgroups--security">Namespaces, Cgroups &amp; Security</a></h1>
<!--
Put system calls such as
unshare, setns, clone (with namespace flags), chroot, pivot_root, prctl,
capset, seccomp, landlock_create_ruleset, landlock_add_rule, 
landlock_restrict_self, and bpf
under this category.
-->
<h3 id="prctl"><a class="header" href="#prctl"><code>prctl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Retrieve or set the parent-death signal
prctl(op = PR_GET_PDEATHSIG | PR_SET_PDEATHSIG, sig);

// Get or set the name of calling thread
prctl(op = PR_GET_NAME | PR_SET_NAME, name);

// Query whether process retains permitted capabilities after `UID` changes
prctl(op = PR_GET_KEEPCAPS);

// Configure permitted capabilities retention after `UID` changes
prctl(op = PR_SET_KEEPCAPS, state);

// Retrieve or set "child subreaper" attribute
prctl(op = PR_GET_CHILD_SUBREAPER | PR_SET_CHILD_SUBREAPER, isset);

// Retrieve or set the timer slack value (nanoseconds)
prctl(op = PR_GET_TIMERSLACK | PR_SET_TIMERSLACK, slack_ns);
</code></pre>
<p>Partially-supported operations:</p>
<ul>
<li><code>PR_GET_DUMPABLE</code> and <code>PR_SET_DUMPABLE</code> because coredump is not supported</li>
</ul>
<p>Unsupported operations:</p>
<ul>
<li><code>PR_CAP_AMBIENT</code>, <code>PR_CAPBSET_READ</code> and <code>PR_CAPBSET_DROP</code></li>
<li><code>PR_GET_ENDIAN</code> and <code>PR_SET_ENDIAN</code></li>
<li><code>PR_GET_FP_MODE</code> and <code>PR_SET_FP_MODE</code></li>
<li><code>PR_GET_FPEMU</code> and <code>PR_SET_FPEMU</code></li>
<li><code>PR_GET_FPEXC</code> and <code>PR_SET_FPEXC</code></li>
<li><code>PR_GET_IO_FLUSHER</code> and <code>PR_SET_IO_FLUSHER</code></li>
<li><code>PR_MCE_KILL</code> and <code>PR_MCE_KILL_GET</code></li>
<li><code>PR_SET_MM</code> and <code>PR_SET_VMA</code></li>
<li><code>PR_MPX_ENABLE_MANAGEMENT</code> and <code>PR_MPX_DISABLE_MANAGEMENT</code></li>
<li><code>PR_GET_NO_NEW_PRIVS</code> and <code>PR_SET_NO_NEW_PRIVS</code></li>
<li><code>PR_PAC_RESET_KEYS</code></li>
<li><code>PR_SET_PTRACER</code></li>
<li><code>PR_GET_SECCOMP</code> and <code>PR_SET_SECCOMP</code></li>
<li><code>PR_GET_SPECULATION_CTRL</code> and <code>PR_SET_SPECULATION_CTRL</code></li>
<li><code>PR_SVE_GET_VL</code> and <code>PR_SVE_SET_VL</code></li>
<li><code>PR_SET_SYSCALL_USER_DISPATCH</code></li>
<li><code>PR_GET_TAGGED_ADDR_CTRL</code> and <code>PR_SET_TAGGED_ADDR_CTRL</code></li>
<li><code>PR_TASK_PERF_EVENTS_ENABLE</code> and <code>PR_TASK_PERF_EVENTS_DISABLE</code></li>
<li><code>PR_GET_THP_DISABLE</code> and <code>PR_SET_THP_DISABLE</code></li>
<li><code>PR_GET_TID_ADDRESS</code></li>
<li><code>PR_GET_TIMING</code> and <code>PR_SET_TIMING</code></li>
<li><code>PR_GET_TSC</code> and <code>PR_SET_TSC</code></li>
<li><code>PR_GET_UNALIGN</code> and <code>PR_SET_UNALIGN</code></li>
<li><code>PR_GET_AUXV</code></li>
<li><code>PR_GET_MDWE</code> and <code>PR_SET_MDWE</code></li>
<li><code>PR_RISCV_SET_ICACHE_FLUSH_CTX</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/prctl.2.html">the man page</a>.</p>
<h3 id="capget-and-capset"><a class="header" href="#capget-and-capset"><code>capget</code> and <code>capset</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Get capabilities of thread
capget(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);

// Set capabilities of thread
capset(
    hdrp = {
        version = _LINUX_CAPABILITY_VERSION_3,
        ..
    },
    datap
);
</code></pre>
<p>Unsupported versions:</p>
<ul>
<li><code>_LINUX_CAPABILITY_VERSION_1</code></li>
<li><code>_LINUX_CAPABILITY_VERSION_2</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/capget.2.html">the man page</a>.</p>
<h3 id="unshare"><a class="header" href="#unshare"><code>unshare</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Disassociate parts of the process execution context
unshare(flags = CLONE_FILES | CLONE_FS | CLONE_NEWNS | CLONE_NEWUTS | CLONE_THREAD | CLONE_SIGHAND | CLONE_VM);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>CLONE_NEWCGROUP</code></li>
<li><code>CLONE_NEWIPC</code></li>
<li><code>CLONE_NEWNET</code></li>
<li><code>CLONE_NEWPID</code></li>
<li><code>CLONE_NEWTIME</code></li>
<li><code>CLONE_NEWUSER</code></li>
</ul>
<p>Silently-ignored flags:</p>
<ul>
<li><code>CLONE_SYSVSEM</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/unshare.2.html">the man page</a>.</p>
<h3 id="setns"><a class="header" href="#setns"><code>setns</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Reassociate thread with a namespace
setns(fd, ns_type = CLONE_NEWNS | CLONE_NEWUTS);
</code></pre>
<p>Unsupported flags:</p>
<ul>
<li><code>CLONE_NEWCGROUP</code></li>
<li><code>CLONE_NEWIPC</code></li>
<li><code>CLONE_NEWNET</code></li>
<li><code>CLONE_NEWPID</code></li>
<li><code>CLONE_NEWTIME</code></li>
<li><code>CLONE_NEWUSER</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/setns.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="system-information--misc"><a class="header" href="#system-information--misc">System Information &amp; Misc.</a></h1>
<!--
Put system calls such as
uname, getrlimit, reboot, setrlimit, sysinfo, times, gettimeofday, clock_gettime,
clock_settime, getrusage, getdents, getdents64, personality, syslog,
arch_prctl, set_tid_address, and getrandom
under this category.
-->
<h3 id="arch_prctl"><a class="header" href="#arch_prctl"><code>arch_prctl</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Get or set the FS register
arch_prctl(
    code = ARCH_GET_FS | ARCH_SET_FS,
    addr
);
</code></pre>
<p>Unsupported codes:</p>
<ul>
<li><code>ARCH_GET_CPUID</code> and <code>ARCH_SET_CPUID</code></li>
<li><code>ARCH_GET_GS</code> and <code>ARCH_SET_GS</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/arch_prctl.2.html">the man page</a>.</p>
<h3 id="getrusage"><a class="header" href="#getrusage"><code>getrusage</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Return resource usage statistics for the calling process
getrusage(
    who = RUSAGE_SELF,
    usage
);

// Return resource usage statistics for the calling thread
getrusage(
    who = RUSAGE_THREAD,
    usage
);
</code></pre>
<p>Unsupported <code>who</code> flags:</p>
<ul>
<li><code>RUSAGE_CHILDREN</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/getrusage.2.html">the man page</a>.</p>
<h3 id="getrandom"><a class="header" href="#getrandom"><code>getrandom</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Obtain random bytes
getrandom(
    buf, buflen,
    flags =
        // Optional flags:
        //
        // High-entropy pool
        GRND_RANDOM
);
</code></pre>
<p>Silently-ignored flags:</p>
<ul>
<li><code>GRND_NONBLOCK</code> because the underlying operation never blocks</li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/getrandom.2.html">the man page</a>.</p>
<h3 id="reboot"><a class="header" href="#reboot"><code>reboot</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">reboot_magic2 = LINUX_REBOOT_MAGIC2 | LINUX_REBOOT_MAGIC2A | LINUX_REBOOT_MAGIC2B | LINUX_REBOOT_MAGIC2C;

// Stop the current system
reboot(
    magic  = LINUX_REBOOT_MAGIC1,
    magic2 = &lt;reboot_magic2&gt;,
    op     = LINUX_REBOOT_CMD_HALT | LINUX_REBOOT_CMD_POWER_OFF | LINUX_REBOOT_CMD_RESTART,
    arg
);
</code></pre>
<p>Unsupported <code>op</code> flags:</p>
<ul>
<li><code>LINUX_REBOOT_CMD_CAD_OFF</code></li>
<li><code>LINUX_REBOOT_CMD_CAD_ON</code></li>
<li><code>LINUX_REBOOT_CMD_KEXEC</code></li>
<li><code>LINUX_REBOOT_CMD_RESTART2</code></li>
<li><code>LINUX_REBOOT_CMD_SW_SUSPEND</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/reboot.2.html">the man page</a>.</p>
<h2 id="posix-clocks"><a class="header" href="#posix-clocks">POSIX Clocks</a></h2>
<h3 id="clock_gettime"><a class="header" href="#clock_gettime"><code>clock_gettime</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">predefined_clockid = CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_MONOTONIC_RAW |
                     CLOCK_REALTIME_COARSE | CLOCK_MONOTONIC_COARSE | CLOCK_BOOTTIME |
                     CLOCK_PROCESS_CPUTIME_ID | CLOCK_THREAD_CPUTIME_ID;

// Get the time of a clock specified by a static ID
clock_gettime(clockid = &lt;predefined_clockid&gt;, tp);

// Get the time of a clock specified by a dynamic ID
clock_gettime(clockid = &lt;INTEGER&gt;, tp);
</code></pre>
<p>Unsupported predefined clock IDs:</p>
<ul>
<li><code>CLOCK_REALTIME_ALARM</code></li>
<li><code>CLOCK_BOOTTIME_ALARM</code></li>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/clock_gettime.2.html">the man page</a>.</p>
<h3 id="clock_nanosleep"><a class="header" href="#clock_nanosleep"><code>clock_nanosleep</code></a></h3>
<p>SCML æ”¯æ´çš„åŠŸèƒ½ï¼š</p>
<pre><code class="language-c">// Sleep with a specified clock
clock_nanosleep(
    clockid = CLOCK_REALTIME | CLOCK_MONOTONIC | CLOCK_BOOTTIME | CLOCK_PROCESS_CPUTIME_ID,
    flags =
        // Optional flags:
        //
        // Sleep until an absolute time point
        TIMER_ABSTIME,
    t, remain
);
</code></pre>
<p>Unsupported clock IDs:</p>
<ul>
<li><code>CLOCK_TAI</code></li>
</ul>
<p>For more information, see <a href="https://man7.org/linux/man-pages/man2/clock_nanosleep.2.html">the man page</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="è·¯ç·šåœ–"><a class="header" href="#è·¯ç·šåœ–">è·¯ç·šåœ–</a></h1>
<p>Asterinas æ˜¯ä¸€æ¬¾é€šç”¨å‹ä½œæ¥­ç³»çµ±å…§æ ¸ï¼Œæ—¨åœ¨æ”¯æ´å¤šç¨® CPU æ¶æ§‹èˆ‡å¤šæ¨£åŒ–çš„æ‡‰ç”¨å ´æ™¯ã€‚ç›®å‰ï¼Œå®ƒåƒ…æ”¯æ´ x86-64 è™›æ“¬æ©Ÿå™¨ã€‚æˆ‘å€‘çš„è·¯ç·šåœ–åŒ…å«ä»¥ä¸‹è¨ˆåŠƒï¼š</p>
<ul>
<li>By 2024, we aim to achieve production-ready status for VM environments on x86-64.</li>
<li>In 2025 and beyond, we will expand our support for CPU architectures and hardware devices.</li>
</ul>
<h2 id="target-early-use-cases"><a class="header" href="#target-early-use-cases">Target Early Use Cases</a></h2>
<p>One of the biggest challenges for a new OS kernel is driver support. Linux has been widely accepted due to its wide range of hardware support. As a newcomer, Asterinas faces the challenge of implementing drivers for all devices on a target platform, which would take a significant amount of time.</p>
<p>To address this obstacle, we have decided to enter the cloud market first. In an IaaS (Infrastructure-as-a-Service) cloud, workloads of different tenants are run in VMs or <a href="https://dl.acm.org/doi/10.1145/3373376.3378507">VM-style bare-metal servers</a> for maximum isolation and elasticity. The main device driver requirement for the VM environment is virtio, which is already supported by Asterinas. Therefore, using Asterinas as the guest OS of a VM or the host OS of a VM-style bare-metal server in production looks quite feasible in the near future.</p>
<p>Asterinas provides high assurance of memory safety thanks to <a href="#æ¡†å…§æ ¸æ¶æ§‹">the framekernel architecture</a>. Thus, in the cloud setting, Asterinas is attractive for usage scenarios where Linux ABI is necessary but Linux itself is considered insecure due to its large Trusted Computing Base (TCB) and memory unsafety. Specifically, we are focusing on two use cases:</p>
<ol>
<li>
<p>VM-based TEEs: All major CPU architectures have introduced VM-based Trusted Execution Environment (TEE) technology, such as ARM CCA, AMD SEV, and Intel TDX. Applications running inside TEEs often handle private or sensitive data. By running on a lightweight and memory-safe OS kernel like Asterinas, they can greatly enhance security and privacy.</p>
</li>
<li>
<p>Secure containers: In the cloud-native era, applications are commonly deployed in containers. The popular container runtimes like runc and Docker rely on the OS-level isolation enforced by Linux. However, <a href="https://dl.acm.org/doi/10.1145/3274694.3274720">Linux containers are prone to privilege escalation bugs</a>. With its safety and security prioritized architecture, Asterinas can offer more reliable OS-level isolation, making it ideal for secure containers.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="asterinas-ostd"><a class="header" href="#asterinas-ostd">Asterinas OSTD</a></h1>
<blockquote>
<p>Confucious remarked, â€œI could follow whatever my heart desired without transgressing the law.â€</p>
<p>å­æ›°ï¼š â€œä»å¿ƒæ‰€æ¬²ï¼Œä¸é€¾çŸ©ã€‚â€</p>
</blockquote>
<p>With the Asterinas OSTD (Operating System Standard Library), you donâ€™t have to learn the dark art of unsafe Rust programming and risk shooting yourself in the foot. You will be doing whatever your heart desires, and be confident that your kernel will never crash or be hacked due to undefined behaviors, even if today marks your Day 1 as a Rust programmer.</p>
<h2 id="apis"><a class="header" href="#apis">APIs</a></h2>
<p>Asterinas OSTD stands as a powerful and solid foundation for safe kernel development, providing high-level safe Rust APIs that are</p>
<ol>
<li>Essential for OS development, and</li>
<li>Dependent on the use of unsafe Rust.</li>
</ol>
<p>Most of these APIs fall into the following categories:</p>
<ul>
<li>è¨˜æ†¶é«”åˆ†é…ï¼ˆä¾‹å¦‚ï¼šåˆ†é…èˆ‡å­˜å–ç‰©ç†è¨˜æ†¶é«”åˆ†é ï¼‰</li>
<li>Task management (e.g., context switching between kernel tasks)</li>
<li>ä½¿ç”¨è€…ç©ºé–“ï¼ˆä¾‹å¦‚ï¼šæ“ç¸±èˆ‡é€²å…¥ä½¿ç”¨è€…ç©ºé–“ï¼‰</li>
<li>ä¸­æ–·è™•ç†ï¼ˆä¾‹å¦‚ï¼šè¨»å†Šä¸­æ–·è™•ç†å™¨ï¼‰</li>
<li>è¨ˆæ™‚å™¨ç®¡ç†ï¼ˆä¾‹å¦‚ï¼šè¨»å†Šè¨ˆæ™‚å™¨è™•ç†å™¨ï¼‰</li>
<li>Driver support (e.g., performing DMA and MMIO)</li>
<li>é–‹æ©Ÿæ”¯æ´ï¼ˆä¾‹å¦‚ï¼šå¾é–‹æ©Ÿè¼‰å…¥ç¨‹å¼ç²å–è³‡è¨Šï¼‰</li>
<li>Synchronization (e.g., locking and sleeping)</li>
</ul>
<p>To explore how these APIs come into play, see <a href="#example-writing-a-kernel-in-about-100-lines-of-safe-rust">the example of a 100-line kernel in safe Rust</a>.</p>
<p>The OSTD APIs have been extensively documented. You can access the comprehensive API documentation by visiting the <a href="https://docs.rs/ostd/latest/ostd">docs.rs</a>.</p>
<h2 id="four-requirements-satisfied"><a class="header" href="#four-requirements-satisfied">Four Requirements Satisfied</a></h2>
<p>In designing and implementing OSTD, we have risen to meet the challenge of fulfilling <a href="#æ¡†å…§æ ¸æ¶æ§‹">the aforementioned four criteria as demanded by the framekernel architecture</a>.</p>
<p>Expressiveness is evident through Asterinas Kernel itself, where all system calls, file systems, network protocols, and device drivers (e.g., Virtio drivers) have been implemented in safe Rust by leveraging OSTD.</p>
<p>Adopting a minimalist philosophy, OSTD has a small codebase. At its core lies the <code>ostd</code> crate, currently encompassing about 10K lines of code - a figure that is even smaller than those of many microkernels. As OSTD evolves, its codebase will expand, albeit at a relatively slow rate in comparison to the OS services layered atop it.</p>
<p>The OSTDâ€™s efficiency is measurable through the performance metrics of its APIs and the system calls of Asterinas Kernel. No intrinsic limitations have been identified within Rust or the framekernel architecture that could hinder kernel performance.</p>
<p>Soundness, unlike the other three requirements, is not as easily quantified or proved. While formal verification stands as the gold standard, it requires considerable resources and time and is not an immediate priority. As a more pragmatic approach, we will explain why the high-level design is sound in the soundness analysis and rely on the many eyes of the community to catch any potential flaws in the implementation.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="example-writing-a-kernel-in-about-100-lines-of-safe-rust"><a class="header" href="#example-writing-a-kernel-in-about-100-lines-of-safe-rust">Example: Writing a Kernel in About 100 Lines of Safe Rust</a></h1>
<p>To give you a sense of how Asterinas OSTD enables writing kernels in safe Rust, we will show a new kernel in about 100 lines of safe Rust.</p>
<p>Our new kernel will be able to run the following Hello World program.</p>
<pre><code class="language-s"># SPDX-License-Identifier: MPL-2.0

.global _start                      # entry point
.section .text                      # code section
_start:
    mov     $1, %rax                # syscall number of write
    mov     $1, %rdi                # stdout
    mov     $message, %rsi          # address of message         
    mov     $message_end, %rdx
    sub     %rsi, %rdx              # calculate message len
    syscall
    mov     $60, %rax               # syscall number of exit, move it to rax
    mov     $0, %rdi                # exit code, move it to rdi
    syscall  

.section .rodata                    # read only data section
message:
    .ascii  "Hello, world\n"
message_end:
</code></pre>
<p>The assembly program above can be compiled with the following command.</p>
<pre><code class="language-bash">gcc -static -nostdlib hello.S -o hello
</code></pre>
<p>The user program above requires our kernel to support three main features:</p>
<ol>
<li>Loading a program as a process image in user space;</li>
<li>Handling the write system call;</li>
<li>Handling the exit system call.</li>
</ol>
<p>A sample implementation of the kernel in safe Rust is given below. Comments are added to highlight how the APIs of Asterinas OSTD enable safe kernel development.</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

#![no_std]
#![deny(unsafe_code)]

extern crate alloc;

use align_ext::AlignExt;
use core::str;

use alloc::sync::Arc;
use alloc::vec;

use ostd::arch::cpu::context::UserContext;
use ostd::mm::{
    CachePolicy, FallibleVmRead, FrameAllocOptions, PageFlags, PageProperty, Vaddr, VmIo, VmSpace,
    VmWriter, PAGE_SIZE,
};
use ostd::power::{poweroff, ExitCode};
use ostd::prelude::*;
use ostd::task::{disable_preempt, Task, TaskOptions};
use ostd::user::{ReturnReason, UserMode};

/// The kernel's boot and initialization process is managed by OSTD.
/// After the process is done, the kernel's execution environment
/// (e.g., stack, heap, tasks) will be ready for use and the entry function
/// labeled as `#[ostd::main]` will be called.
#[ostd::main]
pub fn main() {
    let program_binary = include_bytes!("../hello");
    let vm_space = Arc::new(create_vm_space(program_binary));
    vm_space.activate();
    let user_task = create_user_task(vm_space);
    user_task.run();
}

fn create_vm_space(program: &amp;[u8]) -&gt; VmSpace {
    let nbytes = program.len().align_up(PAGE_SIZE);
    let user_pages = {
        let segment = FrameAllocOptions::new()
            .alloc_segment(nbytes / PAGE_SIZE)
            .unwrap();
        // Physical memory pages can be only accessed
        // via the `UFrame` or `USegment` abstraction.
        segment.write_bytes(0, program).unwrap();
        segment
    };

    // The page table of the user space can be
    // created and manipulated safely through
    // the `VmSpace` abstraction.
    let vm_space = VmSpace::new();
    const MAP_ADDR: Vaddr = 0x0040_0000; // The map addr for statically-linked executable
    let preempt_guard = disable_preempt();
    let mut cursor = vm_space
        .cursor_mut(&amp;preempt_guard, &amp;(MAP_ADDR..MAP_ADDR + nbytes))
        .unwrap();
    let map_prop = PageProperty::new_user(PageFlags::RWX, CachePolicy::Writeback);
    for frame in user_pages {
        cursor.map(frame.into(), map_prop);
    }
    drop(cursor);
    vm_space
}

fn create_user_task(vm_space: Arc&lt;VmSpace&gt;) -&gt; Arc&lt;Task&gt; {
    fn user_task() {
        let current = Task::current().unwrap();
        // Switching between user-kernel space is
        // performed via the UserMode abstraction.
        let mut user_mode = {
            let user_ctx = create_user_context();
            UserMode::new(user_ctx)
        };

        loop {
            // The execute method returns when system
            // calls or CPU exceptions occur or some
            // events specified by the kernel occur.
            let return_reason = user_mode.execute(|| false);

            // The CPU registers of the user space
            // can be accessed and manipulated via
            // the `UserContext` abstraction.
            let user_context = user_mode.context_mut();
            if ReturnReason::UserSyscall == return_reason {
                let vm_space = current.data().downcast_ref::&lt;Arc&lt;VmSpace&gt;&gt;().unwrap();
                handle_syscall(user_context, &amp;vm_space);
            }
        }
    }

    // Kernel tasks are managed by the Framework,
    // while scheduling algorithms for them can be
    // determined by the users of the Framework.
    Arc::new(TaskOptions::new(user_task).data(vm_space).build().unwrap())
}

fn create_user_context() -&gt; UserContext {
    // The user-space CPU states can be initialized
    // to arbitrary values via the `UserContext`
    // abstraction.
    let mut user_ctx = UserContext::default();
    const ENTRY_POINT: Vaddr = 0x0040_1000; // The entry point for statically-linked executable
    user_ctx.set_rip(ENTRY_POINT);
    user_ctx
}

fn handle_syscall(user_context: &amp;mut UserContext, vm_space: &amp;VmSpace) {
    const SYS_WRITE: usize = 1;
    const SYS_EXIT: usize = 60;

    match user_context.rax() {
        SYS_WRITE =&gt; {
            // Access the user-space CPU registers safely.
            let (_, buf_addr, buf_len) =
                (user_context.rdi(), user_context.rsi(), user_context.rdx());
            let buf = {
                let mut buf = vec![0u8; buf_len];
                // Copy data from the user space without
                // unsafe pointer dereferencing.
                let mut reader = vm_space.reader(buf_addr, buf_len).unwrap();
                reader
                    .read_fallible(&amp;mut VmWriter::from(&amp;mut buf as &amp;mut [u8]))
                    .unwrap();
                buf
            };
            // Use the console for output safely.
            println!("{}", str::from_utf8(&amp;buf).unwrap());
            // Manipulate the user-space CPU registers safely.
            user_context.set_rax(buf_len);
        }
        SYS_EXIT =&gt; poweroff(ExitCode::Success),
        _ =&gt; unimplemented!(),
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="osdk-ä½¿ç”¨è€…æŒ‡å—"><a class="header" href="#osdk-ä½¿ç”¨è€…æŒ‡å—">OSDK ä½¿ç”¨è€…æŒ‡å—</a></h1>
<h2 id="æ¦‚è¦½-1"><a class="header" href="#æ¦‚è¦½-1">æ¦‚è¦½</a></h2>
<p>The Asterinas OSDK (short for Operating System Development Kit) is designed to simplify the development of Rust operating systems. It aims to streamline the process by leveraging <a href="#æ¡†å…§æ ¸æ¶æ§‹">the framekernel architecture</a>.</p>
<p>OSDK æä¾›äº†ä¸€å€‹å‘½ä»¤è¡Œå·¥å…· <code>cargo-osdk</code> ï¼Œæœ‰åŠ©æ–¼åŸºæ–¼æ¡†å…§æ ¸æ¶æ§‹é–‹ç™¼çš„å°ˆæ¡ˆç®¡ç†ã€‚<code> cargo-osdk</code> å¯ä»¥ä½œç‚º Cargo çš„å­å‘½ä»¤ä½¿ç”¨ã€‚å°±åƒ Cargo ä¹‹æ–¼ Rust å°ˆæ¡ˆä¸€æ¨£ï¼Œ <code>cargo-osdk</code> è®“å»ºç½®ã€åŸ·è¡Œå’Œæ¸¬è©¦å°ˆæ¡ˆè®Šå¾—éå¸¸æ–¹ä¾¿ã€‚</p>
<h2 id="å®‰è£-osdk"><a class="header" href="#å®‰è£-osdk">å®‰è£ OSDK</a></h2>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<p>Currently, OSDK is only supported on x86_64 Ubuntu systems. We will add support for more operating systems in the future.</p>
<p>To run a kernel developed by OSDK with QEMU, the following tools need to be installed:</p>
<ul>
<li>Rust &gt;= 1.75.0</li>
<li>cargo-binutils</li>
<li>gcc</li>
<li>gdb</li>
<li>grub</li>
<li>ovmf</li>
<li>qemu-system-x86_64</li>
<li>xorriso</li>
</ul>
<p>The dependencies required for installing Rust and running QEMU can be installed by:</p>
<pre><code class="language-bash">apt install build-essential curl gdb grub-efi-amd64 grub2-common \
    libpixman-1-dev mtools ovmf qemu-system-x86 xorriso
</code></pre>
<p>é—œæ–¼å¦‚ä½•å®‰è£ Rustï¼Œæ‚¨å¯ä»¥åƒè€ƒ<a href="https://www.rust-lang.org/tools/install">å®˜æ–¹ç¶²ç«™</a>ã€‚</p>
<p>åœ¨å®‰è£ Rust ä¹‹å¾Œï¼Œå¯ä»¥é€éä»¥ä¸‹æ–¹å¼å®‰è£ <code>cargo-binutils</code></p>
<pre><code class="language-bash">cargo install cargo-binutils
</code></pre>
<h3 id="install"><a class="header" href="#install">Install</a></h3>
<p><code>cargo-osdk</code> is published on <a href="https://crates.io/">crates.io</a>, and can be installed by running</p>
<pre><code class="language-bash">cargo install cargo-osdk
</code></pre>
<h3 id="upgrade"><a class="header" href="#upgrade">Upgrade</a></h3>
<p>If <code>cargo-osdk</code> is already installed, the tool can be upgraded by running</p>
<pre><code class="language-bash">cargo install --force cargo-osdk
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="why-osdk"><a class="header" href="#why-osdk">Why OSDK</a></h1>
<p>OSDK is designed to elevate the development experience for Rust OS developers to the ease and convenience typically associated with Rust application development. Imagine crafting operating systems with the same simplicity as applications! This is important to Asterinas as we believe that the projectâ€™s success is intricately tied to the productivity and happiness of its developers. So the OSDK is here to upgrade your dev experience.</p>
<p>è€å¯¦èªªï¼Œç·¨å¯«ä½œæ¥­ç³»çµ±å…§æ ¸éå¸¸å›°é›£ã€‚å³ä¾¿ä½¿ç”¨äº†å°ä½œæ¥­ç³»çµ±é–‹ç™¼è€…ä¾†èªªå…·æœ‰åŠƒæ™‚ä»£æ„ç¾©çš„ Rust èªè¨€ï¼ŒæŒ‘æˆ°ä¾ç„¶å·¨å¤§ã€‚é€™èƒŒå¾Œæœ‰è¨±å¤šåŸå› ã€‚</p>
<p>é¦–å…ˆï¼Œå¾é›¶é–‹å§‹ç·¨å¯«ä¸€å€‹æ–°å…§æ ¸éå¸¸å›°é›£ã€‚æ‡‰ç”¨ç¨‹å¼é–‹ç™¼è€…è¦–ç‚ºç†æ‰€ç•¶ç„¶çš„ä¸€åˆ‡éƒ½æ¶ˆå¤±äº†ï¼šæ²’æœ‰å †ç–Šï¼ˆstackï¼‰ã€æ²’æœ‰å †ç©ï¼ˆheapï¼‰ã€æ²’æœ‰åŸ·è¡Œç·’ï¼Œç”šè‡³é€£æ¨™æº– I/O éƒ½æ²’æœ‰ã€‚ä½ åªèƒ½ç¨è‡ªé¢å° Rust çš„ no_std ä¸–ç•Œã€‚ä½ å¿…é ˆè¦ªè‡ªå‹•æ‰‹è™•ç†é›»è…¦æ¶æ§‹ä¸­æœ€åº•å±¤ã€æœ€å®¹æ˜“å‡ºéŒ¯ä¸”æœ€ç¹ç‘£çš„ç´°ç¯€ï¼Œä¾†å¯¦ç¾é€™äº›åŸºç¤çš„ç¨‹å¼è¨­è¨ˆåŸèªï¼ˆprimitiveï¼‰ã€‚é€™æ˜¯ä¸€å€‹ä¸æ–·å­¸ç¿’ã€å¯¦ä½œï¼Œä¸¦ç¥ˆç¦±ä¸€åˆ‡éƒ½èƒ½é †åˆ©é‹ä½œçš„éç¨‹ã€‚é€™ä¹Ÿæ„å‘³è‘—å°æ–¼æ–°çš„ä½œæ¥­ç³»çµ±å‰µä½œè€…ä¾†èªªï¼Œé€²å…¥é–€æª»éå¸¸é«˜ã€‚</p>
<p>Second, it is hard to reuse OS-related libraries/crates across projects. Think about it: most applications share a common groundwork, like libc, Rustâ€™s std library, or an SDK. This isnâ€™t the case with kernels - they lack this shared starting point, forcing each one to craft its own set of tools from the ground up. Take device drivers, for example. They often need DMA-capable buffers for chatting with hardware, but since every kernel has its own DMA API flavor, a driver for one kernel is pretty much a no-go for another. This means that for each new kernel out there, developers find themselves having to â€˜reinvent the wheelâ€™ for many core components that are standard in other kernels.</p>
<p>Third, it is hard to do unit tests for OS functionalities. Unit testing plays a crucial role in ensuring code quality, but when youâ€™re dealing with a monolithic kernel like Linux, itâ€™s like a spaghetti bowl of intertwined parts. Trying to isolate one part for testing? Forget about it. Youâ€™d have to boot the whole kernel just to test a slice of it. Loadable kernel modules are no exception: you canâ€™t test them without plugging them into a live kernel. This monolithic approach to unit testing is slow and unproductive as it performs the job of unit tests at a price of integration tests. Regardless of the kernel architecture, Rustâ€™s built-in unit testing facility is not suited for kernel development, leaving each kernel to hack together their own testing frameworks.</p>
<p>Last, it is hard to avoid writing unsafe Rust in a Rust kernel. Rust brings safetyâ€¦ well, at least for Rust applications, where you can pretty much stay in the wonderland of safe Rust all the way through. But for a Rust kernel, one cannot help but use unsafe Rust. This is because, among other reasons, low-level operations (e.g., managing page tables, doing context switching, handling interrupts, and interacting with devices) have to be expressed with unsafe Rust features (like executing assembly code or dereferencing raw pointers). The misuse of unsafe Rust could lead to various safety and security issues, as reported by <a href="https://rustsec.org">RustSec Advisory Database</a>. Despite having <a href="https://doc.rust-lang.org/nomicon/">a whole book</a> to document â€œthe Dark Arts of Unsafe Rustâ€, unsafe Rust is still tricky to use correctly, even among seasoned Rust developers.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="å»ºç«‹ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ"><a class="header" href="#å»ºç«‹ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ">å»ºç«‹ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ</a></h1>
<p>The OSDK can be used to create a new kernel project or a new library project. A kernel project defines the entry point of the kernel and can be run with QEMU. A library project can provide certain OS functionalities and be imported by other OSes.</p>
<h2 id="å»ºç«‹æ–°çš„å…§æ ¸å°ˆæ¡ˆ"><a class="header" href="#å»ºç«‹æ–°çš„å…§æ ¸å°ˆæ¡ˆ">å»ºç«‹æ–°çš„å…§æ ¸å°ˆæ¡ˆ</a></h2>
<p>Creating a new kernel project is simple. You only need to execute the following command:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos
</code></pre>
<h2 id="creating-a-new-library-project"><a class="header" href="#creating-a-new-library-project">Creating a new library project</a></h2>
<p>Creating a new library project requires just one command:</p>
<pre><code class="language-bash">cargo osdk new mylib
</code></pre>
<h2 id="generated-files"><a class="header" href="#generated-files">Generated files</a></h2>
<p>Next, we will introduce the contents of the generated project in detail. If you donâ€™t wish to delve into the details, you can skip the following sections.</p>
<h3 id="æ¦‚è¦½-2"><a class="header" href="#æ¦‚è¦½-2">æ¦‚è¦½</a></h3>
<p>The generated directory for both the kernel project and library project contains the following contents:</p>
<pre><code class="language-text">myos/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ OSDK.toml
â”œâ”€â”€ rust-toolchain.toml
â””â”€â”€ src/
    â””â”€â”€ lib.rs
</code></pre>
<h3 id="srclibrs"><a class="header" href="#srclibrs"><code>src/lib.rs</code></a></h3>
<h4 id="å…§æ ¸å°ˆæ¡ˆ"><a class="header" href="#å…§æ ¸å°ˆæ¡ˆ">å…§æ ¸å°ˆæ¡ˆ</a></h4>
<p>The <code>src/lib.rs</code> file contains the code for a simple kernel. The function marked with the <code>#[ostd::main]</code> macro is considered the kernel entry point by OSDK. The kernel will print <code>Hello world from the guest kernel!</code>to the console and then abort.</p>
<pre><code class="language-rust">#![no_std]
#![deny(unsafe_code)]

use ostd::prelude::*;

#[ostd::main]
fn kernel_main() {
    println!("Hello world from guest kernel!");
}</code></pre>
<h4 id="ç¨‹å¼åº«å°ˆæ¡ˆ"><a class="header" href="#ç¨‹å¼åº«å°ˆæ¡ˆ">ç¨‹å¼åº«å°ˆæ¡ˆ</a></h4>
<p>The <code>src/lib.rs</code> of library project only contains a simple kernel mode unit test. It follows a similar code pattern as user mode unit tests. The test module is marked with the <code>#[cfg(ktest)]</code> macro, and each test case is marked with <code>#[ktest]</code>.</p>
<pre><code class="language-rust">#![no_std]
#![deny(unsafe_code)]

#[cfg(ktest)]
mod tests {
    use ostd::prelude::*;

    #[ktest]
    fn it_works() {
        let memory_regions = &amp;ostd::boot::boot_info().memory_regions;
        assert!(!memory_regions.is_empty());
    }
}</code></pre>
<h3 id="cargotoml"><a class="header" href="#cargotoml"><code>Cargo.toml</code></a></h3>
<p>The <code>Cargo.toml</code> file is the Rust project manifest. In addition to the contents of a normal Rust project, OSDK will add the dependencies of the Asterinas OSTD to the file. The dependency version may change over time.</p>
<pre><code class="language-toml">[dependencies.ostd]
git = "https://github.com/asterinas/asterinas"
branch = "main"
</code></pre>
<p>OSDK will also exclude the directory which is used to generate temporary files.</p>
<pre><code class="language-toml">[workspace]
exclude = ["target/osdk/base"]
</code></pre>
<h3 id="osdktoml"><a class="header" href="#osdktoml"><code>OSDK.toml</code></a></h3>
<p>The <code>OSDK.toml</code> file is a manifest that defines the exact behavior of OSDK. By default, it includes settings on how to start QEMU to run a kernel. The meaning of each key can be found in the <a href="#æ¸…å–®-1">manifest documentation</a>. Please avoid changing the default settings unless you know what you are doing.</p>
<p>å…§æ ¸å°ˆæ¡ˆçš„é è¨­æ¸…å–®ï¼š</p>
<pre><code class="language-toml">project_type = "kernel"

[boot]
method = "grub-rescue-iso"

[qemu]
args = """\
    -machine q35,kernel-irqchip=split \
    -cpu Icelake-Server,+x2apic \
    --no-reboot \
    -m 8G \
    -smp 1 \
    -nographic \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off \
    -display none \
    -device isa-debug-exit,iobase=0xf4,iosize=0x04 \
    -drive if=pflash,format=raw,unit=0,readonly=on,file=/root/ovmf/release/OVMF.fd \
    -drive if=pflash,format=raw,unit=1,file=/root/ovmf/release/OVMF_VARS.fd \
"""
</code></pre>
<h3 id="rust-toolchaintoml"><a class="header" href="#rust-toolchaintoml"><code>rust-toolchain.toml</code></a></h3>
<p>The Rust toolchain for the kernel. It is the same as the toolchain of the Asterinas OSTD.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="åŸ·è¡Œæˆ–æ¸¬è©¦ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ"><a class="header" href="#åŸ·è¡Œæˆ–æ¸¬è©¦ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ">åŸ·è¡Œæˆ–æ¸¬è©¦ä½œæ¥­ç³»çµ±å°ˆæ¡ˆ</a></h1>
<p>The OSDK allows for convenient building, running, and testing of an OS project. The following example shows the typical workflow.</p>
<p>Suppose you have created a new kernel project named <code>myos</code> and you are in the project directory:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos &amp;&amp; cd myos
</code></pre>
<h2 id="å»ºç½®å°ˆæ¡ˆ"><a class="header" href="#å»ºç½®å°ˆæ¡ˆ">å»ºç½®å°ˆæ¡ˆ</a></h2>
<p>To build the project and its dependencies, simply type:</p>
<pre><code class="language-bash">cargo osdk build
</code></pre>
<p>The initial build of an OSDK project may take a considerable amount of time as it involves downloading the Rust toolchain used by the framekernel. However, this is a one-time process.</p>
<h2 id="åŸ·è¡Œå°ˆæ¡ˆ"><a class="header" href="#åŸ·è¡Œå°ˆæ¡ˆ">åŸ·è¡Œå°ˆæ¡ˆ</a></h2>
<p>To launch the kernel with QEMU, use the following command:</p>
<pre><code class="language-bash">cargo osdk run
</code></pre>
<p>OSDK will boot the kernel and initialize OS resources like the console for output, and then hand over control to the kernel entry point to execute the kernel code.</p>
<p><strong>Note</strong>: Only kernel projects (the projects that defines the function marked with <code>#[ostd::main]</code>) can be run; library projects cannot.</p>
<h2 id="æ¸¬è©¦å°ˆæ¡ˆ"><a class="header" href="#æ¸¬è©¦å°ˆæ¡ˆ">æ¸¬è©¦å°ˆæ¡ˆ</a></h2>
<p>Suppose you have created a new library project named <code>mylib</code> which contains a default test case and you are in the project directory.</p>
<pre><code class="language-bash">cargo osdk new --lib mylib &amp;&amp; cd mylib
</code></pre>
<p>To run the kernel mode tests, use the following command:</p>
<pre><code class="language-bash">cargo osdk test
</code></pre>
<p>OSDK will run all the kernel mode tests in the crate.</p>
<p>Test cases can be added not only in library projects but also in kernel projects.</p>
<p>If you want to run a specific test with a given name, for example, if the test is named <code>foo</code>, use the following command:</p>
<pre><code class="language-bash">cargo osdk test foo
</code></pre>
<h2 id="é¸é …"><a class="header" href="#é¸é …">é¸é …</a></h2>
<p>All of the <code>build</code>, <code>run</code>, and <code>test</code> commands accept options to control their behavior, such as how to compile and launch the kernel. The following documentations provide details on all the available options:</p>
<ul>
<li><a href="#cargo-osdk-build"><code>build</code> é¸é …</a></li>
<li><a href="#cargo-osdk-run"><code>run</code> é¸é …</a></li>
<li><a href="#cargo-osdk-test"><code>test</code> é¸é …</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="working-in-a-workspace"><a class="header" href="#working-in-a-workspace">Working in a Workspace</a></h1>
<p>Typically, an operating system may consist of multiple crates, and these crates may be organized in a workspace. The OSDK also supports managing projects in a workspace. Below is an example that demonstrates how to create, build, run, and test projects in a workspace.</p>
<h2 id="creating-a-new-workspace"><a class="header" href="#creating-a-new-workspace">Creating a new workspace</a></h2>
<p>Create a new workspace by executing the following commands:</p>
<pre><code class="language-bash">mkdir myworkspace &amp;&amp; cd myworkspace
touch Cargo.toml
</code></pre>
<p>Then, add the following content to <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[workspace]
members = []
resolver = "2"
</code></pre>
<h2 id="creating-a-kernel-project-and-a-library-project"><a class="header" href="#creating-a-kernel-project-and-a-library-project">Creating a kernel project and a library project</a></h2>
<p>The two projects can be created using the following commands:</p>
<pre><code class="language-bash">cargo osdk new --kernel myos
cargo osdk new mylib
</code></pre>
<p>The generated directory structure will be as follows:</p>
<pre><code class="language-text">myworkspace/
  â”œâ”€â”€ Cargo.toml
  â”œâ”€â”€ OSDK.toml
  â”œâ”€â”€ rust-toolchain.toml
  â”œâ”€â”€ myos/
  â”‚   â”œâ”€â”€ Cargo.toml
  â”‚   â””â”€â”€ src/
  â”‚       â””â”€â”€ lib.rs
  â””â”€â”€ mylib/
      â”œâ”€â”€ Cargo.toml
      â””â”€â”€ src/
          â””â”€â”€ lib.rs
</code></pre>
<p>At present, the OSDK mandates that there must be only one kernel project within a workspace.</p>
<p>In addition to the two projects, the OSDK will also generate <code>OSDK.toml</code> and <code>rust-toolchain.toml</code> at the root of the workspace.</p>
<p>Next, add the following function to <code>mylib/src/lib.rs</code>. This function will calculate the available memory after booting:</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

pub fn available_memory() -&gt; usize {
    let regions = &amp;ostd::boot::boot_info().memory_regions;
    regions.iter().map(|region| region.len()).sum()
}</code></pre>
<p>Then, add a dependency on <code>mylib</code> to <code>myos/Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
mylib = { path = "../mylib" }
</code></pre>
<p>In <code>myos/src/lib.rs</code>, modify the file content as follows. This main function will call the function from <code>mylib</code>:</p>
<pre><code class="language-rust">// SPDX-License-Identifier: MPL-2.0

#![no_std]
#![deny(unsafe_code)]

use ostd::prelude::*;

#[ostd::main]
fn kernel_main() {
    let avail_mem_as_mb = mylib::available_memory() / 1_000_000;
    println!("The available memory is {} MB", avail_mem_as_mb);
}</code></pre>
<h2 id="å»ºç½®ä¸¦åŸ·è¡Œå…§æ ¸"><a class="header" href="#å»ºç½®ä¸¦åŸ·è¡Œå…§æ ¸">å»ºç½®ä¸¦åŸ·è¡Œå…§æ ¸</a></h2>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å»ºç½®ä¸¦åŸ·è¡Œå°ˆæ¡ˆï¼š</p>
<pre><code class="language-bash">cargo osdk build
cargo osdk run
</code></pre>
<p>If everything goes well, you will see the output from the guest kernel.</p>
<h2 id="åŸ·è¡Œå–®å…ƒæ¸¬è©¦"><a class="header" href="#åŸ·è¡Œå–®å…ƒæ¸¬è©¦">åŸ·è¡Œå–®å…ƒæ¸¬è©¦</a></h2>
<p>You can run test cases from all crates by using the following command in the workspace folder:</p>
<pre><code class="language-bash">cargo osdk test
</code></pre>
<p>If you want to run test cases from a specific crate, navigate to the crateâ€™s folder and run <code>cargo osdk test</code>. For example, if you want to test <code>mylib</code>, use the following command:</p>
<pre><code class="language-bash">cd mylib &amp;&amp; cargo osdk test
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="é€²éšè©±é¡Œ"><a class="header" href="#é€²éšè©±é¡Œ">é€²éšè©±é¡Œ</a></h1>
<p>This chapter delves into advanced topics regarding OSDK, including its application in TEE environments such as Intel TDX.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="åœ¨-intel-tdx-ç’°å¢ƒä¸­åŸ·è¡Œä½œæ¥­ç³»çµ±"><a class="header" href="#åœ¨-intel-tdx-ç’°å¢ƒä¸­åŸ·è¡Œä½œæ¥­ç³»çµ±">åœ¨ Intel TDX ç’°å¢ƒä¸­åŸ·è¡Œä½œæ¥­ç³»çµ±</a></h1>
<p>OSDK æ”¯æ´è®“æ‚¨çš„ä½œæ¥­ç³»çµ±ä¾¿æ·åœ°åœ¨ <a href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html">Intel TDX</a> ç’°å¢ƒä¸­åŸ·è¡Œã€‚Intel TDX èƒ½ç‚ºæ‚¨çš„ä½œæ¥­ç³»çµ±æä¾›æ›´å®‰å…¨çš„ç’°å¢ƒã€‚</p>
<h2 id="æº–å‚™-intel-tdx-ç’°å¢ƒ-1"><a class="header" href="#æº–å‚™-intel-tdx-ç’°å¢ƒ-1">æº–å‚™ Intel TDX ç’°å¢ƒ</a></h2>
<p>è«‹ç¢ºä¿æ‚¨çš„ä¼ºæœå™¨æ”¯æ´ Intel TDXã€‚</p>
<p>See <a href="https://github.com/canonical/tdx/tree/noble-24.04?tab=readme-ov-file#4-setup-host-os">this guide</a> or other materials to enable Intel TDX in host OS.</p>
<p>è‹¥è¦é©—è­‰ TDX ä¸»æ©Ÿç‹€æ…‹ï¼Œæ‚¨å¯ä»¥è¼¸å…¥ï¼š</p>
<pre><code class="language-bash">dmesg | grep "TDX module initialized"
</code></pre>
<p>The following result is an example:</p>
<pre><code class="language-bash">[   20.507296] tdx: TDX module initialized.
</code></pre>
<p>å¦‚æœæ‚¨çœ‹åˆ°ã€ŒTDX module initializedã€è¨Šæ¯ï¼Œä»£è¡¨ TDX æ¨¡çµ„å·²æˆåŠŸè¼‰å…¥ã€‚</p>
<p>The Intel TDX environment requires TDX-enhanced versions of QEMU, KVM, GRUB, and other essential software for running an OS. Therefore, it is recommended to use a Docker image to deploy the environment.</p>
<p>Run a TDX Docker container:</p>
<pre><code class="language-bash">docker run -it --privileged --network=host --device=/dev/kvm asterinas/osdk:0.17.0-20260114
</code></pre>
<h2 id="edit-osdktoml-for-intel-tdx-support"><a class="header" href="#edit-osdktoml-for-intel-tdx-support">Edit <code>OSDK.toml</code> for Intel TDX support</a></h2>
<p>As Intel TDX has extra requirements or restrictions for VMs, it demands adjusting the OSDK configurations accordingly. This can be easily achieved with the <code>scheme</code> feature of the OSDK, which provides a convenient way to override the default OSDK configurations for a specific environment.</p>
<p>For example, you can append the following TDX-specific scheme to your <code>OSDK.toml</code> file.</p>
<pre><code class="language-toml">[scheme."tdx"]
supported_archs = ["x86_64"]
boot.method = "grub-qcow2"
grub.mkrescue_path = "~/tdx-tools/grub"
grub.boot_protocol = "linux"
qemu.args = '''\
    -accel kvm \
    -m 8G \
    -vga none \
    -monitor pty \
    -nodefaults \
    -drive file=target/osdk/asterinas/asterinas.qcow2,if=virtio,format=qcow2 \
    -monitor telnet:127.0.0.1:9001,server,nowait \
    -bios /root/ovmf/release/OVMF.fd \
    -object '{ \"qom-type\": \"tdx-guest\", \"id\": \"tdx0\", \"sept-ve-disable\": true, \"quote-generation-socket\": { \"type\": \"vsock\", \"cid\": \"2\", \"port\": \"4050\" } }' \
    -cpu host,-kvm-steal-time,pmu=off \
    -machine q35,kernel-irqchip=split,confidential-guest-support=tdx0 \
    -smp 1 \
    -nographic \
'''
</code></pre>
<p>è‹¥è¦é¸æ“‡ TDX æ–¹æ¡ˆæ‰€æŒ‡å®šçš„çµ„æ…‹è€Œéé è¨­çµ„æ…‹ï¼Œè«‹åœ¨ buildã€run æˆ– test å‘½ä»¤ä¸­å¢æ·» <code>--scheme</code> å¼•æ•¸ã€‚</p>
<pre><code class="language-bash">cargo osdk build --scheme tdx
cargo osdk run --scheme tdx
cargo osdk test --scheme tdx
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="osdk-ä½¿ç”¨è€…åƒè€ƒ"><a class="header" href="#osdk-ä½¿ç”¨è€…åƒè€ƒ">OSDK ä½¿ç”¨è€…åƒè€ƒ</a></h1>
<p>The Asterinas OSDK is a command line tool that can be used as a subcommand of Cargo. The common usage of OSDK is:</p>
<pre><code class="language-bash">cargo osdk &lt;COMMAND&gt;
</code></pre>
<p>You can use <code>cargo osdk -h</code> to see the full list of available commands. For the specific usage of a subcommand, you can use <code>cargo osdk help &lt;COMMAND&gt;</code>.</p>
<h2 id="æ¸…å–®"><a class="header" href="#æ¸…å–®">æ¸…å–®</a></h2>
<p>The OSDK utilizes a manifest named <code>OSDK.toml</code> to define its precise behavior regarding how to run a kernel with QEMU. The <code>OSDK.toml</code> file should be placed in the same folder as the projectâ€™s <code>Cargo.toml</code>. The <a href="#æ¸…å–®-1">Manifest documentation</a> provides an introduction to all the available configuration options.</p>
<p>The command line tool can also be used to set the options in the manifest. If both occur, the command line options will always take priority over the options in the manifest. For example, if the manifest defines the path of QEMU as:</p>
<pre><code class="language-toml">[qemu]
path = "/usr/bin/qemu-system-x86_64"
</code></pre>
<p>But the user provides a new QEMU path when running the project using:</p>
<pre><code class="language-bash">cargo osdk run --qemu.path="/usr/local/qemu-kvm"
</code></pre>
<p>Then, the actual path of QEMU should be <code>/usr/local/qemu-kvm</code> since command line options have higher priority.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="å‘½ä»¤"><a class="header" href="#å‘½ä»¤">å‘½ä»¤</a></h1>
<p>OSDK provides similar subcommands as Cargo, and these subcommands have similar meanings as corresponding Cargo subcommands.</p>
<p>Currently, OSDK supports the following subcommands:</p>
<ul>
<li><strong>new</strong>ï¼šå»ºç«‹æ–°çš„å…§æ ¸åŒ…æˆ–ç¨‹å¼åº«åŒ…</li>
<li><strong>build</strong>ï¼šç·¨è­¯å°ˆæ¡ˆåŠå…¶ä¾è³´é …ç›®</li>
<li><strong>run</strong>: Run the kernel with a VMM</li>
<li><strong>test</strong>: Execute kernel mode unit test by starting a VMM</li>
<li><strong>debug</strong>: Debug a remote target via GDB</li>
<li><strong>profile</strong>: Profile a remote GDB debug target to collect stack traces</li>
<li><strong>check</strong>: Analyze the current package and report errors</li>
<li><strong>clippy</strong>: Check the current package and catch common mistakes</li>
</ul>
<p>The <strong>new</strong>, <strong>build</strong>, <strong>run</strong>, <strong>test</strong> and <strong>debug</strong> subcommands can accept additional options, while the <strong>check</strong> and <strong>clippy</strong> subcommands can only accept arguments that are compatible with the corresponding Cargo subcommands.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-new"><a class="header" href="#cargo-osdk-new">cargo osdk new</a></h1>
<h2 id="æ¦‚è¦½-3"><a class="header" href="#æ¦‚è¦½-3">æ¦‚è¦½</a></h2>
<p>The <code>cargo osdk new</code> command is used to create a kernel project or a new library project. The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk new [OPTIONS] &lt;name&gt;
</code></pre>
<h2 id="å¼•æ•¸"><a class="header" href="#å¼•æ•¸">å¼•æ•¸</a></h2>
<p><code>&lt;name&gt;</code>ï¼šè»Ÿé«”ç®±çš„åç¨±ã€‚</p>
<h2 id="é¸é …-1"><a class="header" href="#é¸é …-1">é¸é …</a></h2>
<p><code>--kernel</code>: Use the kernel template. If this option is not set, the library template will be used by default.</p>
<p><code>--library</code>: Use the library template. This is the default option.</p>
<h2 id="ç¯„ä¾‹"><a class="header" href="#ç¯„ä¾‹">ç¯„ä¾‹</a></h2>
<ul>
<li>å»ºç«‹åç‚º <code>myos</code> çš„æ–°å…§æ ¸ï¼š</li>
</ul>
<pre><code class="language-bash">cargo osdk new --kernel myos
</code></pre>
<ul>
<li>å»ºç«‹åç‚º <code>mylib</code> çš„æ–°ç¨‹å¼åº«ï¼š</li>
</ul>
<pre><code class="language-bash">cargo osdk new mylib
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-build"><a class="header" href="#cargo-osdk-build">cargo osdk build</a></h1>
<h2 id="æ¦‚è¦½-4"><a class="header" href="#æ¦‚è¦½-4">æ¦‚è¦½</a></h2>
<p>The <code>cargo osdk build</code> command is used to compile the project and its dependencies. The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk build [OPTIONS]
</code></pre>
<h2 id="é¸é …-2"><a class="header" href="#é¸é …-2">é¸é …</a></h2>
<p>The options can be divided into two types: Cargo options that can be accepted by Cargo, and Manifest options that can also be defined in the manifest named <code>OSDK.toml</code>.</p>
<h3 id="cargo-é¸é …"><a class="header" href="#cargo-é¸é …">Cargo é¸é …</a></h3>
<ul>
<li>
<p><code>--profile &lt;PROFILE&gt;</code>: Build artifacts with the specified Cargo profile (built-in candidates are â€˜devâ€™, â€˜releaseâ€™, â€˜testâ€™, and â€˜benchâ€™) [default: dev]</p>
</li>
<li>
<p><code>--release</code>: Build artifacts in release mode, with optimizations</p>
</li>
<li>
<p><code>--features &lt;FEATURES&gt;</code>: Space or comma separated list of features to activate</p>
</li>
<li>
<p><code>--no-default-features</code>: Do not activate the <code>default</code> features</p>
</li>
<li>
<p><code>--config &lt;KEY=VALUE&gt;</code>: Override a configuration value</p>
</li>
</ul>
<p>More Cargo options will be supported in future versions of OSDK.</p>
<h3 id="æ¸…å–®é¸é …"><a class="header" href="#æ¸…å–®é¸é …">æ¸…å–®é¸é …</a></h3>
<p>These options can also be defined in the projectâ€™s manifest named <code>OSDK.toml</code>. Command line options are used to override or append values in <code>OSDK.toml</code>. The allowed values for each option can be found in the <a href="#æ¸…å–®-1">Manifest Documentation</a>.</p>
<ul>
<li><code>--kcmd-args &lt;ARGS&gt;</code>: Command line arguments for the guest kernel</li>
<li><code>--init-args &lt;ARGS&gt;</code>: Command line arguments for the init process</li>
<li><code>--initramfs &lt;PATH&gt;</code>: Path of the initramfs</li>
<li><code>--boot-method &lt;METHOD&gt;</code>: The method to boot the kernel</li>
<li><code>--grub-mkrescue &lt;PATH&gt;</code>: Path of grub-mkrescue</li>
<li><code>--grub-boot-protocol &lt;PROTOCOL&gt;</code>: The boot protocol for booting the kernel</li>
<li><code>--display-grub-menu</code>: To display the GRUB menu if booting with GRUB</li>
<li><code>--qemu-exe &lt;FILE&gt;</code>: The QEMU executable file</li>
<li><code>--qemu-args &lt;ARGS&gt;</code>: Extra arguments for running QEMU</li>
<li><code>--strip-elf</code>: Whether to strip the built kernel ELF using <code>rust-strip</code></li>
<li><code>--scheme &lt;SCHEME&gt;</code>: Select the specific configuration scheme provided in the OSDK manifest</li>
<li><code>--encoding &lt;FORMAT&gt;</code>: Denote the encoding format for kernel self-decompression</li>
</ul>
<h2 id="ç¯„ä¾‹-1"><a class="header" href="#ç¯„ä¾‹-1">ç¯„ä¾‹</a></h2>
<ul>
<li>Build a project with <code>./initramfs.cpio.gz</code> as the initramfs and <code>multiboot2</code> as the boot protocol used by GRUB:</li>
</ul>
<pre><code class="language-bash">cargo osdk build --initramfs="./initramfs.cpio.gz" --grub-boot-protocol="multiboot2"
</code></pre>
<ul>
<li>Build a project and append <code>sh</code>, <code>-l</code> to init process arguments:</li>
</ul>
<pre><code class="language-bash">cargo osdk build --init_args="sh" --init_args="-l"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-run"><a class="header" href="#cargo-osdk-run">cargo osdk run</a></h1>
<h2 id="æ¦‚è¦½-5"><a class="header" href="#æ¦‚è¦½-5">æ¦‚è¦½</a></h2>
<p><code>cargo osdk run</code> is used to run the kernel with QEMU. The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk run [OPTIONS]
</code></pre>
<h2 id="é¸é …-3"><a class="header" href="#é¸é …-3">é¸é …</a></h2>
<p>Most options are the same as those of <code>cargo osdk build</code>. Refer to the <a href="#cargo-osdk-build">documentation</a> of <code>cargo osdk build</code> for more details.</p>
<p>Additionally, when running the kernel using QEMU, we can setup the QEMU as a debug server using option <code>--gdb-server</code>. This option supports an additional comma separated configuration list:</p>
<ul>
<li><code>addr=ADDR</code>: the network or unix socket address on which the GDB server listens (default: <code>.osdk-gdb-socket</code>, a local UNIX socket);</li>
<li><code>wait-client</code>: let the GDB server wait for the GDB client before execution;</li>
<li><code>vscode</code>: generate a â€˜.vscode/launch.jsonâ€™ for debugging with Visual Studio Code (Requires <a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a>).</li>
</ul>
<p>Besides, to collect coverage data, we can use option <code>--coverage</code>. This option enables the coverage feature and collect coverage data to <code>coverage.profraw</code> when exit.</p>
<p>See <a href="#cargo-osdk-debug">Debug Command</a> to interact with the GDB server in terminal.</p>
<h2 id="ç¯„ä¾‹-2"><a class="header" href="#ç¯„ä¾‹-2">ç¯„ä¾‹</a></h2>
<p>Launch a debug server via QEMU with an unix socket stub, e.g. <code>.debug</code>:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server addr=.debug

```bash
cargo osdk run --gdb-server --gdb-server-addr .debug
</code></pre>
<p>Launch a debug server via QEMU with a TCP stub, e.g., <code>localhost:1234</code>:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server addr=:1234
</code></pre>
<p>Launch a debug server via QEMU and use VSCode to interact with:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server wait-client,vscode,addr=:1234
</code></pre>
<p>Launch a debug server via QEMU and use VSCode to interact with:</p>
<pre><code class="language-bash">cargo osdk run --gdb-server --gdb-vsc --gdb-server-addr :1234
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-test"><a class="header" href="#cargo-osdk-test">cargo osdk test</a></h1>
<p><code>cargo osdk test</code> is used to execute kernel mode unit test by starting QEMU. The usage is as follows:</p>
<pre><code class="language-bash">cargo osdk test [TESTNAME] [OPTIONS] 
</code></pre>
<h2 id="å¼•æ•¸-1"><a class="header" href="#å¼•æ•¸-1">å¼•æ•¸</a></h2>
<p><code>TESTNAME</code>: Only run tests containing this string in their names</p>
<h2 id="é¸é …-4"><a class="header" href="#é¸é …-4">é¸é …</a></h2>
<p>The options are the same as those of <code>cargo osdk build</code>. Refer to the <a href="#cargo-osdk-build">documentation</a> of <code>cargo osdk build</code> for more details.</p>
<h2 id="ç¯„ä¾‹-3"><a class="header" href="#ç¯„ä¾‹-3">ç¯„ä¾‹</a></h2>
<ul>
<li>Execute tests that include <em>foo</em> in their names using QEMU with 3GB of memory</li>
</ul>
<pre><code class="language-bash">cargo osdk test foo --qemu-args="-m 3G"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-debug"><a class="header" href="#cargo-osdk-debug">cargo osdk debug</a></h1>
<h2 id="æ¦‚è¦½-6"><a class="header" href="#æ¦‚è¦½-6">æ¦‚è¦½</a></h2>
<p><code>cargo osdk debug</code> is used to debug a remote target via GDB. You need to start a running server to debug with. This is accomplished by the <code>run</code> subcommand with <code>--gdb-server</code>. Then you can use the following command to attach to the server and do debugging.</p>
<pre><code class="language-bash">cargo osdk debug [OPTIONS]
</code></pre>
<p>Note that when KVM is enabled, hardware-assisted break points (<code>hbreak</code>) are needed instead of the normal break points (<code>break</code>/<code>b</code>) in GDB.</p>
<h2 id="é¸é …-5"><a class="header" href="#é¸é …-5">é¸é …</a></h2>
<p><code>--remote &lt;REMOTE&gt;</code>: Specify the address of the remote target [default: .osdk-gdb-socket]. The address can be either a path for the UNIX domain socket or a TCP port on an IP address.</p>
<h2 id="ç¯„ä¾‹-4"><a class="header" href="#ç¯„ä¾‹-4">ç¯„ä¾‹</a></h2>
<p>To debug a remote target started with <a href="https://www.qemu.org/docs/master/system/gdb.html">QEMU GDB stub</a> or the <code>run</code> subcommand, use the following commands.</p>
<p>Connect to an unix socket, e.g., <code>./debug</code>:</p>
<pre><code class="language-bash">cargo osdk debug --remote ./debug
</code></pre>
<p>Connect to a TCP port (<code>[IP]:PORT</code>), e.g., <code>localhost:1234</code>:</p>
<pre><code class="language-bash">cargo osdk debug --remote localhost:1234
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cargo-osdk-profile"><a class="header" href="#cargo-osdk-profile">cargo osdk profile</a></h1>
<h2 id="æ¦‚è¦½-7"><a class="header" href="#æ¦‚è¦½-7">æ¦‚è¦½</a></h2>
<p>The profile command is used to collect stack traces when running the target kernel in QEMU. It attaches to the GDB server, initiated with the run subcommand, and collects the stack trace periodically. The collected information can be used to directly generate a flame graph, or be stored for later analysis using <a href="https://github.com/brendangregg/FlameGraph">the original flame graph tool</a>.</p>
<h2 id="é¸é …-6"><a class="header" href="#é¸é …-6">é¸é …</a></h2>
<p><code>--remote &lt;REMOTE&gt;</code>ï¼š</p>
<p>Specify the address of the remote target. By default this is <code>.osdk-gdb-socket</code></p>
<p><code>--samples &lt;SAMPLES&gt;</code>ï¼š</p>
<p>The number of samples to collect (default 200). It is recommended to go beyond 100 for performance analysis.</p>
<p><code>--interval &lt;INTERVAL&gt;</code>ï¼š</p>
<p>The interval between samples in seconds (default 0.1).</p>
<p><code>--parse &lt;PATH&gt;</code>ï¼š</p>
<p>Parse a collected JSON profile file into other formats.</p>
<p><code>--format &lt;FORMAT&gt;</code>:</p>
<p>Possible values: - <code>json</code>:   The parsed stack trace log from GDB in JSON. - <code>folded</code>: The folded stack trace for flame graph. - <code>flame-graph</code>: A SVG flame graph.</p>
<p>If the user does not specify the format, it will be inferred from the output file extension. If the output file does not have an extension, the default format is flame graph.</p>
<p><code>--cpu-mask &lt;CPU_MASK&gt;</code>:</p>
<p>The mask of the CPU to generate traces for in the output profile data (default first 128 cores). This mask is presented as an integer.</p>
<p><code>--output &lt;PATH&gt;</code>:</p>
<p>The path to the output profile data file.</p>
<p>If the user does not specify the output path, it will be generated from the crate name, current time stamp and the format.</p>
<h2 id="ç¯„ä¾‹-5"><a class="header" href="#ç¯„ä¾‹-5">ç¯„ä¾‹</a></h2>
<p>To profile a remote QEMU GDB server running some workload for flame graph, do:</p>
<pre><code class="language-bash">cargo osdk profile --remote :1234 \
	--samples 100 --interval 0.01
</code></pre>
<p>If wanted a detailed analysis, do:</p>
<pre><code class="language-bash">cargo osdk profile --remote :1234 \
	--samples 100 --interval 0.01 --output trace.json
</code></pre>
<p>When you get the above detailed analysis, you can also use the JSON file to generate the folded format for flame graph.</p>
<pre><code class="language-bash">cargo osdk profile --parse trace.json --output trace.folded
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="æ¸…å–®-1"><a class="header" href="#æ¸…å–®-1">æ¸…å–®</a></h1>
<h2 id="æ¦‚è¦½-8"><a class="header" href="#æ¦‚è¦½-8">æ¦‚è¦½</a></h2>
<p>The OSDK tool utilizes a manifest to define its precise behavior. Typically, the configuration file is named <code>OSDK.toml</code> and is placed in the root directory of the workspace (the same directory as the workspaceâ€™s <code>Cargo.toml</code>). If there is only one crate and no workspace, the file is placed in the crateâ€™s root directory.</p>
<p>For a crate inside workspace, it may have two distinct related manifests, one is of the workspace (in the same directory as the workspaceâ€™s <code>Cargo.toml</code>) and one of the crate (in the same directory as the crateâ€™s <code>Cargo.toml</code>). OSDK will firstly try to find the crate-level manifest. If the crate-level manifest is found, OSDK uses it only. If the manifest is not found, OSDK will look into the workspace-level manifest.</p>
<h2 id="çµ„æ…‹"><a class="header" href="#çµ„æ…‹">çµ„æ…‹</a></h2>
<p>Below, you will find a comprehensive version of the available configurations in the manifest.</p>
<pre><code class="language-toml">project_type = "kernel"                     # &lt;1&gt; 

# --------------------------- the default scheme settings -------------------------------
supported_archs = ["x86_64", "riscv64"]     # &lt;2&gt;

# The common options for all build, run and test subcommands 
[build]                                     # &lt;3&gt;
features = ["no_std", "alloc"]              # &lt;4&gt;
profile = "dev"                             # &lt;5&gt;
strip_elf = false                           # &lt;6&gt;
encoding = "raw"                            # &lt;7&gt;
[boot]                                      # &lt;8&gt;
method = "qemu-direct"                      # &lt;9&gt;
kcmd_args = ["SHELL=/bin/sh", "HOME=/"]     # &lt;10&gt;
init_args = ["sh", "-l"]                    # &lt;11&gt;
initramfs = "path/to/it"                    # &lt;12&gt;
[grub]                                      # &lt;13&gt;  
mkrescue_path = "path/to/it"                # &lt;14&gt;
boot_protocol = "multiboot2"                # &lt;15&gt; 
display_grub_menu = false                   # &lt;16&gt;
[qemu]                                      # &lt;17&gt;
path = "path/to/it"                         # &lt;18&gt;
args = "-machine q35 -m 2G"                 # &lt;19&gt;

# Special options for run subcommand
[run]                                       # &lt;20&gt;
[run.build]                                 # &lt;3&gt;
[run.boot]                                  # &lt;8&gt;
[run.grub]                                  # &lt;13&gt;
[run.qemu]                                  # &lt;17&gt;

# Special options for test subcommand
[test]                                      # &lt;21&gt;
[test.build]                                # &lt;3&gt;
[test.boot]                                 # &lt;8&gt;
[test.grub]                                 # &lt;13&gt;
[test.qemu]                                 # &lt;17&gt;
# ----------------------- end of the default scheme settings ----------------------------

# A customized scheme settings
[scheme."custom"]                           # &lt;22&gt;
[scheme."custom".build]                     # &lt;3&gt;
[scheme."custom".run]                       # &lt;20&gt;
[scheme."custom".test]                      # &lt;21&gt;
</code></pre>
<p>Here are some additional notes for the fields:</p>
<ol>
<li>
<p>The type of current crate.</p>
<p>Optional. If not specified, the default value is inferred from the usage of the macro <code>#[ostd::main]</code>. if the macro is used, the default value is <code>kernel</code>. Otherwise, the default value is <code>library</code>.</p>
<p>Possible values are <code>library</code> or <code>kernel</code>.</p>
</li>
<li>
<p>The architectures that can be supported.</p>
<p>Optional. By default OSDK supports all architectures. When building or running, if not specified in the CLI, the architecture of the host machine will be used.</p>
<p>Possible values are <code>aarch64</code>, <code>riscv64</code>, <code>x86_64</code>.</p>
</li>
<li>
<p>Options for compilation stage.</p>
</li>
<li>
<p>Cargo features to activate.</p>
<p>Optional. The default value is empty.</p>
<p>Only features defined in <code>Cargo.toml</code> can be added to this array.</p>
</li>
<li>
<p>Build artifacts with the specified Cargo profile.</p>
<p>Optional. The default value is <code>dev</code>.</p>
<p>Possible values are <code>dev</code>, <code>release</code>, <code>test</code>, and <code>bench</code> and other profiles defined in <code>Cargo.toml</code>.</p>
</li>
<li>
<p>Whether to strip the built kernel ELF using <code>rust-strip</code>.</p>
<p>Optional. The default value is <code>false</code>.</p>
</li>
<li>
<p>Denote the encoding format for kernel self-decompression</p>
<p>Optional. The default value is <code>raw</code>.</p>
<p>Possible values are <code>raw</code>, <code>gzip</code> and <code>zlib</code>.</p>
<p>If the boot protocol is not <code>linux</code>, it is not allowed to specipy the econding format.</p>
</li>
<li>
<p>Options for booting the kernel.</p>
</li>
<li>
<p>é–‹æ©Ÿæ–¹æ³•ã€‚</p>
<p>Optional. The default value is <code>qemu-direct</code>.</p>
<p>Possible values are <code>grub-rescue-iso</code>, <code>grub-qcow2</code> and <code>qemu-direct</code>.</p>
</li>
<li>
<p>The arguments provided will be passed to the guest kernel.</p>
<p>Optional. The default value is empty.</p>
<p>Each argument should be in one of the following two forms: <code>KEY=VALUE</code> or <code>KEY</code> if no value is required. Each <code>KEY</code> can appear at most once.</p>
</li>
<li>
<p>The arguments provided will be passed to the init process, usually, the init shell.</p>
<p>Optional. The default value is empty.</p>
</li>
<li>
<p>The path to the initramfs.</p>
<p>Optional. The default value is empty.</p>
<p>If the path is relative, it is relative to the manifestâ€™s enclosing directory.</p>
</li>
<li>
<p>Grub options. Only take effect if boot method is <code>grub-rescue-iso</code> or <code>grub-qcow2</code>.</p>
</li>
<li>
<p><code>grub-mkrescue</code> åŸ·è¡Œæª”çš„è·¯å¾‘ã€‚</p>
<p>Optional. The default value is the executable in the system path, if any.</p>
<p>If the path is relative, it is relative to the manifestâ€™s enclosing directory.</p>
</li>
<li>
<p>GRUB æ‰€ä½¿ç”¨çš„å”å®šã€‚</p>
<p>Optional. The default value is <code>multiboot2</code>.</p>
<p>Possible values are <code>linux</code>, <code>multiboot</code>, <code>multiboot2</code>.</p>
</li>
<li>
<p>Whether to display the GRUB menu when booting with GRUB.</p>
<p>Optional. The default value is <code>false</code>.</p>
</li>
<li>
<p>Options for finding and starting QEMU.</p>
</li>
<li>
<p>QEMU åŸ·è¡Œæª”çš„è·¯å¾‘ã€‚</p>
<p>Optional. The default value is the executable in the system path, if any.</p>
<p>If the path is relative, it is relative to the manifestâ€™s enclosing directory.</p>
</li>
<li>
<p>Additional arguments passed to QEMU are organized in a single string that can include any POSIX shell compliant separators.</p>
<p>Optional. The default value is empty.</p>
<p>Each argument should be in the form of <code>KEY</code> and <code>VALUE</code> or <code>KEY</code> if no value is required. Some keys can appear multiple times (e.g., <code>-device</code>, <code>-netdev</code>), while other keys can appear at most once. Certain keys, such as <code>-kernel</code> and <code>-initrd</code>, are not allowed to be set here as they may conflict with the settings of OSDK.</p>
<p>The field will be evaluated, so it is ok to use environment variables in the arguments (usually for paths or conditional arguments). You can even use this mechanism to read from files by using command replacement <code>$(cat path/to/your/custom/args/file)</code>.</p>
</li>
<li>
<p>Special settings for running. Only take effect when running <code>cargo osdk run</code>.</p>
<p>By default, it inherits common options.</p>
<p>Values set here are used to override common options.</p>
</li>
<li>
<p>ç”¨æ–¼æ¸¬è©¦çš„ç‰¹æ®Šè¨­å®šã€‚</p>
<p>Similar to <code>20</code>, but only take effect when running <code>cargo osdk test</code>.</p>
</li>
<li>
<p>è¨‚è£½æ–¹æ¡ˆçš„å®šç¾©ã€‚</p>
<p>A customized scheme has the same fields as the default scheme. By default, a customized scheme will inherit all options from the default scheme, unless overridden by new options.</p>
</li>
</ol>
<h3 id="ç¯„ä¾‹-6"><a class="header" href="#ç¯„ä¾‹-6">ç¯„ä¾‹</a></h3>
<p>Here is a sound, self-explanatory example which is used by OSDK in the Asterinas project.</p>
<p>In the script <code>./tools/qemu_args.sh</code>, the environment variables will be used to determine the actual set of qemu arguments.</p>
<pre><code class="language-toml"># The OSDK manifest at the Asterinas root virtual workspace 
# provides default OSDK settings for all packages.

# The common options for build, run and test
[boot]
method = "grub-rescue-iso"

[grub]
boot_protocol = "multiboot2"

[qemu]
args = "$(./tools/qemu_args.sh normal)"

# Special options for running
[run.boot]
kcmd_args = [
    "SHELL=/bin/sh",
    "LOGNAME=root",
    "HOME=/",
    "USER=root",
    "PATH=/bin:/benchmark",
    "init=/usr/bin/busybox",
]
init_args = ["sh", "-l"]
initramfs = "test/initramfs/build/initramfs.cpio.gz"

# Special options for testing
[test.qemu]
args = "$(./tools/qemu_args.sh test)"

# Other Schemes

[scheme."microvm"]
boot.method = "qemu-direct"
build.strip_elf = true
qemu.args = "$(./tools/qemu_args.sh microvm)"

[scheme."iommu"]
supported_archs = ["x86_64"]
qemu.args = "$(./tools/qemu_args.sh iommu)"

[scheme."tdx"]
supported_archs = ["x86_64"]
build.features = ["cvm_guest"]
boot.method = "grub-qcow2"
grub.boot_protocol = "linux"
qemu.args = "$(./tools/qemu_args.sh tdx)"

[scheme."riscv"]
supported_archs = ["riscv64"]
boot.method = "qemu-direct"
build.strip_elf = false

qemu.args = """\
    -cpu rv64,svpbmt=true \
    -machine virt \
    -m ${MEM-:8G} \
    -smp ${SMP-:1} \
    --no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log \
    -drive if=none,format=raw,id=x0,file=./test/initramfs/build/ext2.img \
    -drive if=none,format=raw,id=x1,file=./test/initramfs/build/exfat.img \
    # NOTE: The `/etc/profile.d/init.sh` assumes that `ext2.img` appears as the first block device (`/dev/vda`).
    # The ordering below ensures `x1` (ext2.img) is discovered before `x0`, maintaining this assumption.
    # TODO: Once UUID-based mounting is implemented, this strict ordering will no longer be required.
    -device virtio-blk-device,drive=x1 \
    -device virtio-blk-device,drive=x0 \
    -device virtio-keyboard-device \
    -device virtio-serial-device \
    -device virtconsole,chardev=mux \
"""

[scheme."sifive_u"]
supported_archs = ["riscv64"]
build.features = ["riscv_sv39_mode"]
boot.method = "qemu-direct"
build.strip_elf = false
qemu.with_monitor = true

qemu.args = """\
    -machine sifive_u \
    -m 8G \
    -smp 5 \
    -no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log
"""

[scheme."loongarch"]
boot.method = "qemu-direct"
build.strip_elf = false

qemu.args = """\
    -machine virt \
    -m 8G \
    -smp 1 \
    --no-reboot \
    -nographic \
    -display none \
    -serial chardev:mux \
    -monitor chardev:mux \
    -chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log \
    -device virtio-keyboard-pci \
    -device virtio-serial \
    -device virtconsole,chardev=mux \
    -rtc base=utc
"""
</code></pre>
<h3 id="scheme"><a class="header" href="#scheme">Scheme</a></h3>
<p>Scheme is an advanced feature that allows you to create multiple profiles for the same action (<code>build</code>, <code>run</code>, or <code>test</code>) under different scenarios (e.g., x86 vs. RISC-V). Schemes support any user-defined keys (see the 22nd configuration) and can be selected using the <code>--scheme</code> CLI argument.</p>
<p>If a scheme <code>&lt;s&gt;</code> is selected for an action (such as <code>test</code>), the value of an unspecified but required configuration <code>key</code> will be determined by the following rules:</p>
<ul>
<li>If the general config (<code>scheme.&lt;s&gt;.key</code>) exists for the selected scheme, use this value.</li>
<li>Otherwise, if the default scheme has this configuration for the action (<code>test.key</code>), use this value.</li>
<li>Otherwise, if the default scheme has this configuration (<code>key</code>), use this value.</li>
</ul>
<p>If the value is still not found, either the default value for the key will be used or an error will be thrown.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ç’°å¢ƒè®Šæ•¸"><a class="header" href="#ç’°å¢ƒè®Šæ•¸">ç’°å¢ƒè®Šæ•¸</a></h1>
<p>The OSDK tool uses the following environment variables to customize compilation and target behavior.</p>
<h2 id="osdk-specific-variables"><a class="header" href="#osdk-specific-variables">OSDK-Specific Variables</a></h2>
<ul>
<li><code>OSDK_TARGET_ARCH</code>: If set, OSDK will use the specified value as its default target architecture (e.g., x86_64, riscv64). If not set, OSDK will default to the host architecture.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="before-you-contribute"><a class="header" href="#before-you-contribute">Before You Contribute</a></h1>
<p>This part of the Book provides guidelines for contributing to Asterinas.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rust-guidelines"><a class="header" href="#rust-guidelines">Rust Guidelines</a></h1>
<h2 id="api-documentation-guidelines"><a class="header" href="#api-documentation-guidelines">API Documentation Guidelines</a></h2>
<p>API documentation describes the meanings and usage of APIs, and will be rendered into web pages by rustdoc.</p>
<p>It is necessary to add documentation to all public APIs, including crates, modules, structs, traits, functions, macros, and more. The use of the <code>#[warn(missing_docs)]</code> lint enforces this rule.</p>
<p>Asterinas adheres to the API style guidelines of the Rust community. The recommended API documentation style are specified by two official resources:</p>
<ol>
<li>The rustdoc book: <a href="https://doc.rust-lang.org/rustdoc/how-to-write-documentation.html">How to write documentation</a>;</li>
<li>The Rust RFC book: <a href="https://rust-lang.github.io/rfcs/1574-more-api-documentation-conventions.html#appendix-a-full-conventions-text">API Documentation Conventions</a>.</li>
</ol>
<h2 id="lint-guidelines"><a class="header" href="#lint-guidelines">Lint Guidelines</a></h2>
<p>Lints help us improve the code quality and find more bugs. When suppressing lints, the suppression should affect as little scope as possible, to make readers aware of the exact places where the lint is generated, and to make it easier for subsequent committers to maintain such lint.</p>
<p>For example, if some methods in a trait are dead code, marking the entire trait as dead code is unnecessary and can easily be misinterpreted as the trait itself being dead code. Instead, the following pattern is preferred:</p>
<pre><code class="language-rust">trait SomeTrait {
    #[expect(dead_code)]
    fn foo();

    #[expect(dead_code)]
    fn bar();

    fn baz();
}</code></pre>
<p>There is one exception: If it is clear enough that every member will trigger the lint, it is reasonable to expect the lint at the type level. For example, in the following code, we add <code>#[expect(non_camel_case_types)]</code> for the type <code>SomeEnum</code>, instead of for each variant of the type:</p>
<pre><code class="language-rust">#[expect(non_camel_case_types)]
enum SomeEnum {
    FOO_ABC,
    BAR_DEF,
}</code></pre>
<h3 id="when-to-expectdead_code"><a class="header" href="#when-to-expectdead_code">When to <code>#[expect(dead_code)]</code></a></h3>
<p>In general, dead code should be avoided because <em>(i)</em> it introduces unnecessary maintenance overhead, and <em>(ii)</em> its correctness can only be guaranteed by manual and error-pruned review of the code.</p>
<p>In the case where expecting dead code is necessary, it should fulfill the following requirements:</p>
<ol>
<li>We have a <em>concrete case</em> that will be implemented in the future and will turn the dead code into used code.</li>
<li>The semantics of the dead code are <em>clear</em> enough (perhaps with the help of some comments), <em>even if the use case has not been added</em>.</li>
<li>The dead code is <em>simple</em> enough that both the committer and the reviewer can be confident that the code must be correct <em>without even testing it</em>.</li>
<li>It serves as a counterpart to existing non-dead code.</li>
</ol>
<p>For example, it is fine to add ABI constants that are unused because the corresponding feature (<em>e.g.,</em> a system call) is partially implemented. This is a case where all of the above requirements are met, so adding them as dead code is perfectly acceptable.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="assembly-guidelines"><a class="header" href="#assembly-guidelines">Assembly Guidelines</a></h1>
<h2 id="define-sections"><a class="header" href="#define-sections">Define sections</a></h2>
<p>To define built-in sections, such as the text section, it is preferable to use the short directive, e.g., <code>.text</code>. For other sections, the section directive with the desired flags and type should be used, e.g., <code>.section ".bsp_boot", "awx", @progbits</code>.</p>
<p>To ensure consistency and clarity, a blank line should follow each section definition, creating a separate code block for each definition.</p>
<pre><code class="language-asm">.section ".bsp_boot.stack", "aw", @nobits

boot_stack_bottom:
    .align 4096
    .skip 0x40000  # 256 KiB
boot_stack_top:
</code></pre>
<p>In x86-64, if an executable section contains only 64-bit code, the <code>.code64</code> directive should be placed directly after the section definition. The same applies to the <code>.code32</code> directive for 32-bit code.</p>
<pre><code class="language-asm">.text
.code64

.global foo
foo:
   mov rax, 1
   ret
</code></pre>
<h2 id="å®šç¾©å‡½å¼"><a class="header" href="#å®šç¾©å‡½å¼">å®šç¾©å‡½å¼</a></h2>
<p>Function attributes, such as <code>.global</code> and <code>.align</code>, should be placed directly before the function. These function attributes should not be indented.</p>
<pre><code class="language-asm">.align 4
.global foo
foo:
   mov rax, 1
   ret
</code></pre>
<p>The assembler treats the directives <code>.global</code> and <code>.globl</code> as the same. For clarity, however, <code>.global</code> is preferred.</p>
<p>Note that a Rust crate is a single translation unit, so <code>global_asm!</code> labels in different modules within the same crate share the same global namespace. In RISC-V, we have experienced that defining two labels with the same name in different modules can nondeterministically cause duplicate symbol error. The <code>.L</code> prefix does not help. Therefore, add custom prefixes to your labels to avoid name clashes. Nevertheless, use <code>.global</code> to export symbols that need to be visible within the same crate.</p>
<p>In x86-64, if an executable section contains a mix of 32-bit and 64-bit code, the <code>.code64</code> and <code>.code32</code> directives are treated as function attributes.</p>
<pre><code class="language-asm">.code32
.global foo32
foo32:
    mov eax, 1
    ret

.code64
.global foo64
foo64:
    mov rax, 1
    ret
</code></pre>
<p>Functions that can be called from Rust code should also include the <code>.type</code> and <code>.size</code> directives. This will give debuggers a better understanding of the function. For example:</p>
<pre><code class="language-asm">.global bar
.type bar, @function
bar:
    mov rax, 2
    ret
.size bar, .-bar
</code></pre>
<p>Note that this rule explicitly limits the functions to those that can be called from Rust code. Therefore, it does not apply to boot entry points, exception trampolines, or interrupt trampolines. They may not fit into the typical definition of â€œfunctionâ€, and their sizes may be ill-defined.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="boterinas"><a class="header" href="#boterinas">Boterinas</a></h1>
<h2 id="ä»‹ç´¹"><a class="header" href="#ä»‹ç´¹">ä»‹ç´¹</a></h2>
<p><code>@boterinas</code> is a general-purpose bot designed for a wide variety of tasks in Asterinas. It streamlines maintenance tasks to enhance workflow efficiency.</p>
<p>Commands are issued by writing comments that start with the text <code>@boterinas</code>. The available commands depend on which repository you are using. The main Asterinas repository contains a <code>triagebot.toml</code> file where you can see which features are enabled.</p>
<p>Commands for GitHub issues or pull requests should be issued by writing <code>@boterinas</code> followed by the command anywhere in the comment. Note that <code>@boterinas</code> will ignore commands in Markdown code blocks, inline code spans, or blockquotes. You can enter multiple <code>@boterinas</code> commands in a single comment.</p>
<p>For example, you can claim an issue and add a label in the same comment.</p>
<pre><code class="language-markdown">@boterinas claim
@boterinas label C-enhancement
</code></pre>
<p>Additionally, <code>@boterinas</code> allows for editing comments. If you donâ€™t change the text of a command, the edit will be ignored. However, if you modify an existing command or add new ones, those commands will be processed.</p>
<p>Below, youâ€™ll find a comprehensive guide on how to use <code>@boterinas</code> effectively.</p>
<h2 id="commands-and-usage"><a class="header" href="#commands-and-usage">Commands and Usage</a></h2>
<h3 id="å·¥ä½œæµç®¡ç†"><a class="header" href="#å·¥ä½œæµç®¡ç†">å·¥ä½œæµç®¡ç†</a></h3>
<ul>
<li><strong><code>@boterinas rerun</code></strong><br>Restarts the workflow of the current pull request if it has failed unexpectedly. Only the author of the pull request can use this command.</li>
</ul>
<h3 id="è­°é¡Œå’Œæ‹‰å–è«‹æ±‚ç®¡ç†"><a class="header" href="#è­°é¡Œå’Œæ‹‰å–è«‹æ±‚ç®¡ç†">è­°é¡Œå’Œæ‹‰å–è«‹æ±‚ç®¡ç†</a></h3>
<ul>
<li>
<p><strong><code>@boterinas claim</code></strong><br>Assigns the issue or pull request to yourself.</p>
</li>
<li>
<p><strong><code>@boterinas release-assignment</code></strong><br>Removes the current assignee from an issue or pull request. This command can only be executed by the current assignee or a team member.</p>
</li>
<li>
<p><strong><code>@boterinas assign @user</code></strong><br>Assigns a specific user to the issue or pull request. Only team members have permission to assign other users.</p>
</li>
</ul>
<h3 id="æ¨™ç±¤ç®¡ç†"><a class="header" href="#æ¨™ç±¤ç®¡ç†">æ¨™ç±¤ç®¡ç†</a></h3>
<ul>
<li>
<p><strong><code>@boterinas label &lt;label&gt;</code></strong><br>Adds a label to the issue or pull request.<br><em>Example:</em> <code>@boterinas label C-enhancement C-rfc</code></p>
</li>
<li>
<p><strong><code>@boterinas label -&lt;label&gt;</code></strong><br>Removes a label from the issue or pull request.<br><em>Example:</em> <code>@boterinas label -C-enhancement -C-bug</code></p>
</li>
</ul>
<h3 id="status-indicators"><a class="header" href="#status-indicators">Status Indicators</a></h3>
<ul>
<li>
<p><strong><code>@boterinas author</code></strong><br>Indicates that a pull request is waiting on the author. It assigns the <code>S-waiting-on-author</code> label and removes both <code>S-waiting-on-review</code> and <code>S-blocked</code>, if present.</p>
</li>
<li>
<p><strong><code>@boterinas blocked</code></strong><br>Marks a pull request as blocked on something.</p>
</li>
<li>
<p><strong><code>@boterinas ready</code></strong><br>Indicates that a pull request is ready for review. This command can also be invoked with the aliases <code>@boterinas review</code> or <code>@boterinas reviewer</code>.</p>
</li>
</ul>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<ul>
<li>Only team members can assign users or remove assignments.</li>
<li>Labels are crucial for organizing issues and pull requests, so ensure they are used consistently and accurately.</li>
<li>For any issues or questions regarding <code>@boterinas</code>, please reach out to the team for support.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ç‰ˆæœ¬å‡ç´š"><a class="header" href="#ç‰ˆæœ¬å‡ç´š">ç‰ˆæœ¬å‡ç´š</a></h1>
<h2 id="ç‰ˆæœ¬è™Ÿ"><a class="header" href="#ç‰ˆæœ¬è™Ÿ">ç‰ˆæœ¬è™Ÿ</a></h2>
<p>ç›®å‰ï¼ŒAsterinas å®šæœŸç‚º Rust ä½œæ¥­ç³»çµ±é–‹ç™¼è€…ç¤¾ç¾¤ç™¼è¡Œå…©å€‹ä¸»è¦çš„è£½å“ï¼š<a href="https://crates.io/crates/cargo-osdk">OSDK</a> èˆ‡ <a href="https://crates.io/crates/ostd">OSTD</a>ã€‚ç‚ºäº†æ”¯æ´ä½¿ç”¨é€™äº›å·¥å…·é€²è¡Œé–‹ç™¼ï¼Œæˆ‘å€‘ä¹Ÿåœ¨ DockerHub ä¸Šç™¼ä½ˆäº†é…å¥—çš„ Docker æ˜ åƒæª”ï¼ˆå³ <a href="https://hub.docker.com/r/asterinas/osdk"><code>asterinas/osdk</code></a>ï¼‰ã€‚é›–ç„¶ Asterinas å…§æ ¸å°šæœªæº–å‚™å¥½ç™¼è¡Œå…¬é–‹çš„äºŒé€²ä½ç‰ˆæœ¬ï¼Œä½†å…¶é–‹ç™¼ç”¨çš„ Docker æ˜ åƒæª”ï¼ˆå³ <a href="https://hub.docker.com/r/asterinas/asterinas"><code>asterinas/asterinas</code></a>ï¼‰ã€‚</p>
<p>æ‰€æœ‰å·²ç™¼è¡Œçš„ OSDK èˆ‡ OSTD è»Ÿé«”ç®±çš†å…±ç”¨åŒä¸€å€‹ç‰ˆæœ¬è™Ÿï¼Œè©²ç‰ˆæœ¬è™Ÿå„²å­˜åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ <code>VERSION</code> æª”æ¡ˆä¸­ã€‚è©²æª”æ¡ˆç›®å‰çš„å…§å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre><code>0.17.0
</code></pre>
<p>åŒæ¨£åœ°ï¼ŒDocker æ˜ åƒæª”çš„ç‰ˆæœ¬è™Ÿå„²å­˜åœ¨ <code>DOCKER_IMAGE_VERSION</code> æª”æ¡ˆä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre><code>0.17.0-20260114
</code></pre>
<p>We use a custom format for Docker image versions: <code>MAJOR.MINOR.PATCH-DATE</code>. The <code>MAJOR.MINOR.PATCH</code> component aligns with the target version of published crates, while the <code>DATE</code> component allows us to introduce non-breaking updates to the Docker images without publishing a new crate version. Normally, the version in <code>VERSION</code> and the version in <code>DOCKER_IMAGE_VERSION</code> (ignoring the <code>DATE</code> part) are identical, except during the version bump process.</p>
<h2 id="å¦‚ä½•å‡ç´šç‰ˆæœ¬"><a class="header" href="#å¦‚ä½•å‡ç´šç‰ˆæœ¬">å¦‚ä½•å‡ç´šç‰ˆæœ¬</a></h2>
<p>We recommend a three-commit procedure to bump versions:</p>
<ol>
<li><strong>é€äº¤ 1ã€ŒBump the Docker image versionã€</strong> æœƒè§¸ç™¼ç”Ÿæˆæ–°çš„ Docker æ˜ åƒæª”ã€‚</li>
<li><strong>é€äº¤ 2ã€ŒSwitch to a new Docker imageã€</strong> æœƒä½¿ç¨‹å¼ç¢¼åº«æ”¹ç‚ºä½¿ç”¨æ–°çš„ Docker æ˜ åƒæª”ã€‚</li>
<li><strong>é€äº¤ 3ã€ŒBump the project versionã€</strong> æœƒè§¸ç™¼ç™¼è¡Œæ–°çš„è»Ÿé«”ç®±ã€‚</li>
</ol>
<p>Depending on your exact purpose, you may complete the version bump process with at most three commits within two PRs.</p>
<ul>
<li><strong>è‹¥è¦å° Docker æ˜ åƒæª”é€²è¡Œéç ´å£æ€§è®Šæ›´</strong>ï¼Œè«‹å…ˆåœ¨ä¸€å€‹ PR ä¸­æäº¤é€äº¤ 1ï¼Œæ¥è‘—åœ¨å¦ä¸€å€‹ PR ä¸­æäº¤é€äº¤ 2ã€‚</li>
<li><strong>è‹¥è¦å° Docker æ˜ åƒæª”å’Œè»Ÿé«”ç®±çš„ API é€²è¡Œé‡å¤§è®Šæ›´</strong>ï¼Œè«‹åœ¨ä¸€å€‹ PR ä¸­æäº¤é€äº¤ 1ï¼Œç„¶å¾Œåœ¨å¦ä¸€å€‹ PR ä¸­æäº¤é€äº¤ 2 å’Œ 3ã€‚</li>
</ul>
<p>Across the three commits, you will be assisted with a convenient utility script, <code>tools/bump_version.sh</code>,</p>
<h3 id="é€äº¤-1bump-the-docker-image-version"><a class="header" href="#é€äº¤-1bump-the-docker-image-version">é€äº¤ 1ï¼šã€ŒBump the Docker image versionã€</a></h3>
<p>æ›´æ–° Docker æ˜ åƒæª”å…§å®¹å¾Œï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¢åŠ  Docker æ˜ åƒæª”çš„ç‰ˆæœ¬è™Ÿï¼š</p>
<pre><code>./bump_version.sh --docker_version_file [major | minor | patch | date]
</code></pre>
<p>The second argument specifies which part of the Docker image version to increment. Use <code>date</code> for non-breaking Docker image changes. If the changes affect the crates intended to publish, select <code>major</code>, <code>minor</code>, or <code>patch</code> in line with semantic versioning.</p>
<p>This command updates the <code>DOCKER_IMAGE_VERSION</code> file. Submit these changes as a pull request. Once merged, the CI will automatically trigger the creation of new Docker images.</p>
<h3 id="é€äº¤-2switch-to-a-new-docker-image"><a class="header" href="#é€äº¤-2switch-to-a-new-docker-image">é€äº¤ 2ï¼šã€ŒSwitch to a new Docker imageã€</a></h3>
<p>Creating new Docker images can be time-consuming. Once the images have been pushed to DockerHub, write a follow-up commit to update all Docker image version references across the codebase.</p>
<pre><code>./bump_version.sh --docker_version_refs
</code></pre>
<p>If your purpose is to publish non-breaking changes to the Docker images, then submit this commit in a PR and then your job is finished. Otherwise, go on with Commit 3.</p>
<h3 id="é€äº¤-3bump-the-project-version"><a class="header" href="#é€äº¤-3bump-the-project-version">é€äº¤ 3ï¼šã€ŒBump the project versionã€</a></h3>
<p>In this commit, synchronize the version number in <code>VERSION</code> with that in <code>DOCKER_IMAGE_VERSION</code> by running:</p>
<pre><code>./bump_version.sh --version_file
</code></pre>
<p>This command also updates all version numbers in the <code>Cargo.toml</code> files of all crates scheduled for release. Pack these changes into a third commit and submit the last two commits in a single PR. After the PR is merged into the <code>main</code> branch, the CI will automatically publish the new crate versions.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-æ¦‚è¦½"><a class="header" href="#rfc-æ¦‚è¦½">RFC æ¦‚è¦½</a></h1>
<p>The Asterinas RFC process is intended to provide a consistent, transparent, structured path for the community to make â€œbigâ€ decisions. For example, the RFC process can be used to evolve the project roadmap and the system architecture.</p>
<p>For more details, see the <a href="#rfc-0001rfc-éç¨‹">RFC-0001 RFC process</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0001rfc-éç¨‹"><a class="header" href="#rfc-0001rfc-éç¨‹">RFC-0001ï¼šRFC éç¨‹</a></h1>
<ul>
<li>ç‹€æ…‹ï¼šå·²å¯¦ç¾</li>
<li>æ‹‰å–è«‹æ±‚ï¼šhttps://github.com/asterinas/asterinas/pull/2365/</li>
<li>æäº¤æ—¥æœŸï¼š2025-08-24</li>
<li>æ‰¹å‡†æ—¥æœŸï¼š025-09-05</li>
</ul>
<h2 id="æ‘˜è¦"><a class="header" href="#æ‘˜è¦">æ‘˜è¦</a></h2>
<p>The â€œRFCâ€ (request for comments) process is intended to provide a consistent, transparent, structured path for the community to make â€œbigâ€ decisions. For example, the RFC process can be used to evolve the project roadmap and the system architecture.</p>
<h2 id="å‹•æ©Ÿ"><a class="header" href="#å‹•æ©Ÿ">å‹•æ©Ÿ</a></h2>
<p>As the Asterinas project grows in scale and community size, an informal decision-making process becomes insufficient. A formalized process is crucial for maintaining the quality and coherence of the project. Several highly successful open-source projects have demonstrated the value of such a process, including Rust (<a href="https://rust-lang.github.io/rfcs/introduction.html">RFCs</a>), Fuchsia (<a href="https://fuchsia.dev/fuchsia-src/contribute/governance/rfcs">RFCs</a>), Python (<a href="https://peps.python.org/">Python Enhancement Proposals</a> or PEPs), and Kubernetes (<a href="https://www.kubernetes.dev/resources/keps/">Kubernetes Enhancement Proposals</a> or KEPs).</p>
<p>æ¡ç”¨æ­£å¼çš„ RFC éç¨‹å°‡æœƒï¼š</p>
<ul>
<li><strong>Enhance decision quality</strong>: By requiring a detailed proposal and public discussion, we can ensure that decisions are well-reasoned, technically sound, and consider a wide range of perspectives.</li>
<li><strong>ä¿ƒé€²å…±è­˜</strong>ï¼šæ­¤éç¨‹æä¾›äº†ä¸€å€‹æ¸…æ™°çš„æ¡†æ¶ï¼Œè®“ç¤¾ç¾¤æˆå“¡èƒ½åŒ¯èšä¸€å ‚ã€è¨è«–ä¸åŒè§€é»ï¼Œä¸¦é‡å°é‡è¦è­°é¡Œé”æˆå…±è­˜ã€‚</li>
<li><strong>Create design records</strong>: Approved RFCs will serve as a historical archive, documenting the design choices made and the reasoning behind them. This is invaluable for new contributors and for future reference.</li>
</ul>
<p>By introducing this process, we aim to support the healthy and sustainable growth of the Asterinas project.</p>
<h2 id="è¨­è¨ˆ"><a class="header" href="#è¨­è¨ˆ">è¨­è¨ˆ</a></h2>
<h3 id="ä½•æ™‚æ‡‰éµå¾ª-rfc-éç¨‹"><a class="header" href="#ä½•æ™‚æ‡‰éµå¾ª-rfc-éç¨‹">ä½•æ™‚æ‡‰éµå¾ª RFC éç¨‹</a></h3>
<p>RFC éç¨‹æ‡‰é©ç”¨æ–¼å° Asterinas çš„ä»»ä½•ã€Œé‡å¤§ã€è®Šæ›´ã€‚<strong>éœ€è¦</strong> é€é RFC é€²è¡Œè®Šæ›´çš„ç¯„ä¾‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>å•Ÿå‹•èˆ‡ OSTD å’Œ OSDK å…·æœ‰åŒç­‰é‡è¦æ€§çš„å…¨æ–°é ‚å±¤å­å°ˆæ¡ˆã€‚</li>
<li>Defining or significantly altering the project roadmap and goals.</li>
<li>Establishing or changing project-wide norms, such as this RFC process itself or coding style guides.</li>
<li>æå‡ºé‡å¤§çš„æ¶æ§‹è¨­è¨ˆï¼Œä¾‹å¦‚æ¡†å…§æ ¸æ¶æ§‹æˆ–å®‰å…¨æ–¹é‡æ³¨å…¥ã€‚</li>
<li>Introducing changes that affect user-space programs, such as adding a non-Linux system call or feature.</li>
</ul>
<p>Examples of changes that <strong>do not</strong> require an RFC include:</p>
<ul>
<li>Proposing a design whose impact is confined to a single sub-project or module. If the design is significant or non-trivial, submit a design proposal on Github Issues for discussion.</li>
<li>Adding well-understood features with established patterns, such as a standard Linux system call or a device driver.</li>
<li>Refactoring existing code, fixing bugs, or improving performance.</li>
</ul>
<p>When in doubt, it is best to consult with the project maintainers using the methods described in the next section.</p>
<h3 id="rfc-éç¨‹çš„é‹ä½œæ–¹å¼"><a class="header" href="#rfc-éç¨‹çš„é‹ä½œæ–¹å¼">RFC éç¨‹çš„é‹ä½œæ–¹å¼</a></h3>
<p>The RFC process consists of several distinct stages:</p>
<h4 id="ç¤¾äº¤åŒ–éšæ®µ"><a class="header" href="#ç¤¾äº¤åŒ–éšæ®µ">ç¤¾äº¤åŒ–éšæ®µ</a></h4>
<p>Before investing the time to write a full RFC, it is highly recommended to socialize the core idea with the community. This helps gauge interest, gather early feedback, and refine the proposal. Good venues for this include:</p>
<ul>
<li>Starting a discussion on the projectâ€™s <a href="https://github.com/asterinas/asterinas/discussions">GitHub Discussions page</a>.</li>
<li>Posting a â€œPre-RFCâ€ document to solicit more detailed feedback.</li>
<li>ç›´æ¥èˆ‡é‡è¦è²¢ç»è€…ã€ç¨‹å¼ç¢¼æ“æœ‰è€…æˆ–ç¶­è­·è€…æºé€šã€‚</li>
</ul>
<p>Having support from at least a few other community members is a strong signal that the idea is ready for a formal RFC. Additionally, having a proof-of-concept implementation or identifying individuals committed to the implementation can strengthen the proposal.</p>
<h4 id="è‰ç¨¿éšæ®µ"><a class="header" href="#è‰ç¨¿éšæ®µ">è‰ç¨¿éšæ®µ</a></h4>
<p>Once you are ready to proceed, create a formal RFC document.</p>
<ol>
<li>åˆ†å‰ <code>asterinas/asterinas</code> å„²å­˜åº«ã€‚</li>
<li>In <a href="https://github.com/asterinas/asterinas/tree/main/book/src/rfcs">the <code>rfcs</code> directory</a>, copy <code>rfc-template.md</code> and rename it to <code>0000-your-rfc-title.md</code>. The <code>0000</code> is a placeholder for the RFC number, which will be assigned later.</li>
<li>Fill out the template with your proposal. The template provides a solid structure, but feel free to adapt it to best suit your proposal.</li>
</ol>
<h4 id="ç–Šä»£éšæ®µ"><a class="header" href="#ç–Šä»£éšæ®µ">ç–Šä»£éšæ®µ</a></h4>
<p>å°‡æ‚¨çš„ RFC è‰æ¡ˆä»¥æ‹‰å–è«‹æ±‚ï¼ˆPRï¼‰çš„å½¢å¼æäº¤è‡³ Asterinas å„²å­˜åº«ã€‚ä¸€æ—¦ PR é–‹å•Ÿï¼Œæ­£å¼çš„å¯©æ ¸éç¨‹å³å°‡é–‹å§‹ï¼š</p>
<ul>
<li>A project maintainer will be assigned as the <strong>facilitator</strong> for the RFC. The facilitatorâ€™s role is to guide the discussion, ensure it remains productive, and ultimately determine when consensus has been reached.</li>
<li>All members of the community are encouraged to review the proposal and provide constructive feedback through comments on the pull request.</li>
<li>The RFC author is responsible for engaging with the feedback, addressing concerns, and updating the RFC text to reflect the evolving consensus.</li>
</ul>
<h4 id="æŠ•ç¥¨éšæ®µ"><a class="header" href="#æŠ•ç¥¨éšæ®µ">æŠ•ç¥¨éšæ®µ</a></h4>
<p>ç•¶è¨è«–è¶¨æ–¼ä¸€è‡´ä¸”ä¸»è¦çš„åé¥‹æ„è¦‹çš†å·²è™•ç†å®Œç•¢æ™‚ï¼Œä½œè€…å¯ä»¥è«‹æ±‚å”èª¿äººç™¼èµ·æœ€çµ‚æŠ•ç¥¨ã€‚</p>
<ul>
<li>æŠ•ç¥¨é–‹æ”¾çµ¦æ‰€æœ‰å°ˆæ¡ˆç¶­è­·è€…ä»¥åŠé ‚å±¤å­å°ˆæ¡ˆçš„ç¨‹å¼ç¢¼æ“æœ‰è€…ã€‚è©³æƒ…è«‹åƒè¦‹ <a href="https://github.com/asterinas/asterinas/blob/main/CODEOWNERS"><code>CODEOWNERS</code></a> æª”æ¡ˆã€‚</li>
<li>æŠ•ç¥¨è€…å¯ä»¥è¡¨é”ã€Œè´Šæˆã€æˆ–ã€Œåå°ã€ã€‚</li>
<li>The final decision will be based on a <a href="https://en.wikipedia.org/wiki/Rough_consensus">rough consensus</a> as determined by the facilitator. This means that while unanimous agreement is not required, any major objections must be addressed.</li>
</ul>
<p>å¦‚æœæœ€çµ‚æ±ºå®šç‚ºæ‰¹å‡†ï¼š</p>
<ol>
<li>The facilitator will assign an unique RFC number.</li>
<li>The author will update the RFCâ€™s file name with the assigned RFC number. The author should also update the metadata fields of the RFC.</li>
<li>The facilitator will merge the pull request.</li>
</ol>
<h4 id="ç¶­è­·éšæ®µ"><a class="header" href="#ç¶­è­·éšæ®µ">ç¶­è­·éšæ®µ</a></h4>
<p>Once an RFC is approved, the proposed changes are ready for implementation. When the corresponding work is completed and merged, the RFCâ€™s status is updated from â€œapprovedâ€ to â€œimplemented.â€</p>
<p>Approved RFCs are considered immutable historical records of design decisions. As such, only minor corrective edits like fixing typos or broken links are allowed.</p>
<p>Significant changes or amendments to an existing RFC must be proposed through an entirely new RFC. This new proposal can also be used to formally deprecate a previous RFC, in which case the originalâ€™s status will be updated to â€œdeprecated.â€</p>
<h2 id="æˆæ¬Šæ¢æ¬¾-1"><a class="header" href="#æˆæ¬Šæ¢æ¬¾-1">æˆæ¬Šæ¢æ¬¾</a></h2>
<p>All RFCs submitted to the Asterinas project are licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. This license is more permissive than <a href="https://www.mozilla.org/en-US/MPL/">the MPL license</a> used for the Asterinas code.</p>
<h2 id="ç¼ºé»"><a class="header" href="#ç¼ºé»">ç¼ºé»</a></h2>
<p>Introducing a formal RFC process can increase the overhead for making changes to the project. The process is intentionally deliberate, which may slow down the pace of development for major features. There is also a risk that the process could become overly bureaucratic if not managed carefully. For contributors, the effort required to write a high-quality RFC and see it through the review process can be significant.</p>
<h2 id="prior-art-and-references"><a class="header" href="#prior-art-and-references">Prior Art and References</a></h2>
<p>The Asterinas RFC process is heavily inspired by the well-established processes of the following two open-source projects:</p>
<ul>
<li><a href="https://rust-lang.github.io/rfcs/0002-rfc-process.html">Rust RFC éç¨‹</a>ï¼šæ•´é«”çµæ§‹èˆ‡ç†å¿µçš†ç·Šå¯†åƒè€ƒ Rust çš„ RFC éç¨‹ã€‚</li>
<li><a href="https://fuchsia.dev/fuchsia-src/contribute/governance/rfcs/rfc_process">Fuchsia RFC Process</a>: We have drawn on the Fuchsia process for its clear definition of roles and its emphasis on transparent decision-making.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0002asterinas-nixos"><a class="header" href="#rfc-0002asterinas-nixos">RFC-0002ï¼šAsterinas NixOS</a></h1>
<ul>
<li>Status: Approved</li>
<li>æ‹‰å–è«‹æ±‚ï¼šhttps://github.com/asterinas/asterinas/pull/2584</li>
<li>Date submitted: 2025-11-14</li>
<li>Date approved: 2025-12-01</li>
</ul>
<h2 id="æ‘˜è¦-1"><a class="header" href="#æ‘˜è¦-1">æ‘˜è¦</a></h2>
<p>æœ¬ RFC æ­£å¼æè­°å»ºç«‹ Asterinas æ•£ä½ˆç‰ˆï¼Œä½œç‚º Asterinas çš„å…¨æ–°é ‚ç´šå­å°ˆæ¡ˆã€‚æˆ‘å€‘æ‰“ç®—åˆ©ç”¨ <a href="https://nixos.org/">NixOS</a> çš„å“è¶Šè¨‚è£½èƒ½åŠ›èˆ‡è±å¯Œçš„è»Ÿé«”åŒ…ç”Ÿæ…‹ç³»çµ±ä¾†æ‰“é€ æ­¤æ•£ä½ˆç‰ˆã€‚å› æ­¤ï¼Œæˆ‘å€‘æè­°å°‡æ­¤æ–°å­å°ˆæ¡ˆå‘½åç‚º <strong>Asterinas NixOS (AsterNixOS)</strong>ã€‚</p>
<h2 id="å‹•æ©Ÿ-1"><a class="header" href="#å‹•æ©Ÿ-1">å‹•æ©Ÿ</a></h2>
<h3 id="ä»€éº¼æ˜¯æ•£ä½ˆç‰ˆ"><a class="header" href="#ä»€éº¼æ˜¯æ•£ä½ˆç‰ˆ">ä»€éº¼æ˜¯ã€Œæ•£ä½ˆç‰ˆã€ï¼Ÿ</a></h3>
<p>In the context of operating systems (OSes), a â€œdistributionâ€ (or â€œdistroâ€) typically refers to a complete OS built around a kernel, complemented by userspace tools, libraries, and applications managed via a package management system. A Linux distro, for example, combines the Linux kernel with a rich userspace. Similarly, an Asterinas distro will pair the Asterinas kernel with a comprehensive userspace environment. For the purpose of this discussion, â€œdistroâ€ will refer broadly to either a Linux or Asterinas-based distro.</p>
<h3 id="short-term-strategic-advantages"><a class="header" href="#short-term-strategic-advantages">Short-term strategic advantages</a></h3>
<p>Achieving a Minimum Viable Product (MVP) milestone is crucial for Asterinasâ€™s maturation. Reaching MVP means that Asterinas is ready for evaluation by early adopters, who expect a seamless experience comparable to mainstream OSes. This includes easy application installation and out-of-the-box functionality. Simply providing a kernel is insufficient; we must deliver a user-friendly experience, which necessitates a full-fledged distro complete with an intuitive package manager.</p>
<p>Furthermore, direct control over an Asterinas distro offers a pragmatic approach to addressing Linux compatibility challenges. While Asterinas is committed to a high degree of Linux compatibility, achieving perfect parity in the near term is impractical. A dedicated distro allows us to configure or patch specific packages to circumvent reliance on advanced or bleeding-edge Linux features that do not have high priority in Asterinas. This significantly reduces pressure on Asterinas kernel developers to implement complex features prematurely, enabling a more focused and stable development roadmap.</p>
<p>Beyond external users, Asterinas developers themselves will greatly benefit from a dedicated distro. Testing complex applications with intricate dependencies is a significant hurdle. While â€œHello Worldâ€ or even medium-sized projects like Nginx or Redis can be manually built and integrated into a disk image, this approach does not scale for complex applications such as Spark, PyTorch, or Chromium. Identifying, understanding, and building every dependency for such projects would divert critical kernel development resources. A distro, by its very nature, abstracts this complexity through its package manager, streamlining the testing and development workflow for all Asterinas developers.</p>
<h3 id="é•·æœŸç”Ÿæ…‹ç³»çµ±é¡˜æ™¯"><a class="header" href="#é•·æœŸç”Ÿæ…‹ç³»çµ±é¡˜æ™¯">é•·æœŸç”Ÿæ…‹ç³»çµ±é¡˜æ™¯</a></h3>
<p>Looking ahead, we envision a thriving ecosystem of Asterinas distros. This initial, kernel-developer-maintained distro will serve as a vital reference implementation, fostering the creation of diverse Asterinas-based distros. While the Linux world boasts numerous distros, Asterinas-specific distros will be essential for two primary reasons:</p>
<p>é¦–å…ˆï¼ŒAsterinas å„ªå…ˆè€ƒæ…®çš„æ˜¯å¤–éƒ¨ ABI å±¤ç´šçš„ Linux ç›¸å®¹æ€§ï¼Œè€Œéå…§éƒ¨å…§æ ¸æ¨¡çµ„ä»‹é¢ã€‚é€™æ„å‘³è‘— Asterinas ç„¡æ³•è¼‰å…¥ Linux å…§æ ¸æ¨¡çµ„ï¼ˆ<code>.ko</code> æª”æ¡ˆï¼‰ã€‚Asterinas æ•£ä½ˆç‰ˆå°‡ç¢ºä¿æ‰€æœ‰ç³»çµ±ç¨‹å¼åƒ…è¼‰å…¥ Asterinas å…§æ ¸æ¨¡çµ„ã€‚</p>
<p>Secondly, Asterinas will eventually provide features and value propositions that Linux simply does not haveâ€”for example, new system calls, file systems, and device drivers. These benefits only become real when applications can detect and leverage them.</p>
<p>An Asterinas distro is the natural vehicle for this. It can ship new packages written specifically for Asterinas and carry patches to existing packages to make them â€œAsterinas-awareâ€, ensuring that userspace can meaningfully take advantage of the kernelâ€™s unique capabilities.</p>
<p>In essence, establishing Asterinas distros is paramount for Asterinasâ€™s long-term success and differentiation. This RFC lays the groundwork for that future by proposing our foundational distro.</p>
<h2 id="è¨­è¨ˆ-1"><a class="header" href="#è¨­è¨ˆ-1">è¨­è¨ˆ</a></h2>
<h3 id="ç‚ºä»€éº¼é¸æ“‡-nixos-ä½œç‚ºåŸºç¤æ•£ä½ˆç‰ˆ"><a class="header" href="#ç‚ºä»€éº¼é¸æ“‡-nixos-ä½œç‚ºåŸºç¤æ•£ä½ˆç‰ˆ">ç‚ºä»€éº¼é¸æ“‡ NixOS ä½œç‚ºåŸºç¤æ•£ä½ˆç‰ˆï¼Ÿ</a></h3>
<p>Building the first Asterinas distro from scratch would be an immense undertaking, diverting focus from core kernel development. Therefore, basing it on an existing Linux distro is the most rational path forward. This leads to the crucial question: which Linux distro should serve as our foundation?</p>
<p>The landscape of Linux distros is vast, featuring prominent names such as <a href="https://archlinux.org/">Arch</a>, <a href="https://www.centos.org/">CentOS</a>, <a href="https://www.debian.org/">Debian</a>, and <a href="https://www.gentoo.org/">Gentoo</a>. While theoretically, any of these could serve, we have identified <a href="https://nixos.org/">NixOS</a> as a particularly attractive and uniquely suited option.</p>
<p>In most distros, package recipes are centered around shell scripts (e.g., <a href="https://man.archlinux.org/man/PKGBUILD.5#EXAMPLE"><code>PKGBUILD</code></a> in Arch Linux or the <a href="https://www.debian.org/doc/manuals/maint-guide/dreq.en.html#rules"><code>rules</code></a> file in a Debian package). NixOS, however, utilizes a purpose-built, purely functional language called <a href="https://nixos-and-flakes.thiscute.world/the-nix-language/">Nix</a>, which offers unparalleled expressiveness and flexibility for defining package recipes.</p>
<p>A core requirement for our base distro is the ability to easily tweak existing package recipes to work around Asterinasâ€™s limitations or customize the new distroâ€™s look or behavior. The Nix language excels in this regard.</p>
<p>For instance, consider overriding specific attributes of an existing Nix package, such as <code>xfdesktop</code>, with minimal code:</p>
<pre><code class="language-nix">{ pkgs }:
{
  xfdesktop = pkgs.xfce.xfdesktop.overrideAttrs (oldAttrs: {
    version = "4.16.0";
    patches = (oldAttrs.patches or []) ++ [
      ./patches/xfdesktop4/0001-Fix-not-using-consistent-monitor-identifiers.patch
    ];
  });
}
</code></pre>
<p>This Nix file creates a customized <code>xfdesktop</code> package without requiring intrusive modifications to its original recipe. This capability, known as <a href="https://nixos.org/guides/nix-pills/14-override-design-pattern.html">the override design pattern</a> in Nix, is uniquely feasible due to Nixâ€™s first-class functions and lazy evaluation.</p>
<p>Another powerful example of NixOSâ€™s flexibility is how easily we can create an Asterinas distro ISO installer by customizing an existing <a href="https://nixos.org/download/#nixos-iso">NixOS installer ISO</a>. Consider the following <code>iso-image.nix</code> file:</p>
<pre><code class="language-nix">{ lib, pkgs, ... }:
let
  asterinas_kernel = builtins.path { path = "asterinas_bin"; };
  auto_install_script = pkgs.replaceVarsWith {
    src = "./auto_install.sh";
    isExecutable = true;
    replacements = {
      shell = "${pkgs.bash}/bin/sh";
      inherit asterinas_kernel;
    };
  };
  configuration = {
    imports = [
      "${pkgs.path}/nixos/modules/installer/cd-dvd/installation-cd-minimal.nix"
      "${pkgs.path}/nixos/modules/installer/cd-dvd/channel.nix"
    ];

    services.getty.autologinUser = lib.mkForce "root";
    environment.loginShellInit = "${auto_install_script}";
  };
in (pkgs.nixos configuration).config.system.build.isoImage
</code></pre>
<p>This file defines a new installer ISO that differs from the original in two key ways. First, it ships with the Asterinas kernel (<code>asterinas_kernel</code>). Second, instead of dropping the user into an interactive shell, the ISOâ€™s init process immediately runs an automatic installation script (<code>auto_install.sh</code>).</p>
<p>A notable NixOS feature relevant to our design is <code>/etc/nixos/configuration.nix</code>, the <a href="https://nixos.org/manual/nixos/stable/#sec-configuration-file">primary configuration file</a> that determines <em>all</em> system-wide states of a NixOS installation, including the kernel, installed software, and configuration. A minimal <code>configuration.nix</code> for our distro might look like this:</p>
<pre><code class="language-nix">{ config, pkgs, lib, ... }:
{
  # Do not edit the following system configuration for Asterinas NixOS
  nixpkgs.overlays = [ (import ./asterinas.nix) ];

  # Edit this list to add or remove installed software
  environment.systemPackages = with pkgs; [
    gcc
    python33
    vim
  ];
}
</code></pre>
<p>Here, the sample <code>configuration.nix</code> uses a NixOS feature called <a href="https://wiki.nixos.org/wiki/Overlays">overlays</a> to customize and extend Nixpkgs without modifying its upstream source. Overlays apply globally within the configuration, so our Asterinas-specific changes to vanilla NixOS can be expressed cleanly as reusable overlays rather than as ad-hoc patches scattered throughout the system.</p>
<p>NixOS çš„ä¸€å€‹é¡¯è‘—å„ªå‹¢åœ¨æ–¼å®ƒçš„è»Ÿé«”åŒ…ç®¡ç†å™¨ <a href="https://nixos.org/download/#nix-install-linux">Nix</a>ï¼ˆä»¥åŠå®ƒæ‰€ä½¿ç”¨çš„ Nix èªè¨€ï¼‰å…·å‚™é«˜åº¦çš„å¯ç§»æ¤æ€§ï¼Œå¯è·¨å¤šç¨® Linux æ•£ä½ˆç‰ˆç”šè‡³åœ¨ macOS ä¸Šé‹ä½œã€‚</p>
<p>Unlike most package managers, which are tightly coupled to their parent distros (e.g., <code>pacman</code> for Arch, <code>dpkg</code> for Debian, <code>rpm</code> for Red Hat-based systems), Nix operates independently. Nix packages are installed in the <code>/nix/store</code> directory, ensuring they do not conflict with native packages. This portability is invaluable for debugging: if a package in our NixOS-based distro encounters an issue, we can replicate the exact same package environment on any Linux development machine, greatly simplifying troubleshooting.</p>
<h3 id="the-new-top-level-sub-project"><a class="header" href="#the-new-top-level-sub-project">The New Top-Level Sub-Project</a></h3>
<p>Given these compelling rationales, we propose the creation of a new top-level sub-project named <em>Asterinas NixOS (AsterNixOS)</em>. This sub-project will reside in a new <code>distro/</code> directory at the project root.</p>
<p>Initially, AsterNixOS will share version numbers with the Asterinas kernel, emphasizing its early development stage and close coupling. Every kernel release will be accompanied by a compatible distro release. In the long term, once both the kernel and the distro achieve maturity and stability, AsterNixOS will adopt its own independent versioning scheme, likely following a â€œYY.MMâ€ format (e.g., 25.12).</p>
<h2 id="drawbacks-alternatives-and-unknowns"><a class="header" href="#drawbacks-alternatives-and-unknowns">Drawbacks, Alternatives, and Unknowns</a></h2>
<h3 id="ç¼ºé»-1"><a class="header" href="#ç¼ºé»-1">ç¼ºé»</a></h3>
<ul>
<li><strong>Learning curve for Nix/NixOS:</strong> This is arguably the most significant hurdle. While exceptionally powerful, the Nix ecosystem, including the Nix language and its functional paradigm, presents a steeper learning curve compared to conventional package managers and build systems. This could pose an initial barrier for new contributors and existing Asterinas developers unfamiliar with Nix. Investing in clear documentation and onboarding resources will be critical.</li>
<li><strong>Maintenance overhead of Nixpkgs overlay:</strong> While the override pattern offers flexibility, maintaining a dedicated overlay for Asterinas-specific patches and configurations within the vast <code>nixpkgs</code> repository will still require continuous effort. Keeping pace with upstream <code>nixpkgs</code> changes, resolving potential conflicts, and ensuring compatibility will be an ongoing challenge requiring dedicated resources.</li>
</ul>
<h3 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h3>
<ul>
<li><strong>Embedded Linux distros:</strong> <a href="https://buildroot.org/">Buildroot</a> and <a href="https://www.yoctoproject.org/">Yocto</a> are established and highly capable tools for building embedded Linux distros, offering extensive customization for toolchains and root filesystems from scratch.
<ul>
<li><strong>Why NixOS is superior:</strong> While powerful for embedded use cases, Buildroot and Yocto are less oriented toward a general-purpose desktop/server distro, which is our primary initial target. Furthermore, their configuration languages are generally less expressive and composable than the Nix language, limiting the flexibility we seek for deep customization and elegant overriding.</li>
</ul>
</li>
<li><strong>Direct port of Debian/Arch/etc.:</strong> This approach would involve directly modifying the build systems of a more traditional distro like Debian or Arch to target Asterinas.
<ul>
<li><strong>Why NixOS is superior:</strong> As elaborated, traditional packaging systems are less flexible for the granular, targeted patching and configuration required when adapting to a new kernel. More critically, their package managers (e.g., <code>dpkg</code>, <code>pacman</code>, <code>rpm</code>) are inherently tied to their parent distros, making cross-distro development and debugging significantly more complex. The Nix package managerâ€™s portability offers a clear advantage here.</li>
</ul>
</li>
</ul>
<h2 id="prior-art-and-references-1"><a class="header" href="#prior-art-and-references-1">Prior Art and References</a></h2>
<p>The NixOS project itself serves as the most prominent piece of prior art, demonstrating the viability and advantages of a purely functional approach to OS configuration and package management. Its design principles, particularly around atomic upgrades, rollbacks, and reproducible builds, have been thoroughly proven since its inception in 2003. Other projects, like <a href="https://guix.gnu.org/">GNU Guix</a>, also follow a similar functional package management paradigm.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rfc-0000-your-short-descriptive-title"><a class="header" href="#rfc-0000-your-short-descriptive-title">RFC-0000: Your short, descriptive title</a></h1>
<ul>
<li>Status: Draft</li>
<li>Pull request: (link to PR)</li>
<li>Date submitted: YYYY-MM-DD</li>
<li>Date approved: YYYY-MM-DD</li>
</ul>
<h2 id="æ‘˜è¦-2"><a class="header" href="#æ‘˜è¦-2">æ‘˜è¦</a></h2>
<p>Provide a concise, one-paragraph summary of the proposed change. This should explain the core idea at a high level, making it understandable to someone without deep context.</p>
<h2 id="å‹•æ©Ÿ-2"><a class="header" href="#å‹•æ©Ÿ-2">å‹•æ©Ÿ</a></h2>
<p>Explain the â€œwhyâ€ behind this RFC. What problem does this solve? What is the user or developer story that justifies this change? Why is this change important for the Asterinas project <em>now</em>? This section should clearly articulate the benefits and convince readers of the proposalâ€™s necessity.</p>
<h2 id="è¨­è¨ˆ-2"><a class="header" href="#è¨­è¨ˆ-2">è¨­è¨ˆ</a></h2>
<p>This is the heart of the RFC. Describe the proposed design in sufficient detail for a technical review. Explain how it works, how it interacts with other parts of the system, and any new APIs or concepts being introduced. Use code snippets, diagrams, and bullet points where they add clarity.</p>
<h2 id="drawbacks-alternatives-and-unknown"><a class="header" href="#drawbacks-alternatives-and-unknown">Drawbacks, Alternatives, and Unknown</a></h2>
<ul>
<li><strong>Drawbacks:</strong> What are the negative consequences of this proposal? What compromises are being made?</li>
<li><strong>Alternatives:</strong> What other designs or solutions were considered? Why was this specific design chosen over them? What is the impact of <em>not</em> doing this?</li>
<li><strong>Unresolved Questions:</strong> What parts of the design are still to be determined (TBD)? What questions will need to be answered during the implementation phase?</li>
</ul>
<h2 id="prior-art-and-references-2"><a class="header" href="#prior-art-and-references-2">Prior Art and References</a></h2>
<p>Include links to relevant work</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
